var plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1={init:function(){console.log("插件编写测试");core.enemys.getDamageString=function(c,e,f,d){if(typeof c=="string"){c=core.material.enemys[c]}var b=this.getDamage(c,e,f,d);var a="#000000";if(b==null){b="???";a="#FF0000"}else{if(core.getFlag("addhp",0)==1){if(b<core.status.hero.hp){a="#00FF00"}else{a="#FF0000"}}else{if(b<=0){a="#00FF00"}else{if(b<core.status.hero.hp/3){a="#FFFFFF"}else{if(b<core.status.hero.hp*2/3){a="#FFFF00"}else{if(b<core.status.hero.hp){a="#FF7F00"}else{a="#FF0000"}}}}}b=core.formatBigNumber(b,true);if(core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,21)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}}return{damage:b,color:a}};core.ui._drawBook_drawDamage=function(d,c,e,f){core.setTextAlign("ui","center");var b=c.damage,a="#FFFF00";if(b==null){b="不可攻击";a="#FF0000"}else{if(b==0){b="无危险";a="#00FF00"}else{if(b>=core.status.hero.hp){a="#FF0000"}if(b<=0){a="#00FF00"}b=core.formatBigNumber(b);if(core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,21)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}}}if(c.notBomb){b+="[b]"}core.fillText("ui",b,e,f,a,this._buildFont(13,true))};core.control.checkBlock=function(){var c=core.getHeroLoc("x"),d=core.getHeroLoc("y"),b=c+","+d;var a=core.status.checkBlock.damage[b];if(a){core.status.hero.hp-=a;core.drawTip("你没有神圣盾不能防御，受到 "+a+" 点魔法伤害");this._checkBlock_soundAndAnimate(c,d);if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}}this._checkBlock_snipe(core.status.checkBlock.snipe[b]);this._checkBlock_ambush(core.status.checkBlock.ambush[b])};core.control._checkBlock_soundAndAnimate=function(a,b){core.playSound("zone.mp3")};core.control._checkBlock_snipe=function(b){if(!b||b.length==0){return}var a=[];b.forEach(function(c){a.push({type:"move",loc:[c[0],c[1]],steps:[c[3]],time:200,keep:true,async:true})});a.push({type:"waitAsync"});core.insertAction(a)};core.registerSystemEvent("man",function(h,g){var d=core.status.floorId.replace(/[^0-9]/ig,"");var e=core.nextX();var f=core.nextY();core.insertAction([{type:"insert",name:"对话",args:[d,e,f,0]},]);if(g){g()}});core.registerSystemEvent("woman",function(h,g){var i=core.status.floorId+"@"+core.nextX()+"@"+core.nextY()+"@A";if(core.getFlag(i,0)==1){var d=core.status.floorId.replace(/[^0-9]/ig,"");var e=core.nextX();var f=core.nextY();core.insertAction([{type:"insert",name:"对话",args:[d,e,f,1]},])}else{core.insertAction([{type:"insert",name:"商人",args:[0]},])}if(g){g()}});core.registerSystemEvent("specialwall",function(b,a){if(b.event.id=="whiteWall"||core.getFlag("talking")>0){core.insertAction([{type:"insert",name:"开墙"},]);if(b.event.id!="whiteWall"){core.setFlag("end",1)}core.setFlag("talking",0)}if(a){a()}});core.registerSystemEvent("fakeWall",function(b,a){if(b.event.id=="blueWall"){core.insertAction([{type:"openDoor",loc:[b.x,b.y]},])}if(a){a()}});core.events._changeFloor_beforeChange=function(b,a){window.setTimeout(function(){if(b.time==0){core.events._changeFloor_changing(b,a)}else{var d=parseInt(core.status.floorId.slice(2)),c=d;var f=parseInt(b.floorId.slice(2));core.setCurtain([255,255,255,1]);core.setFlag("__color__",[255,255,255,1]);var e=window.setInterval(function(){if(d>f){d--}else{if(d<f){d++}else{clearInterval(e);core.status.floorId=c;core.events._changeFloor_changing(b,a)}}core.status.floorId="MT"+d;core.ui.statusBar._update_props()},b.time*10)}},25)};core.events._changeFloor_changing=function(b,a){this.changingFloor(b.floorId,b.heroLoc,b.fromLoad);if(b.time==0){this._changeFloor_afterChange(b,a)}else{core.setCurtain([0,0,0,0],750,function(){core.setFlag("__color__",[0,0,0,0]);core.events._changeFloor_afterChange(b,a)})}};core.ui.drawWindowSelector=function(a,e,f,d,c){d=Math.round(d)+48,c=Math.round(c);var b=core.ui.createCanvas("_selector",e-24,f,d,c,165);this._drawSelector(b,a,d,c)};core.ui._drawSelector=function(b,a,f,c,d,e){d=d||0;e=e||0;b=this.getContextByName(b);if(!b){return}if(typeof a=="string"){a=core.material.images.images[a]}if(!(a instanceof Image)){return}b.drawImage(a,132,68,24,24,d+4,e+4,24,24);b.drawImage(a,132,68,24,24,f-d-28,e+4,24,24)};core.ui.drawTip=function(c,b,a){core.ui.statusBar.print(c)};core.ui.clearMap=function(d,f,g,e,b){if(d=="all"){for(var c in core.canvas){core.canvas[c].clearRect(0,0,core.bigmap.width*32,core.bigmap.height*32)}core.clearMap("outerUI");core.dom.gif.innerHTML="";core.removeGlobalAnimate()}else{var a=this.getContextByName(d);if(a){a.clearRect(f||0,g||0,e||a.canvas.width,b||a.canvas.height)}}};core.control._shouldDisplayStatus=function(){return[]};core.control._updateStatusBar_setToolboxIcon=function(){core.ui.statusBar._update_toolBox()};core.control.updateGlobalAttribute=function(){};core.actions._getClickLoc=function(f,g){var d=32;d=d*core.domStyle.scale;var a=main.dom.body.clientWidth/2,b=main.dom.body.clientHeight/2;f-=a,g-=b;if(core.domStyle.isVertical){var e=f;f=g,g=-e}var c={x:f+320*core.domStyle.scale,y:g+211*core.domStyle.scale,size:d};if(core.ui.statusBar.isInGameDraw(c)){c=core.ui.statusBar.fixEventLoc(c)}else{c.x/=core.domStyle.scale;c.y/=core.domStyle.scale;c.outer=true}return c};this._afterLoadResources=function(){}},drawLight:function(){this.drawLight=function(e,a,d,c){var b=core.getContextByName(e);if(b==null){if(typeof e=="string"){b=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}else{return}}b.mozImageSmoothingEnabled=false;b.webkitImageSmoothingEnabled=false;b.msImageSmoothingEnabled=false;b.imageSmoothingEnabled=false;core.clearMap(e);if(a==null){a=0.9}b.fillStyle="rgba(0,0,0,"+a+")";b.fillRect(0,0,b.canvas.width,b.canvas.height);c=core.clamp(c,0,1);b.globalCompositeOperation="destination-out";d.forEach(function(h){var j=h[0],k=h[1],i=h[2];var f=parseInt(i*c);var g=b.createRadialGradient(j,k,f,j,k,i);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");b.beginPath();b.fillStyle=g;b.arc(j,k,i,0,2*Math.PI);b.fill()});b.globalCompositeOperation="source-over"}}};