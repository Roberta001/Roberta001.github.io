var data_a1e2fb4a_e986_4524_b0da_9b7ba7c0874d={main:{floorIds:["MT0","MT1","MT2","MT3","MT4","MT5","MT6","MT7","MT8","MT9","MT10","MT11","MT12","MT13","MT14","MT15","MT16","MT17","MT18","MT19","MT20","MT21","MT22","MT23","MT24","MT25","MT26","MT27","MT28","MT29","MT30","MT31","MT32","MT33","MT34","MT35","MT36","MT37","MT38","MT39","MT40","MT41","MT42","MT43","MT44","MT45","MT46","MT47","MT48","MT49","MT50"],images:["bg.jpg","winskin.png","statusBackground.jpg"],tilesets:[],animates:["hand","sword","zone"],bgms:["xiaoluoli.mp3","wan.mp3","huang.mp3","xian.mp3","chuanshuo.mp3","ed.mp3","hua.mp3","migong.mp3","bgm.mp3","section1.mp3","section2.mp3","section3.mp3","section4.mp3","section5.mp3","boss4.mp3","boss5.mp3","truth.mp3"],sounds:["floor.mp3","attack.mp3","door.mp3","item.mp3","equip.mp3","zone.mp3","jump.mp3","pickaxe.mp3","bomb.mp3","centerFly.mp3","3F.mp3","10F.mp3","20F.mp3"],startBackground:"bg.jpg",startLogoStyle:"color: black",levelChoose:[["简单","Easy"]],equipName:[],startBgm:null,statusLeftBackground:"url(project/images/ground.png) repeat",statusTopBackground:"url(project/images/ground.png) repeat",toolsBackground:"url(project/images/ground.png) repeat",borderColor:"black",statusBarColor:"#66CCFF",hardLabelColor:"#66CCFF",floorChangingBackground:"black",floorChangingTextColor:"#66CCFF",font:"Verdana"},firstData:{title:"50层魔塔",name:"51",version:"Ver 2.6",floorId:"MT1",hero:{name:"勇者",lv:1,hpmax:9999,hp:1000,manamax:-1,mana:0,atk:100,def:100,mdef:0,money:0,experience:0,equipment:[],items:{keys:{yellowKey:0,blueKey:0,redKey:0},constants:{I300:1},tools:{},equips:{}},loc:{direction:"down",x:6,y:11},flags:{nowWeapon:"sword5",nowShield:"shield5",__winskin_opacity__:1},steps:0},startCanvas:[{type:"comment",text:"在这里可以用事件来自定义绘制标题界面的背景图等"},{type:"comment",text:"也可以直接切换到其他楼层（比如某个开始剧情楼层）进行操作。"},{type:"showImage",code:1,image:"bg.jpg",loc:[0,0],dw:100,dh:100,opacity:1,time:0},{type:"while",condition:"1",data:[{type:"comment",text:"给用户提供选择项，这里简单的使用了choices事件"},{type:"comment",text:"也可以贴按钮图然后使用等待操作来完成"},{type:"choices",choices:[{text:"开始游戏",action:[{type:"comment",text:"检查bgm状态，下同"},{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"if",condition:"core.flags.startDirectly","true":[{type:"comment",text:"直接开始游戏，设置初始化数据"},{type:"function","function":"function(){\ncore.events.setInitData('')\n}"}],"false":[{type:"comment",text:"动态生成难度选择项"},{type:"function","function":'function(){\nvar choices = [];\nmain.levelChoose.forEach(function (one) {\n\tchoices.push({"text": one[0], "action": [\n\t\t{"type": "function", "function": "function() { core.status.hard = \'"+one[1]+"\'; core.events.setInitData(\'"+one[1]+"\'); }"}\n\t]});\n})\ncore.insertAction({"type": "choices", "choices": choices});\n}'}]},{type:"hideImage",code:1,time:0},{type:"comment",text:"成功选择难度"},{type:"break"}]},{text:"读取存档",action:[{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"comment",text:"简单的使用“呼出读档界面”来处理"},{type:"callLoad"}]},{text:"回放录像",action:[{type:"function","function":"function(){\ncore.control.checkBgm()\n}"},{type:"comment",text:"这段代码会弹框选择录像文件"},{type:"if",condition:"!core.isReplaying()","true":[{type:"function","function":"function(){\ncore.chooseReplayFile()\n}"}],"false":[]}]}]}]},{type:"comment",text:"接下来会执行startText中的事件"}],startText:[{type:"setText",background:"winskin.png"}],shops:[],levelUp:[{need:"0",title:"",action:[{type:"comment",text:"此处是初始等级，只需填写称号"}]},{need:"20",title:"第二级",action:[{type:"setValue",name:"status:atk",value:"status:atk+10"},{type:"setValue",name:"status:def",value:"status:def+10"}]},{need:"40",title:"",action:[{type:"tip",text:"恭喜升级"}]}]},values:{lavaDamage:100,poisonDamage:10,weakValue:20,redJewel:1,blueJewel:1,greenJewel:5,redPotion:50,bluePotion:200,yellowPotion:500,greenPotion:800,breakArmor:0.9,counterAttack:0.1,purify:3,hatred:2,moveSpeed:100,animateSpeed:400,floorChangeTime:0},flags:{enableFloor:true,enableName:false,enableLv:false,enableHPMax:false,enableMana:false,enableMDef:false,enableMoney:true,enableExperience:false,enableLevelUp:false,levelUpLeftMode:false,enableKeys:true,enablePZF:false,enableDebuff:false,enableSkill:false,flyNearStair:true,pickaxeFourDirections:true,bombFourDirections:true,snowFourDirections:true,bigKeyIsBox:false,steelDoorWithoutKey:false,equipment:false,equipboxButton:false,iconInEquipbox:false,enableAddPoint:false,enableNegativeDamage:false,hatredDecrease:true,betweenAttackCeil:false,betweenAttackMax:false,useLoop:true,startUsingCanvas:false,startDirectly:true,statusCanvas:false,statusCanvasRowsOnMobile:4,displayEnemyDamage:true,displayCritical:true,displayExtraDamage:true,enableGentleClick:false,potionWhileRouting:false,ignoreChangeFloor:false,canGoDeadZone:false,enableMoveDirectly:true,enableDisabledShop:true,disableShopOnDamage:false,checkConsole:false,flyRecordPosition:null,itemFirstText:null,blurFg:null}};var enemys_fcae963b_31c9_42b4_b48c_bb48d09f3f80={greenSlime:{name:"绿色史莱姆",hp:35,atk:18,def:1,money:1,experience:0,special:0},redSlime:{name:"红色史莱姆",hp:45,atk:20,def:2,money:2,experience:0,special:0},blackSlime:{name:"大史莱姆",hp:130,atk:60,def:3,money:8,experience:0,special:0},slimelord:{name:"史莱姆王",hp:360,atk:310,def:20,money:40,experience:0,special:0},bat:{name:"小蝙蝠",hp:35,atk:38,def:3,money:3,experience:0,special:0},bigBat:{name:"大蝙蝠",hp:60,atk:100,def:8,money:12,experience:0,special:0},redBat:{name:"吸血蝙蝠",hp:200,atk:390,def:90,money:50,experience:0,special:0},vampire:{name:"吸血鬼",hp:444,atk:199,def:66,money:144,experience:0,special:0,notBomb:true},skeleton:{name:"骷髅人",hp:50,atk:42,def:6,money:6,experience:0,special:0},skeletonSoilder:{name:"骷髅士兵",hp:55,atk:52,def:12,money:8,experience:0,special:0},skeletonCaptain:{name:"骷髅队长",hp:100,atk:65,def:15,money:30,experience:0,special:0,notBomb:true},ghostSkeleton:{name:"鬼战士",hp:220,atk:180,def:30,money:35,experience:0,special:0},zombie:{name:"兽人",hp:260,atk:85,def:5,money:18,experience:0,special:0},zombieKnight:{name:"兽人武士",hp:320,atk:120,def:15,money:30,experience:0,special:0},rock:{name:"石头人",hp:20,atk:100,def:68,money:28,experience:0,special:0},slimeMan:{name:"幽灵",hp:320,atk:140,def:20,money:30,experience:0,special:0,atkValue:null,defValue:null},bluePriest:{name:"初级法师",hp:60,atk:32,def:8,money:5,experience:0,special:0},redPriest:{name:"高级法师",hp:100,atk:95,def:30,money:22,experience:0,special:0},brownWizard:{name:"初级巫师",hp:220,atk:370,def:110,money:80,experience:0,special:15,value:100,range:1},redWizard:{name:"高级巫师",hp:200,atk:380,def:130,money:90,experience:0,special:15,value:200,zoneSquare:null,range:1},yellowGuard:{name:"初级卫兵",hp:50,atk:48,def:22,money:12,experience:0,special:0},blueGuard:{name:"中级卫兵",hp:100,atk:180,def:110,money:50,experience:0,special:0},redGuard:{name:"高级卫兵",hp:180,atk:460,def:360,money:200,experience:0,special:0},swordsman:{name:"双手剑士",hp:100,atk:680,def:50,money:55,experience:0,special:0},soldier:{name:"战士",hp:210,atk:200,def:65,money:45,experience:0,special:0},yellowKnight:{name:"骑士队长",hp:120,atk:150,def:50,money:100,experience:0,special:0,notBomb:true},redKnight:{name:"骑士",hp:160,atk:230,def:105,money:65,experience:0,special:0},darkKnight:{name:"黑暗骑士",hp:180,atk:430,def:210,money:120,experience:0,special:0},blackKing:{name:"高级巫师",hp:200,atk:380,def:130,money:90,experience:0,special:18,bomb:false,value:200},yellowKing:{name:"黄衣魔王",hp:0,atk:0,def:0,money:0,experience:0,special:0},greenKing:{name:"青衣武士",hp:0,atk:0,def:0,money:0,experience:0,special:0},blueKnight:{name:"蓝骑士",hp:100,atk:120,def:0,money:9,experience:0,special:8},goldSlime:{name:"黄头怪",hp:0,atk:0,def:0,money:0,experience:0,special:0},poisonSkeleton:{name:"紫骷髅",hp:0,atk:0,def:0,money:0,experience:0,special:0},poisonBat:{name:"紫蝙蝠",hp:100,atk:120,def:0,money:14,experience:0,special:13},steelRock:{name:"铁面人",hp:0,atk:0,def:0,money:0,experience:0,special:0},skeletonPriest:{name:"骷髅法师",hp:100,atk:100,def:0,money:0,experience:0,special:18,value:20},skeletonKing:{name:"骷髅王",hp:0,atk:0,def:0,money:0,experience:0,special:0},skeletonWizard:{name:"骷髅巫师",hp:0,atk:0,def:0,money:0,experience:0,special:0},redSkeletonCaption:{name:"骷髅武士",hp:0,atk:0,def:0,money:0,experience:0,special:0},badHero:{name:"迷失勇者",hp:0,atk:0,def:0,money:0,experience:0,special:0},demon:{name:"魔神武士",hp:0,atk:0,def:0,money:0,experience:0,special:0},demonPriest:{name:"魔神法师",hp:0,atk:0,def:0,money:0,experience:0,special:0},goldHornSlime:{name:"金角怪",hp:0,atk:0,def:0,money:0,experience:0,special:0},redKing:{name:"魔王",hp:8000,atk:5000,def:1000,money:500,experience:0,special:0,notBomb:true},whiteKing:{name:"魔法警卫",hp:230,atk:450,def:100,money:100,experience:0,special:16},blackMagician:{name:"大法师",hp:4500,atk:560,def:310,money:1000,experience:0,special:0,notBomb:true},silverSlime:{name:"银头怪",hp:100,atk:120,def:0,money:15,experience:0,special:14},swordEmperor:{name:"魔王",hp:5000,atk:1580,def:190,money:500,experience:0,special:0,notBomb:true},whiteHornSlime:{name:"尖角怪",hp:0,atk:0,def:0,money:0,experience:0,special:0},badPrincess:{name:"痛苦魔女",hp:0,atk:0,def:0,money:0,experience:0,special:0},badFairy:{name:"黑暗仙子",hp:0,atk:0,def:0,money:0,experience:0,special:0},grayPriest:{name:"中级法师",hp:0,atk:0,def:0,money:0,experience:0,special:0},redSwordsman:{name:"剑王",hp:100,atk:120,def:0,money:7,experience:0,special:6,n:8},whiteGhost:{name:"水银战士",hp:0,atk:0,def:0,money:0,experience:0,special:0},poisonZombie:{name:"绿兽人",hp:100,atk:120,def:0,money:13,experience:0,special:12},magicDragon:{name:"魔龙",hp:1500,atk:600,def:250,money:800,experience:0,special:0,notBomb:true},octopus:{name:"大乌贼",hp:1200,atk:180,def:20,money:100,experience:0,special:0,notBomb:true},darkFairy:{name:"仙子",hp:0,atk:0,def:0,money:0,experience:0,special:0},greenKnight:{name:"强盾骑士",hp:0,atk:0,def:0,money:0,experience:0,special:0},angel:{name:"天使",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},elemental:{name:"元素生物",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:0},steelGuard:{name:"铁守卫",hp:0,atk:0,def:0,money:0,experience:0,point:0,special:18,value:20},evilBat:{name:"邪恶蝙蝠",hp:1000,atk:1,def:0,money:0,experience:0,point:0,special:[2,3]}};var icons_4665ee12_3a1f_44a4_bea3_0fccba634dc1={hero:{down:{loc:0,stop:0,leftFoot:1,rightFoot:3},left:{loc:1,stop:0,leftFoot:1,rightFoot:3},right:{loc:2,stop:0,leftFoot:1,rightFoot:3},up:{loc:3,stop:0,leftFoot:1,rightFoot:3},height:48},terrains:{ground:0,grass:1,grass2:2,yellowWall:3,whiteWall:4,blueWall:5,snowGround:6,ground2:7,ground3:8,ground4:9,sand:10,ground5:11,yellowWall2:12,whiteWall2:13,blueWall2:14,blockWall:15,grayWall:16,white:17,ground6:18,soil:19,ground7:20,ground8:21,ice:22,downFloor:23,upFloor:24,yellowDoor:25,blueDoor:26,redDoor:27,greenDoor:28,specialDoor:29,steelDoor:30,"blueShop-left":31,"blueShop-right":32,"pinkShop-left":33,"pinkShop-right":34,arrowUp:35,arrowDown:36,arrowLeft:37,arrowRight:38,light:39,darkLight:40,ski:41,flower:42,box:43,boxed:44,T330:45},animates:{star:0,lava:1,blueWater:2,water:3,yellowDoor:4,blueDoor:5,redDoor:6,greenDoor:7,specialDoor:8,steelDoor:9,yellowWall:10,whiteWall:11,blueWall:12,crystalUp:13,crystalBottom:14,starPortal:15,fire:16,portal:17,"switch":18,lavaNet:19,poisonNet:20,weakNet:21,curseNet:22,downPortal:23,leftPortal:24,rightPortal:25,upPortal:26},npcs:{man:0,woman:1,thief:2,fairy:3,magician:4,womanMagician:5,oldMan:6,child:7,wood:8,pinkShop:9,blueShop:10,princess:11,wlt:12,wt:13,wrt:14,wl:15,wc:16,wr:17,wlb:18,wrb:19,dlt:20,dt:21,drt:22,dl:23,dc:24,dr:25,dlb:26,drb:27},npc48:{npc0:0,npc1:1,npc2:2,npc3:3,npc4:4},enemys:{greenSlime:0,redSlime:1,blackSlime:2,slimelord:3,bat:4,bigBat:5,redBat:6,vampire:7,skeleton:8,skeletonSoilder:9,skeletonCaptain:10,ghostSkeleton:11,zombie:12,zombieKnight:13,rock:14,slimeMan:15,bluePriest:16,redPriest:17,brownWizard:18,redWizard:19,yellowGuard:20,blueGuard:21,redGuard:22,swordsman:23,soldier:24,yellowKnight:25,redKnight:26,darkKnight:27,blackKing:28,yellowKing:29,greenKing:30,blueKnight:31,goldSlime:32,poisonSkeleton:33,poisonBat:34,steelRock:35,skeletonPriest:36,skeletonKing:37,skeletonWizard:38,redSkeletonCaption:39,badHero:40,demon:41,demonPriest:42,goldHornSlime:43,redKing:44,whiteKing:45,blackMagician:46,silverSlime:47,swordEmperor:48,whiteHornSlime:49,badPrincess:50,badFairy:51,grayPriest:52,redSwordsman:53,whiteGhost:54,poisonZombie:55,magicDragon:56,octopus:57,darkFairy:58,greenKnight:59},enemy48:{angel:0,elemental:1,steelGuard:2,evilBat:3},items:{yellowKey:0,blueKey:1,redKey:2,greenKey:3,steelKey:4,bigKey:6,redJewel:16,blueJewel:17,greenJewel:18,yellowJewel:19,redPotion:20,bluePotion:21,greenPotion:22,yellowPotion:23,lifeWand:33,sword0:60,sword1:50,sword2:51,sword3:52,sword4:53,sword5:54,shield0:61,shield1:55,shield2:56,shield3:57,shield4:58,shield5:59,book:9,fly:12,pickaxe:45,icePickaxe:44,bomb:43,centerFly:13,upFly:15,downFly:14,coin:11,snow:41,cross:40,superPotion:29,earthquake:8,poisonWine:24,weakWine:25,curseWine:27,superWine:28,knife:42,moneyPocket:46,shoes:47,hammer:48,jumpShoes:49,skill1:30,wand:10,I300:5,I301:7,I302:26,I303:31,I304:32,I305:34,I306:35,I307:36,I308:37,I309:38,I310:39},autotile:{autotile:0,autotile1:0,autotile2:0,autotile3:0}};var maps_90f36752_8815_4be8_b32b_d7fad1d0542e={"1":{cls:"terrains",id:"yellowWall",canBreak:true,trigger:"specialwall"},"2":{cls:"terrains",id:"whiteWall",canBreak:true,trigger:"specialwall"},"3":{cls:"terrains",id:"blueWall",canBreak:true,trigger:"fakeWall"},"4":{cls:"animates",id:"star",noPass:true},"5":{cls:"animates",id:"lava",noPass:true},"6":{cls:"terrains",id:"ice"},"7":{cls:"terrains",id:"blueShop-left"},"8":{cls:"terrains",id:"blueShop-right"},"9":{cls:"terrains",id:"pinkShop-left"},"10":{cls:"terrains",id:"pinkShop-right"},"11":{cls:"animates",id:"lavaNet",noPass:false,trigger:"passNet"},"12":{cls:"animates",id:"poisonNet",noPass:false,trigger:"passNet"},"13":{cls:"animates",id:"weakNet",noPass:false,trigger:"passNet"},"14":{cls:"animates",id:"curseNet",noPass:false,trigger:"passNet"},"15":{cls:"animates",id:"blueWater",noPass:true},"16":{cls:"animates",id:"water",noPass:true},"20":{cls:"autotile",id:"autotile",noPass:true},"21":{cls:"items",id:"yellowKey"},"22":{cls:"items",id:"blueKey"},"23":{cls:"items",id:"redKey"},"24":{cls:"items",id:"greenKey"},"25":{cls:"items",id:"steelKey"},"26":{cls:"items",id:"bigKey"},"27":{cls:"items",id:"redJewel"},"28":{cls:"items",id:"blueJewel"},"29":{cls:"items",id:"greenJewel"},"30":{cls:"items",id:"yellowJewel"},"31":{cls:"items",id:"redPotion"},"32":{cls:"items",id:"bluePotion"},"33":{cls:"items",id:"greenPotion"},"34":{cls:"items",id:"yellowPotion"},"35":{cls:"items",id:"sword1"},"36":{cls:"items",id:"shield1"},"37":{cls:"items",id:"sword2"},"38":{cls:"items",id:"shield2"},"39":{cls:"items",id:"sword3"},"40":{cls:"items",id:"shield3"},"41":{cls:"items",id:"sword4"},"42":{cls:"items",id:"shield4"},"43":{cls:"items",id:"sword5"},"44":{cls:"items",id:"shield5"},"45":{cls:"items",id:"book"},"46":{cls:"items",id:"fly"},"47":{cls:"items",id:"pickaxe"},"48":{cls:"items",id:"icePickaxe"},"49":{cls:"items",id:"bomb"},"50":{cls:"items",id:"centerFly"},"51":{cls:"items",id:"upFly"},"52":{cls:"items",id:"downFly"},"53":{cls:"items",id:"coin"},"54":{cls:"items",id:"snow"},"55":{cls:"items",id:"cross"},"56":{cls:"items",id:"superPotion"},"57":{cls:"items",id:"earthquake"},"58":{cls:"items",id:"poisonWine"},"59":{cls:"items",id:"weakWine"},"60":{cls:"items",id:"curseWine"},"61":{cls:"items",id:"superWine"},"62":{cls:"items",id:"knife"},"63":{cls:"items",id:"moneyPocket"},"64":{cls:"items",id:"shoes"},"65":{cls:"items",id:"hammer"},"68":{cls:"items",id:"lifeWand"},"69":{cls:"items",id:"jumpShoes"},"70":{cls:"items",id:"sword0"},"71":{cls:"items",id:"shield0"},"72":{cls:"items",id:"skill1"},"73":{cls:"items",id:"wand"},"81":{cls:"terrains",id:"yellowDoor",trigger:"openDoor"},"82":{cls:"terrains",id:"blueDoor",trigger:"openDoor"},"83":{cls:"terrains",id:"redDoor",trigger:"openDoor"},"84":{cls:"terrains",id:"greenDoor",trigger:"openDoor"},"85":{cls:"terrains",id:"specialDoor",trigger:"openDoor"},"86":{cls:"terrains",id:"steelDoor",trigger:"openDoor"},"87":{cls:"terrains",id:"upFloor",noPass:false},"88":{cls:"terrains",id:"downFloor",noPass:false},"89":{cls:"animates",id:"portal",noPass:false},"90":{cls:"animates",id:"starPortal",noPass:false},"91":{cls:"animates",id:"upPortal",noPass:false},"92":{cls:"animates",id:"leftPortal",noPass:false},"93":{cls:"animates",id:"downPortal",noPass:false},"94":{cls:"animates",id:"rightPortal",noPass:false},"101":{cls:"animates",id:"crystalUp"},"102":{cls:"animates",id:"crystalBottom"},"103":{cls:"animates",id:"fire"},"104":{cls:"animates",id:"switch"},"121":{cls:"npcs",id:"man",trigger:"man"},"122":{cls:"npcs",id:"woman",trigger:"woman"},"123":{cls:"npcs",id:"thief"},"124":{cls:"npcs",id:"fairy"},"125":{cls:"npcs",id:"magician"},"126":{cls:"npcs",id:"womanMagician"},"127":{cls:"npcs",id:"oldMan"},"128":{cls:"npcs",id:"child"},"129":{cls:"npcs",id:"wood"},"130":{cls:"npcs",id:"pinkShop"},"131":{cls:"npcs",id:"blueShop"},"132":{cls:"npcs",id:"princess"},"133":{cls:"npc48",id:"npc0"},"134":{cls:"npc48",id:"npc1"},"135":{cls:"npc48",id:"npc2"},"136":{cls:"npc48",id:"npc3"},"137":{cls:"npc48",id:"npc4"},"151":{cls:"autotile",id:"autotile1",noPass:true},"152":{cls:"autotile",id:"autotile2",noPass:true},"153":{cls:"autotile",id:"autotile3",noPass:true},"161":{cls:"terrains",id:"arrowUp",noPass:false,cannotOut:["left","right","down"],cannotIn:["down"]},"162":{cls:"terrains",id:"arrowDown",noPass:false,cannotOut:["left","right","up"],cannotIn:["up"]},"163":{cls:"terrains",id:"arrowLeft",noPass:false,cannotOut:["up","down","right"],cannotIn:["right"]},"164":{cls:"terrains",id:"arrowRight",noPass:false,cannotOut:["up","down","left"],cannotIn:["left"]},"165":{cls:"terrains",id:"light",trigger:"changeLight",noPass:false},"166":{cls:"terrains",id:"darkLight",noPass:true},"167":{cls:"terrains",id:"ski",trigger:"ski",noPass:false},"168":{cls:"terrains",id:"flower",noPass:false},"169":{cls:"terrains",id:"box",trigger:"pushBox",noPass:true},"170":{cls:"terrains",id:"boxed",trigger:"pushBox",noPass:true},"181":{cls:"npcs",id:"wlt"},"182":{cls:"npcs",id:"wt"},"183":{cls:"npcs",id:"wrt"},"184":{cls:"npcs",id:"wl"},"185":{cls:"npcs",id:"wc"},"186":{cls:"npcs",id:"wr"},"187":{cls:"npcs",id:"wlb"},"188":{cls:"npcs",id:"wrb"},"189":{cls:"npcs",id:"dlt"},"190":{cls:"npcs",id:"dt"},"191":{cls:"npcs",id:"drt"},"192":{cls:"npcs",id:"dl"},"193":{cls:"npcs",id:"dc"},"194":{cls:"npcs",id:"dr"},"195":{cls:"npcs",id:"dlb"},"196":{cls:"npcs",id:"drb"},"201":{cls:"enemys",id:"greenSlime"},"202":{cls:"enemys",id:"redSlime"},"203":{cls:"enemys",id:"blackSlime"},"204":{cls:"enemys",id:"slimelord"},"205":{cls:"enemys",id:"bat"},"206":{cls:"enemys",id:"bigBat"},"207":{cls:"enemys",id:"redBat"},"208":{cls:"enemys",id:"vampire"},"209":{cls:"enemys",id:"skeleton"},"210":{cls:"enemys",id:"skeletonSoilder"},"211":{cls:"enemys",id:"skeletonCaptain"},"212":{cls:"enemys",id:"ghostSkeleton"},"213":{cls:"enemys",id:"zombie"},"214":{cls:"enemys",id:"zombieKnight"},"215":{cls:"enemys",id:"rock"},"216":{cls:"enemys",id:"slimeMan"},"217":{cls:"enemys",id:"bluePriest"},"218":{cls:"enemys",id:"redPriest"},"219":{cls:"enemys",id:"brownWizard"},"220":{cls:"enemys",id:"redWizard"},"221":{cls:"enemys",id:"yellowGuard"},"222":{cls:"enemys",id:"blueGuard"},"223":{cls:"enemys",id:"redGuard"},"224":{cls:"enemys",id:"swordsman"},"225":{cls:"enemys",id:"soldier"},"226":{cls:"enemys",id:"yellowKnight"},"227":{cls:"enemys",id:"redKnight"},"228":{cls:"enemys",id:"darkKnight"},"229":{cls:"enemys",id:"blackKing"},"230":{cls:"enemys",id:"yellowKing"},"231":{cls:"enemys",id:"greenKing"},"232":{cls:"enemys",id:"blueKnight"},"233":{cls:"enemys",id:"goldSlime"},"234":{cls:"enemys",id:"poisonSkeleton"},"235":{cls:"enemys",id:"poisonBat"},"236":{cls:"enemys",id:"steelRock"},"237":{cls:"enemys",id:"skeletonPriest"},"238":{cls:"enemys",id:"skeletonKing"},"239":{cls:"enemys",id:"skeletonWizard"},"240":{cls:"enemys",id:"redSkeletonCaption"},"241":{cls:"enemys",id:"badHero"},"242":{cls:"enemys",id:"demon"},"243":{cls:"enemys",id:"demonPriest"},"244":{cls:"enemys",id:"goldHornSlime"},"245":{cls:"enemys",id:"redKing"},"246":{cls:"enemys",id:"whiteKing"},"247":{cls:"enemys",id:"blackMagician"},"248":{cls:"enemys",id:"silverSlime"},"249":{cls:"enemys",id:"swordEmperor"},"250":{cls:"enemys",id:"whiteHornSlime"},"251":{cls:"enemys",id:"badPrincess"},"252":{cls:"enemys",id:"badFairy"},"253":{cls:"enemys",id:"grayPriest"},"254":{cls:"enemys",id:"redSwordsman"},"255":{cls:"enemys",id:"whiteGhost"},"256":{cls:"enemys",id:"poisonZombie"},"257":{cls:"enemys",id:"magicDragon"},"258":{cls:"enemys",id:"octopus"},"259":{cls:"enemys",id:"darkFairy"},"260":{cls:"enemys",id:"greenKnight"},"261":{cls:"enemy48",id:"angel"},"262":{cls:"enemy48",id:"elemental"},"263":{cls:"enemy48",id:"steelGuard"},"264":{cls:"enemy48",id:"evilBat"},"300":{cls:"items",id:"I300"},"301":{cls:"items",id:"I301"},"302":{cls:"items",id:"I302"},"303":{cls:"items",id:"I303"},"304":{cls:"items",id:"I304"},"305":{cls:"items",id:"I305"},"306":{cls:"items",id:"I306"},"307":{cls:"items",id:"I307"},"308":{cls:"items",id:"I308"},"309":{cls:"items",id:"I309"},"310":{cls:"items",id:"I310"},"311":{cls:"terrains",id:"ground"},"312":{cls:"terrains",id:"grass"},"313":{cls:"terrains",id:"grass2"},"314":{cls:"terrains",id:"snowGround"},"315":{cls:"terrains",id:"ground2"},"316":{cls:"terrains",id:"ground3"},"317":{cls:"terrains",id:"ground4"},"318":{cls:"terrains",id:"sand"},"319":{cls:"terrains",id:"ground5"},"320":{cls:"terrains",id:"yellowWall2"},"321":{cls:"terrains",id:"whiteWall2"},"322":{cls:"terrains",id:"blueWall2"},"323":{cls:"terrains",id:"blockWall"},"324":{cls:"terrains",id:"grayWall"},"325":{cls:"terrains",id:"white"},"326":{cls:"terrains",id:"ground6"},"327":{cls:"terrains",id:"soil"},"328":{cls:"terrains",id:"ground7"},"329":{cls:"terrains",id:"ground8"},"330":{cls:"terrains",id:"T330",noPass:"true"}};var items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a={items:{yellowKey:{cls:"keys",name:"黄钥匙"},blueKey:{cls:"keys",name:"蓝钥匙"},redKey:{cls:"keys",name:"红钥匙"},redJewel:{cls:"items",name:"红宝石",text:"'，攻击+'+core.values.redJewel"},blueJewel:{cls:"items",name:"蓝宝石",text:"'，防御+'+core.values.blueJewel"},greenJewel:{cls:"items",name:"绿宝石",text:"'，魔防+'+core.values.greenJewel"},yellowJewel:{cls:"items",name:"黄宝石",text:"可以进行加点"},redPotion:{cls:"items",name:"红血瓶",text:"'，生命+'+core.values.redPotion"},bluePotion:{cls:"items",name:"蓝血瓶",text:"'，生命+'+core.values.bluePotion"},yellowPotion:{cls:"items",name:"黄血瓶",text:"'生命+'+core.values.yellowPotion"},greenPotion:{cls:"items",name:"绿血瓶",text:"'，生命+'+core.values.greenPotion"},sword0:{cls:"items",name:"破旧的剑",text:"一把已经生锈的剑",equip:{type:0,atk:0,animate:"sword"}},sword1:{cls:"items",name:"铁剑",text:"一把很普通的铁剑",equip:{type:0,atk:10,animate:"sword"}},sword2:{cls:"items",name:"银剑",text:"一把很普通的银剑",equip:{type:0,atk:20,animate:"sword"}},sword3:{cls:"items",name:"骑士剑",text:"一把很普通的骑士剑",equip:{type:0,atk:40,animate:"sword"}},sword4:{cls:"items",name:"圣剑",text:"一把很普通的圣剑",equip:{type:0,atk:80,animate:"sword"}},sword5:{cls:"items",name:"神圣剑",text:"一把很普通的神圣剑",equip:{type:0,atk:100,animate:"sword"}},shield0:{cls:"items",name:"破旧的盾",text:"一个很破旧的铁盾",equip:{type:1,def:0}},shield1:{cls:"items",name:"铁盾",text:"一个很普通的铁盾",equip:{type:1,def:10}},shield2:{cls:"items",name:"银盾",text:"一个很普通的银盾",equip:{type:1,def:20}},shield3:{cls:"items",name:"骑士盾",text:"一个很普通的骑士盾",equip:{type:1,def:40}},shield4:{cls:"items",name:"圣盾",text:"一个很普通的圣盾",equip:{type:1,def:80}},shield5:{cls:"items",name:"神圣盾",text:"一个很普通的神圣盾",equip:{type:1,def:100}},superPotion:{cls:"tools",name:"圣水",text:"增加7.4倍攻防和的生命"},moneyPocket:{cls:"items",name:"金钱袋"},book:{cls:"constants",name:"怪物手册",text:"可以查看当前楼层各怪物属性"},fly:{cls:"constants",name:"飞行法杖",text:"可以自由往来去过的楼层",hideInReplay:true},coin:{cls:"constants",name:"幸运金币",text:"持有时打败怪物可得双倍金币"},snow:{cls:"constants",name:"冰冻徽章",text:"可以将四周的熔岩变成平地"},cross:{cls:"constants",name:"十字架",text:"对兽人族和吸血鬼攻击加倍"},knife:{cls:"constants",name:"屠龙匕",text:"对魔龙攻击加倍"},shoes:{cls:"constants",name:"绿鞋",text:"持有时无视负面地形"},bigKey:{cls:"tools",name:"魔法钥匙",text:"可以开启当前层所有黄门"},greenKey:{cls:"tools",name:"绿钥匙",text:"可以打开一扇绿门"},steelKey:{cls:"tools",name:"铁门钥匙",text:"可以打开一扇铁门"},pickaxe:{cls:"tools",name:"破墙镐",text:"可以破坏勇士面前的墙"},icePickaxe:{cls:"tools",name:"破冰镐",text:"可以破坏勇士面前的一堵冰墙"},bomb:{cls:"tools",name:"炸弹",text:"可以炸掉勇士面前的怪物"},centerFly:{cls:"tools",name:"瞬移",text:"可以飞向当前楼层中心对称的位置"},upFly:{cls:"tools",name:"升华之翼",text:"可以飞往楼上的相同位置"},downFly:{cls:"tools",name:"降临之翼",text:"可以飞往楼下的相同位置"},earthquake:{cls:"tools",name:"地震卷轴",text:"可以破坏当前层的所有墙"},poisonWine:{cls:"tools",name:"解毒药水",text:"可以解除中毒状态"},weakWine:{cls:"tools",name:"解衰药水",text:"可以解除衰弱状态"},curseWine:{cls:"tools",name:"解咒药水",text:"可以解除诅咒状态"},superWine:{cls:"tools",name:"万能药水",text:"可以解除所有不良状态"},hammer:{cls:"tools",name:"圣锤",text:"可以炸掉勇士面前的怪物"},lifeWand:{cls:"tools",name:"生命魔杖",text:"可以恢复100点生命值"},jumpShoes:{cls:"tools",name:"跳跃靴",text:"能跳跃到前方两格处"},skill1:{cls:"constants",name:"技能：二倍斩",text:"可以打开或关闭主动技能二倍斩",hideInReplay:true},wand:{cls:"constants",name:"记事本",text:"可以记录并查看老人和商人说的话"},I300:{cls:"constants",name:"帮助",text:"使用后可以查看帮助",hideInReplay:true},I301:{cls:"items",name:"新物品"},I302:{cls:"items",name:"新物品"},I303:{cls:"items",name:"新物品"},I304:{cls:"items",name:"新物品"},I305:{cls:"items",name:"新物品"},I306:{cls:"items",name:"新物品"},I307:{cls:"items",name:"新物品"},I308:{cls:"items",name:"新物品"},I309:{cls:"items",name:"新物品"},I310:{cls:"items",name:"新物品"}},itemEffect:{redJewel:'core.status.hero.atk += core.values.redJewel * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, "") / 10);',blueJewel:'core.status.hero.def += core.values.blueJewel * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, "") / 10);',greenJewel:"core.status.hero.mdef += core.values.greenJewel * ratio",yellowJewel:"core.status.hero.hp+=1000;core.status.hero.atk+=6;core.status.hero.def+=6;core.status.hero.mdef+=10;",redPotion:'core.status.hero.hp += core.values.redPotion * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, "") / 10);',bluePotion:'core.status.hero.hp += core.values.bluePotion * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, "") / 10);',yellowPotion:"core.status.hero.hp += core.values.yellowPotion * ratio",greenPotion:"core.status.hero.hp += core.values.greenPotion * ratio",sword0:"core.status.hero.atk += 0",sword1:"core.status.hero.atk += 10, core.setFlag('nowWeapon', 'sword1')",sword2:"core.status.hero.atk += 20, core.setFlag('nowWeapon', 'sword2')",sword3:"core.status.hero.atk += 40, core.setFlag('nowWeapon', 'sword3')",sword4:"core.status.hero.atk += 50, core.setFlag('nowWeapon', 'sword4')",sword5:"core.status.hero.atk += 100, core.setFlag('nowWeapon', 'sword5')",shield0:"core.status.hero.def += 0",shield1:"core.status.hero.def += 10, core.setFlag('nowShield', 'shield1')",shield2:"core.status.hero.def += 20, core.setFlag('nowShield', 'shield2')",shield3:"core.status.hero.def += 40, core.setFlag('nowShield', 'shield3')",shield4:"core.status.hero.def += 50, core.setFlag('nowShield', 'shield4')",shield5:"core.status.hero.def += 100, core.setFlag('nowShield', 'shield5');\ncore.setFlag('shield5', 1);",bigKey:"core.status.hero.items.keys.yellowKey++;core.status.hero.items.keys.blueKey++;core.status.hero.items.keys.redKey++;",superPotion:"core.status.hero.hp *= 2",moneyPocket:"core.status.hero.money += 500"},itemEffectTip:{redJewel:"'，提升 ' + core.values.redJewel * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, \"\") / 10) + ' 点攻击';",blueJewel:"'，提升 ' + core.values.blueJewel * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, \"\") / 10) + ' 点防御';",greenJewel:"'，魔防+'+core.values.greenJewel * ratio",yellowJewel:"'，全属性提升'",redPotion:"'，提升 ' + core.values.redPotion * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, \"\") / 10) + ' 点生命';",bluePotion:"'，提升 ' + core.values.bluePotion * Math.ceil(core.status.floorId.replace(/[^0-9]/ig, \"\") / 10) + ' 点生命';",yellowPotion:"'，生命+'+core.values.yellowPotion * ratio",greenPotion:"'，生命+'+core.values.greenPotion * ratio",sword0:"'，攻击+0'",sword1:"'，提升 10 点攻击'",sword2:"'，提升 20 点攻击'",sword3:"'，提升 40 点攻击'",sword4:"'，提升 50 点攻击'",sword5:"'，提升 100 点攻击'",shield0:"'，防御+0'",shield1:"'，提升 10 点防御'",shield2:"'，提升 20 点防御'",shield3:"'，提升 40 点防御'",shield4:"'，提升 50 点防御'",shield5:"'，提升 100 点防御，并免疫魔法伤害'",bigKey:"'，全钥匙+1'",superPotion:"'，生命值翻倍'",moneyPocket:"'，金币+500'"},useItemEffect:{book:"core.ui.drawBook(0);",fly:"core.ui.drawFly(core.floorIds.indexOf(core.status.floorId));",earthquake:"core.playSound('door.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",pickaxe:"core.playSound('pickaxe.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功, 周围的墙被破坏了');\n\tcore.setFlag('talking', 0);\n});",icePickaxe:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n});",snow:"core.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功, 岩浆凝固成了石头');\n});",bigKey:'(function () {\n\tvar actions = core.status.event.ui.map(function (id) {\n\t\tvar block = core.status.thisMap.blocks[id];\n\t\treturn { "type": "openDoor", "loc": [block.x, block.y], "async": true };\n\t});\n\tactions.push({ "type": "waitAsync" });\n\tactions.push({ "type": "tip", "text": core.material.items[itemId].name + "使用成功" });\n\tcore.insertAction(actions);\n})();',bomb:"core.playSound('bomb.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功，你获得了 ' + core.getFlag('bomb') + ' 金币');\n\tcore.events.afterUseBomb();\n\tcore.setFlag('talking', 0);\n});",hammer:"core.playSound('bomb.mp3');\ncore.removeBlockByIds(core.status.floorId, core.status.event.ui);\ncore.drawMap(core.status.floorId, function () {\n\tcore.drawTip(core.material.items[itemId].name + '使用成功');\n\tcore.events.afterUseBomb();\n});",centerFly:"core.playSound('centerFly.mp3');\ncore.clearMap('hero');\ncore.setHeroLoc('x', core.bigmap.width - 1 - core.getHeroLoc('x'));\ncore.setHeroLoc('y', core.bigmap.height - 1 - core.getHeroLoc('y'));\ncore.drawHero();\ncore.setFlag('talking', 0);\ncore.drawTip(core.material.items[itemId].name + '使用成功');",upFly:'var loc = {\'direction\': core.status.hero.loc.direction, \'x\': core.status.event.ui.x, \'y\': core.status.event.ui.y};\nif (core.status.event.id == \'action\') {\n\tcore.insertAction([\n\t\t{"type": "changeFloor", "loc": [loc.x, loc.y], "direction": loc.direction, "floorId": core.status.event.ui.id},\n\t\t{"type": "tip", "text": core.material.items[itemId].name + \'使用成功\'}\n\t]);\n}\nelse {\n\tcore.changeFloor(core.status.event.ui.id, null, loc, null, function (){\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\tcore.replay();\n\t});\n}',downFly:'var loc = {\'direction\': core.status.hero.loc.direction, \'x\': core.status.event.ui.x, \'y\': core.status.event.ui.y};\nif (core.status.event.id == \'action\') {\n\tcore.insertAction([\n\t\t{"type": "changeFloor", "loc": [loc.x, loc.y], "direction": loc.direction, "floorId": core.status.event.ui.id},\n\t\t{"type": "tip", "text": core.material.items[itemId].name + \'使用成功\'}\n\t]);\n}\nelse {\n\tcore.changeFloor(core.status.event.ui.id, null, loc, null, function (){\n\tcore.drawTip(core.material.items[itemId].name + \'使用成功\');\n\t\tcore.replay();\n\t});\n}\n',poisonWine:"core.removeFlag('poison');",weakWine:'core.removeFlag(\'weak\');\nif (core.values.weakValue>=1) { // >=1：直接扣数值\n\tcore.status.hero.atk += core.values.weakValue;\n\tcore.status.hero.def += core.values.weakValue;\n}\nelse { // <1：扣比例\n\tcore.addBuff("atk", core.values.weakValue);\n\tcore.addBuff("def", core.values.weakValue);\n}',curseWine:"core.removeFlag('curse');",superWine:"core.removeFlag('poison');\nif (core.hasFlag('weak')) {\n\tcore.removeFlag('weak');\n\tif (core.values.weakValue>=1) { // >=1：直接扣数值\n\t\tcore.status.hero.atk += core.values.weakValue;\n\t\tcore.status.hero.def += core.values.weakValue;\n\t}\n\telse { // <1：扣比例\n\t\tcore.addBuff(\"atk\", core.values.weakValue);\n\t\tcore.addBuff(\"def\", core.values.weakValue);\n\t}\n}\ncore.removeFlag('curse');",lifeWand:'core.insertAction([\n\t{"type": "input", "text": "请输入生命魔杖使用次数：(0-${item:lifeWand})"},\n\t{"type": "if", "condition": "flag:input<=item:lifeWand",\n\t\t"true": [\n\t\t\t{"type": "setValue", "name": "item:lifeWand", "value": "item:lifeWand-flag:input"},\n\t\t\t{"type": "setValue", "name": "status:hp", "value": "status:hp+flag:input*100"},\n\t\t\t"成功使用${flag:input}次生命魔杖，恢复${flag:input*100}点生命。"\n\t\t],\n\t\t"false": ["输入不合法！"]\n\t},\n]);\ncore.addItem(\'lifeWand\', 1);',jumpShoes:'core.insertAction({"type":"jumpHero","loc":[core.nextX(2),core.nextY(2)]});',redPotion:"core.status.hero.hp += core.values.redPotion",bluePotion:"core.status.hero.hp += core.values.bluePotion",greenPotion:"core.status.hero.hp += core.values.greenPotion",yellowPotion:"core.status.hero.hp += core.values.yellowPotion",redJewel:"core.status.hero.atk += core.values.redJewel",blueJewel:"core.status.hero.def += core.values.blueJewel",greenJewel:"core.status.hero.mdef += core.values.greenJewel",yellowJewel:'core.insertAction([\n\t{"type": "choices", "choices": [\n\t\t{"text": "攻击+1", "action": [\n\t\t\t{"type": "setValue", "name": "status:atk", "value": "status:atk+1"}\n\t\t]},\n\t\t{"text": "防御+2", "action": [\n\t\t\t{"type": "setValue", "name": "status:def", "value": "status:def+2"}\n\t\t]},\n\t\t{"text": "生命+200", "action": [\n\t\t\t{"type": "setValue", "name": "status:hp", "value": "status:hp+200"}\n\t\t]},\n\t]}\n]);',skill1:"// 二倍斩的flag:skill为1\nif (core.getFlag('skill', 0)==0) { // 判断当前是否已经开了技能\n\tif (core.getStatus('mana')>=5) { // 这里要写当前能否开技能的条件判断，比如魔力值至少要多少\n\t\tcore.setFlag('skill', 1); // 开技能1\n\t\tcore.setFlag('skillName', '二倍斩'); // 设置技能名\n\t}\n\telse {\n\t\tcore.drawTip(\"魔力不足，无法开启技能\");\n\t}\n}\nelse { // 关闭技能\n\tcore.setFlag('skill', 0); // 关闭技能状态\n\tcore.setFlag('skillName', '无');\n}",superPotion:'var hp = Math.round(7.4 * (core.status.hero.atk + core.status.hero.def))\ncore.status.hero.hp += hp;\ncore.insertAction([\n\t{ "type": "playSound", "name": "item.mp3" },\n\t{ "type": "tip", "text": "使用圣水，增加 " + hp + " 生命" },\n]);',I300:'core.insertAction([\n\t{ "type": "insert", "name": "回收钥匙商店" },\n]);',wand:'core.insertAction("记事本")'},canUseItemEffect:{book:"true",fly:"(function () {\n\treturn core.status.maps[core.status.floorId].canFlyTo;\n})();",pickaxe:"(function() {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && core.nearHero(block.x, block.y) && \n\t\t\t(block.event.canBreak || block.event.id == 'yellowWall' || block.event.id=='whiteWall' || block.event.id=='blueWall')) { // 能破哪些墙\n\t\t\t// 四个方向\n\t\t\tif (core.flags.pickaxeFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse id2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\telse if (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",icePickaxe:"(function() {\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.x==core.nextX() && block.y==core.nextY() && block.event.id=='ice') {\n\t\t\tcore.status.event.ui = [i];\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",bomb:"(function () {\n\tvar x = core.status.hero.loc.x;\n\tvar y = core.status.hero.loc.y;\n\tvar p = new Array(x, y - 1, x - 1, y, x + 1, y, x, y + 1);\n\tvar bomb = 0;\n\tfor (var j = 0; j < 4; j++) {\n\t\tvar m = p[2 * j];\n\t\tvar n = p[2 * j + 1];\n\t\tvar a = core.getBlockId(m, n);\n\t\tif (core.getBlockCls(m, n, 0) == 'enemys') {\n\t\t\tbomb += core.material.enemys[a].money;\n\t\t}\n\t}\n\tcore.setFlag('bomb', bomb);\n\n\tvar ids = [],\n\t\tid2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.cls.indexOf('enemy') == 0 && core.nearHero(block.x, block.y)) {\n\t\t\tvar enemy = core.material.enemys[block.event.id];\n\t\t\tif (core.isset(enemy) && enemy.notBomb) continue;\n\t\t\tif (core.flags.bombFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse\n\t\t\t\tid2s.push(i);\n\t\t}\n\t}\n\tif (ids.length > 0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\tif (id2s.length == 1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",hammer:"(function() {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.cls.indexOf('enemy')==0 && core.nearHero(block.x, block.y)) {\n\t\t\tvar enemy = core.material.enemys[block.event.id];\n\t\t\tif (core.isset(enemy) && enemy.notBomb) continue;\n\t\t\tif (block.x==core.nextX() && block.y==core.nextY())\n\t\t\t\tids.push(i);\n\t\t\telse\n\t\t\t\tid2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\telse if (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",earthquake:"(function () {\n\tvar able=false;\n\tvar ids = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable &&\n\t\t\t(block.event.canBreak || block.event.id == 'yellowWall' || block.event.id == 'blueWall' || block.event.id == 'whiteWall')) { // 能炸的墙壁\n\t\t\tids.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\table=true;\n\t}\n\treturn able;\n})();",centerFly:"(function () {\n\tvar toX = core.bigmap.width-1-core.getHeroLoc('x'), toY = core.bigmap.height-1-core.getHeroLoc('y');\n\tvar id = core.getBlockId(toX, toY);\n\treturn id == null;\n})();",upFly:"(function () {\n\tvar floorId = core.status.floorId,\n\t\tindex = core.floorIds.indexOf(floorId);\n\tif (index < core.floorIds.length - 1) {\n\t\tvar toId = core.floorIds[index + 1],\n\t\t\ttoX = core.getHeroLoc('x'),\n\t\t\ttoY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width,\n\t\t\tmh = core.floors[toId].height;\n\t\tif (toX >= 0 && toX < mw && toY >= 0 && toY < mh && core.getBlock(toX, toY, toId) == null) {\n\t\t\tcore.status.event.ui = { 'id': toId, 'x': toX, 'y': toY };\n\t\t\tif (core.status.floorId == \"MT49\") return false;\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",downFly:"(function () {\n\tvar floorId = core.status.floorId,\n\t\tindex = core.floorIds.indexOf(floorId);\n\tif (index > 0) {\n\t\tvar toId = core.floorIds[index - 1],\n\t\t\ttoX = core.getHeroLoc('x'),\n\t\t\ttoY = core.getHeroLoc('y');\n\t\tvar mw = core.floors[toId].width,\n\t\t\tmh = core.floors[toId].height;\n\t\tif (toX >= 0 && toX < mw && toY >= 0 && toY < mh && core.getBlock(toX, toY, toId) == null) {\n\t\t\tcore.status.event.ui = { 'id': toId, 'x': toX, 'y': toY };\n\t\t\tif (core.status.floorId == \"MT50\") return false;\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n})();",snow:"(function () {\n\tvar ids = [], id2s = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.id == 'lava' && core.nearHero(block.x, block.y)) {\n\t\t\tif (core.flags.snowFourDirections || (block.x == core.nextX() && block.y == core.nextY()))\n\t\t\t\tids.push(i);\n\t\t\telse id2s.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\treturn true;\n\t}\n\tif (id2s.length==1) {\n\t\tcore.status.event.ui = id2s;\n\t\treturn true;\n\t}\n\treturn false;\n})();",bigKey:"(function() {\n\tvar able=false, ids = [];\n\tfor (var i in core.status.thisMap.blocks) {\n\t\tvar block = core.status.thisMap.blocks[i];\n\t\tif (!block.disable && block.event.id == 'yellowDoor') {\n\t\t\tids.push(i);\n\t\t}\n\t}\n\tif (ids.length>0) {\n\t\tcore.status.event.ui = ids;\n\t\table=true;\n\t}\n\treturn able;\n})();",poisonWine:"core.hasFlag('poison');",weakWine:"core.hasFlag('weak');",curseWine:"core.hasFlag('curse');",superWine:"(function() {\n\treturn core.hasFlag('poison') || core.hasFlag('weak') || core.hasFlag('curse');\n})();",lifeWand:"true",jumpShoes:"(function() {\n\tvar nx=core.nextX(2), ny=core.nextY(2);\n\treturn nx>=0 && nx<core.bigmap.width && ny>=0 && ny<core.bigmap.height && core.getBlockId(nx,ny)==null;\n})();",redPotion:"true",bluePotion:"true",greenPotion:"true",yellowPotion:"true",redJewel:"true",blueJewel:"true",greenJewel:"true",yellowJewel:"true",skill1:"true",superPotion:"1",I300:1,wand:"true"},canEquip:{},equipCondition:{}};var functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a={events:{resetGame:function(d,c,a,f,g){core.clearStatus();core.status=core.clone(core.initStatus);core.status.played=true;core.status.hero=core.clone(d);core.events.setHeroIcon(core.getFlag("heroIcon","hero.png"),true);core.control._initStatistics(core.animateFrame.totalTime);core.status.hero.statistics.totalTime=core.animateFrame.totalTime=Math.max(core.status.hero.statistics.totalTime,core.animateFrame.totalTime);core.status.hero.statistics.start=null;core.status.hard=c||"";core.status.floorId=a;core.status.maps=core.clone(f);core.material.enemys=core.enemys.getEnemys();core.material.items=core.items.getItems();core.items._resetItems();core.values=core.clone(core.data.values);for(var e in g||{}){core.values[e]=g[e]}core.flags=core.clone(core.data.flags);var b=core.getFlag("globalFlags",{});for(var e in b){core.flags[e]=b[e]}core._init_sys_flags();core.resize();core.updateGlobalAttribute();if(core.hasFlag("hideStatusBar")){core.hideStatusBar(core.hasFlag("showToolbox"))}else{core.showStatusBar()}core.dom.musicBtn.style.display="none"},setInitData:function(){if(core.status.hard=="Easy"){core.setFlag("hard",1)}if(core.status.hard=="Normal"){core.setFlag("hard",2)}if(core.status.hard=="Hard"){core.setFlag("hard",3)}if(core.status.hard=="Hell"){core.setFlag("hard",4)}core.setFlag("__visited__",{});core.updateEnemys()},win:function(b,a){core.ui.closePanel();var c=core.isReplaying();if(c){core.stopReplay()}core.waitHeroToStop(function(){core.clearMap("all");core.deleteAllCanvas();core.dom.gif2.innerHTML="";core.drawText(["\t["+(b||"恭喜通关")+"]你的分数是${status:hp}。"],function(){console.log("感谢游玩!");core.events.gameOver(b||"",c,a)})})},lose:function(a){core.ui.closePanel();var b=core.isReplaying();core.stopReplay();core.waitHeroToStop(function(){core.drawText(["\t["+("游戏失败")+"]你不幸死亡了，请重新开始。"],function(){core.events.gameOver(null,b)})})},changingFloor:function(d,f,e){var c=core.status.floorId||null;core.maps.resizeMap(d);if(!e){core.status.maps[d].blocks.forEach(function(h){if(h.disable&&core.enemys.hasSpecial(h.event.id,23)){h.disable=false}})}core.status.hero.loc=f;core.control.gatherFollowers();core.drawMap(d);if(core.status.maps[d].bgm){var a=core.status.maps[d].bgm;if(a instanceof Array){a=a[0]}a=core.getFlag("ScenarioBgm",a);core.playBgm(a)}var b=core.getFlag("__color__",null);if(!b&&core.status.maps[d].color){b=core.status.maps[d].color}core.clearMap("curtain");core.status.curtainColor=b;if(b){core.fillRect("curtain",0,0,core.__PIXELS__,core.__PIXELS__,core.arrayToRGBA(b))}var g=core.getFlag("__weather__",null);if(!g&&core.status.maps[d].weather){g=core.status.maps[d].weather}if(g){core.setWeather(g[0],g[1])}else{core.setWeather()}},afterChangeFloor:function(a,b,c){if(b){core.events.recoverEvents(core.getFlag("__events__"));core.removeFlag("__events__")}else{core.status.hero.loc.direction="down";core.drawHero();core.insertAction(core.floors[a].eachArrive);if(c._floorId==":next"){core.ui.statusBar.print("登上了楼梯")}else{if(c._floorId==":before"){core.ui.statusBar.print("走下了楼梯")}}if(!core.hasVisitedFloor(a)){core.insertAction(core.floors[a].firstArrive);core.visitFloor(a)}}},flyTo:function(e,a){var b=core.status.floorId;if(!core.status.maps[b].canFlyTo||!core.status.maps[e].canFlyTo){core.drawTip("无法飞往"+core.status.maps[e].title+"！");return false}var c=core.floorIds.indexOf(b),f=core.floorIds.indexOf(e);var d=c<=f?"downFloor":"upFloor";if(c==f&&core.status.maps[b].underGround){d="upFloor"}core.status.route.push("fly:"+e);core.ui.closePanel();core.changeFloor(e,d,null,null,a);core.setFlag("talking",0);return true},beforeBattle:function(c,f,g){if(f!=null&&g!=null){var e=f+","+g,b=core.status.checkBlock.cache[e]||{},d=b.guards||[];if(d.length>0){core.setFlag("__guards__"+f+"_"+g,d);var a=[];d.forEach(function(h){core.push(a,{type:"jump",from:[h[0],h[1]],to:[f,g],time:300,keep:false,async:true})});core.push(a,[{type:"waitAsync"},{type:"trigger",loc:[f,g]}]);core.insertAction(a);return false}}return true},afterBattle:function(d,o,p,a){var c=core.material.enemys[d];var e="hand",f=(core.status.hero.equipment||[])[0];if(f&&(core.material.items[f].equip||{}).animate){e=core.material.items[f].equip.animate}if(!(core.material.animates[e]||{}).se){core.playSound("attack.mp3")}core.drawImage("animate",core.statusBar.icons.battle,0,0,32,32,(o-1)*32,(p-1)*32,32,32);setTimeout(function(){core.clearMap("animate",(o-1)*32,(p-1)*32,32,32)},100);var b=core.enemys.getDamage(d,o,p);if(b==null){b=core.status.hero.hp+1}if(core.status.hero.hp<=b){core.status.hero.hp=0;core.updateStatusBar();core.events.lose("战斗失败");return}if(core.getFlag("addhp",0)==1){b*=-1}core.status.hero.hp-=b;core.status.hero.statistics.battleDamage+=b;core.status.hero.statistics.battle++;var h=[];if(o!=null&&p!=null){if(d=="octopus"||d=="magicDragon"){core.removeBlock(o-1,p-2);core.removeBlock(o-1,p-1);core.removeBlock(o-1,p);core.removeBlock(o,p-2);core.removeBlock(o,p-1);core.removeBlock(o,p);core.removeBlock(o+1,p-2);core.removeBlock(o+1,p-1);core.removeBlock(o+1,p)}else{core.removeBlock(o,p)}h=core.getFlag("__guards__"+o+"_"+p,[]);core.removeFlag("__guards__"+o+"_"+p)}var j=h.reduce(function(q,r){return q+core.material.enemys[r[2]].money},c.money);if(core.hasItem("coin")){j*=2}if(core.hasFlag("curse")){j=0}core.status.hero.money+=j;core.status.hero.statistics.money+=j;var g=h.reduce(function(q,r){return q+core.material.enemys[r[2]].experience},c.experience);if(core.hasFlag("curse")){g=0}core.status.hero.experience+=g;core.status.hero.statistics.experience+=g;var i=c.name+" 被打败了 ";if(core.flags.enableMoney){i+="，你获得了 "+j+" 金币"}if(core.flags.enableExperience){i+="，经验+"+g}core.ui.statusBar.print(i,2);var n=[];var m=c.special;if(core.enemys.hasSpecial(m,12)){core.push(n,[{type:"insert",name:"毒衰咒处理",args:[0]}])}if(core.enemys.hasSpecial(m,13)){core.push(n,[{type:"insert",name:"毒衰咒处理",args:[1]}])}if(core.enemys.hasSpecial(m,14)){core.push(n,[{type:"insert",name:"毒衰咒处理",args:[2]}])}if(core.flags.hatredDecrease&&core.enemys.hasSpecial(m,17)){core.setFlag("hatred",Math.floor(core.getFlag("hatred",0)/2))}if(core.enemys.hasSpecial(m,19)){core.status.hero.hp=1}if(core.enemys.hasSpecial(m,21)){core.status.hero.atk-=(c.atkValue||0);core.status.hero.def-=(c.defValue||0);if(core.status.hero.atk<0){core.status.hero.atk=0}if(core.status.hero.def<0){core.status.hero.def=0}}core.setFlag("hatred",core.getFlag("hatred",0)+core.values.hatred);if(core.flags.enableSkill){var l=core.getFlag("skill",0);if(l==1){core.status.hero.mana-=5}core.setFlag("skill",0);core.setFlag("skillName","无")}core.updateStatusBar();var k=core.material.enemys[d].point;if(core.flags.enableAddPoint&&k>0){core.push(n,[{type:"insert",name:"加点事件",args:[k]}])}core.push(n,core.floors[core.status.floorId].afterBattle[o+","+p]);core.setFlag("talking",0);if(n.length>0){core.insertAction(n,o,p)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(a){a()}},afterOpenDoor:function(b,e,f,a){core.setFlag("talking",0);if(b.endsWith("Wall")){core.ui.statusBar.print("墙壁倒塌了")}else{core.ui.statusBar.print("门被打开了")}var d=[];var c=core.floors[core.status.floorId].afterOpenDoor[e+","+f];if(c){core.unshift(d,c)}if(d.length>0){core.insertAction(d,e,f)}if(core.status.event.id==null){core.continueAutomaticRoute()}else{core.clearContinueAutomaticRoute()}if(a){a()}},afterGetItem:function(c,e,f,a){core.playSound("item.mp3");var d=[];var b=core.floors[core.status.floorId].afterGetItem[e+","+f];if(b){core.unshift(d,b)}if(d.length>0){core.insertAction(d,e,f)}if(a){a()}},afterChangeLight:function(a,b){},afterPushBox:function(){if(core.searchBlock("box").length==0){}},afterUseBomb:function(){if(core.getFlag("bomb")>0){core.status.hero.money+=core.getFlag("bomb")}if(core.status.floorId=="MT44"&&core.terrainExists(6,8,"specialDoor")&&!core.enemyExists(5,9)&&!core.enemyExists(7,9)){core.insertAction([{type:"openDoor",loc:[6,8]},])}if(core.status.floorId=="MT45"&&core.terrainExists(7,10,"specialDoor")&&!core.enemyExists(8,9)&&!core.enemyExists(8,11)){core.insertAction([{type:"openDoor",loc:[7,10]},])}if(core.status.floorId=="MT45"&&core.terrainExists(4,10,"specialDoor")&&!core.enemyExists(5,9)&&!core.enemyExists(5,11)){core.insertAction([{type:"openDoor",loc:[4,10]},])}if(core.status.floorId=="MT49"&&core.terrainExists(6,9,"specialDoor")&&!core.enemyExists(5,10)&&!core.enemyExists(7,10)){core.insertAction([{type:"openDoor",loc:[6,9]},])}if(core.status.floorId=="MT49"&&core.terrainExists(6,7,"specialDoor")&&!core.enemyExists(5,8)&&!core.enemyExists(7,8)){core.insertAction([{type:"if",condition:"(flag:炸弹不开门==1)","true":[],"false":[{type:"openDoor",loc:[6,7]},]},])}},canUseQuickShop:function(a){if(core.status.thisMap.canUseQuickShop===false){return"当前楼层不能使用快捷商店。"}return null}},enemys:{getSpecials:function(){return[[1,"先攻","怪物首先攻击"],[2,"魔攻","怪物无视勇士的防御"],[3,"坚固","勇士每回合最多只能对怪物造成1点伤害"],[4,"2连击","怪物每回合攻击2次"],[5,"3连击","怪物每回合攻击3次"],[6,function(a){return(a.n||4)+"连击"},function(a){return"怪物每回合攻击"+(a.n||4)+"次"}],[7,"破甲","战斗前，怪物附加角色防御的"+Math.floor(100*core.values.breakArmor||0)+"%作为伤害"],[8,"反击","战斗时，怪物每回合附加角色攻击的"+Math.floor(100*core.values.counterAttack||0)+"%作为伤害，无视角色防御"],[9,"净化","战斗前，怪物附加勇士魔防的"+core.values.purify+"倍作为伤害"],[10,"模仿","怪物的攻防和勇士攻防相等"],[11,"吸血",function(a){return"战斗前，怪物首先吸取角色的"+Math.floor(100*a.value||0)+"%生命（约"+Math.floor((a.value||0)*core.getStatus("hp"))+"点）作为伤害"+(a.add?"，并把伤害数值加到自身生命上":"")}],[12,"中毒","战斗后，勇士陷入中毒状态，每一步损失生命"+core.values.poisonDamage+"点"],[13,"衰弱","战斗后，勇士陷入衰弱状态，攻防暂时下降"+(core.values.weakValue>=1?core.values.weakValue+"点":parseInt(core.values.weakValue*100)+"%")],[14,"诅咒","战斗后，勇士陷入诅咒状态，战斗无法获得金币和经验"],[15,"领域",function(a){return"经过怪物周围"+(a.range||1)+"格时自动减生命"+(a.value||0)+"点"}],[16,"夹击","经过两只相同的怪物中间，勇士生命值变成一半"],[17,"仇恨","战斗前，怪物附加之前积累的仇恨值作为伤害"+(core.flags.hatredDecrease?"；战斗后，释放一半的仇恨值":"")+"。（每杀死一个怪物获得"+(core.values.hatred||0)+"点仇恨值）"],[18,"阻击",function(a){return"经过怪物的十字领域时自动减生命"+(a.value||0)+"点，同时怪物后退一格"}],[19,"自爆","战斗后勇士的生命值变成1"],[20,"无敌","勇士无法打败怪物，除非拥有十字架"],[21,"退化",function(a){return"战斗后勇士永久下降"+(a.atkValue||0)+"点攻击和"+(a.defValue||0)+"点防御"}],[22,"固伤",function(a){return"战斗前，怪物对勇士造成"+(a.damage||0)+"点固定伤害，无视勇士魔防。"}],[23,"重生","怪物被击败后，角色转换楼层则怪物将再次出现"],[24,"激光",function(a){return"经过怪物同行或同列时自动减生命"+(a.value||0)+"点"}],[25,"光环",function(a){return"同楼层所有怪物生命提升"+(a.value||0)+"%，攻击提升"+(a.atkValue||0)+"%，防御提升"+(a.defValue||0)+"%，"+(a.add?"可叠加":"不可叠加")}],[26,"支援","当周围一圈的怪物受到攻击时将上前支援，并组成小队战斗。"],[27,"捕捉","当走到怪物周围十字时会强制进行战斗。"]]},getEnemyInfo:function(e,h,v,w,f){f=f||core.status.floorId;var k=core.getRealStatusOrDefault(h,"hp"),i=core.getRealStatusOrDefault(h,"atk"),j=core.getRealStatusOrDefault(h,"def"),l=core.getRealStatusOrDefault(h,"mdef");var r=e.hp,o=e.atk,p=e.def,u=e.special;var s=e.money,q=e.experience,t=e.point;if(core.hasSpecial(u,10)){o=i;p=j}if(core.hasSpecial(u,3)&&p<i-1){p=i-1}var m=0,a=0,d=0,c=0;var g=[];var n=v!=null&&w!=null?(v+","+w):"floor";if(!core.status.checkBlock){core.status.checkBlock={}}if(!core.status.checkBlock.cache){core.status.checkBlock.cache={}}var b=core.status.checkBlock.cache[n];if(!b){core.status.maps[f].blocks.forEach(function(x){if(!x.disable){var z=x.event.id,y=core.material.enemys[z];if(y&&core.hasSpecial(y.special,25)){if(y.add||c==0){m+=y.value||0;a+=y.atkValue||0;d+=y.defValue||0;c++}}if(y&&core.hasSpecial(y.special,26)&&v!=null&&w!=null&&Math.abs(x.x-v)<=1&&Math.abs(x.y-w)<=1&&!(v==x.x&&w==x.y)){g.push([x.x,x.y,z])}}});core.status.checkBlock.cache[n]={hp_buff:m,atk_buff:a,def_buff:d,guards:g}}else{m=b.hp_buff;a=b.atk_buff;d=b.def_buff;g=b.guards}r*=(1+m/100);o*=(1+a/100);p*=(1+d/100);return{hp:Math.floor(r),atk:Math.floor(o),def:Math.floor(p),money:Math.floor(s),experience:Math.floor(q),point:Math.floor(t),special:u,guards:g,}},getDamageInfo:function(c,l,G,H,e){e=e||core.status.floorId;var o=core.getRealStatusOrDefault(l,"hp"),m=core.getRealStatusOrDefault(l,"atk"),n=core.getRealStatusOrDefault(l,"def"),p=core.getRealStatusOrDefault(l,"mdef"),C=o,A=m,B=n;o=Math.max(0,o);m=Math.max(0,m);n=Math.max(0,n);p=Math.max(0,p);var d=core.enemys.getEnemyInfo(c,l,G,H,e);var w=d.hp,u=d.atk,v=d.def,z=d.special;if(core.hasItem("cross")&&[85,120,199].indexOf(c.atk)>=0){m*=2}if(core.hasItem("knife")&&c.atk==600){m*=2}if(core.getFlag("skill",0)==1){m*=2}if(core.hasSpecial(z,20)&&!core.hasItem("cross")){return null}var t=0;if(core.hasSpecial(z,11)){var F=o*c.value;F=Math.floor(F)||0;if(c.add){w+=F}t+=F}var D=u-n;if(core.hasSpecial(z,2)){D=u}if(D<0){D=0}if(core.hasSpecial(z,4)){D*=2}if(core.hasSpecial(z,5)){D*=3}if(core.hasSpecial(z,6)){D*=(c.n||4)}var a=0;if(core.hasSpecial(z,8)){a+=Math.floor(core.values.counterAttack*m)}if(core.hasSpecial(z,1)){t+=D}if(core.hasSpecial(z,7)){t+=Math.floor(core.values.breakArmor*n)}if(core.hasSpecial(z,9)){t+=Math.floor(core.values.purify*p)}var q=Math.max(m-v,0);if(q<=0){return null}var E=Math.ceil(w/q);var h=core.getFlag("__guards__"+G+"_"+H,d.guards);var g=false;E+=core.getFlag("__extraTurn__",0);if(h.length>0){if(!g){core.setFlag("__extraTurn__",E)}for(var r=0;r<h.length;r++){var j=h[r][0],k=h[r][1],f=h[r][2];var s=core.enemys.getDamageInfo(core.material.enemys[f],{hp:C,atk:A,def:B,mdef:0});if(s==null){return null}core.setFlag("__extraTurn__",s.turn);t+=s.damage}if(g){E+=core.getFlag("__extraTurn__",0)}}core.removeFlag("__extraTurn__");var b=t+(E-1)*D+E*a;b-=p;if(!core.flags.enableNegativeDamage){b=Math.max(0,b)}return{mon_hp:Math.floor(w),mon_atk:Math.floor(u),mon_def:Math.floor(v),init_damage:Math.floor(t),per_damage:Math.floor(D),hero_per_damage:Math.floor(q),turn:Math.floor(E),damage:Math.floor(b)}},updateEnemys:function(){if(core.hasFlag("495")){core.material.enemys.redKing.hp=800;core.material.enemys.redKing.atk=500;core.material.enemys.redKing.def=100}else{core.material.enemys.redKing.hp=8000;core.material.enemys.redKing.atk=5000;core.material.enemys.redKing.def=1000}}},actions:{onKeyUp:function(d,a){if(core.isMoving()){return}if(a&&d>=48&&d<=57){core.items.quickLoadEquip(d-48);return}switch(d){case 27:core.openSettings(true);break;case 88:core.openBook(true);break;case 71:core.useFly(true);break;case 65:core.doSL("autoSave","load");break;case 83:core.save(true);break;case 68:core.load(true);break;case 69:core.ui.drawCursor();break;case 90:core.turnHero();break;case 75:case 86:core.openQuickShop(true);break;case 32:core.getNextItem();break;case 82:core.actions._clickSyncSave_replay();break;case 33:case 34:core.ui.drawMaps();break;case 77:core.ui.drawPaint();break;case 66:core.ui.drawStatistics();break;case 72:core.ui.drawHelp();break;case 78:core.confirmRestart();break;case 79:core.actions._clickGameInfo_openProject();break;case 80:core.actions._clickGameInfo_openComments();break;case 49:if(core.hasItem("pickaxe")){if(core.canUseItem("pickaxe")){core.status.route.push("key:49");core.useItem("pickaxe",true)}else{core.drawTip("当前不能使用破墙镐")}}break;case 50:if(core.hasItem("bomb")){if(core.canUseItem("bomb")){core.status.route.push("key:50");core.useItem("bomb",true)}else{core.drawTip("当前不能使用炸弹")}}else{if(core.hasItem("hammer")){if(core.canUseItem("hammer")){core.status.route.push("key:50");core.useItem("hammer",true)}else{core.drawTip("当前不能使用圣锤")}}}break;case 51:if(core.hasItem("centerFly")){core.ui.drawCenterFly()}break;case 52:var e=["icePickaxe","snow","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine"];for(var b=0;b<e.length;b++){var c=e[b];if(core.canUseItem(c)){core.status.route.push("key:52");core.useItem(c,true);break}}break;case 55:core.getNextItem();break;case 118:core.debug();break;case 87:if(core.hasItem("skill1")){core.status.route.push("key:87");core.useItem("skill1",true)}break}}},control:{saveData:function(){var c=core.clone(core.status.hero),b=core.utils.hashCode(c);var f={};for(var d in core.values){if(!core.same(core.values[d],core.data.values[d])){f[d]=core.clone(core.values[d])}}var a={floorId:core.status.floorId,hero:c,hard:core.status.hard,maps:core.maps.saveMap(),route:core.encodeRoute(core.status.route),values:f,shops:{},version:core.firstData.version,time:new Date().getTime(),hashCode:b};for(var e in core.status.shops){a.shops[e]={times:core.status.shops[e].times||0,visited:core.status.shops[e].visited||false}}return a},loadData:function(b,a){core.resetGame(b.hero,b.hard,b.floorId,core.maps.loadMap(b.maps),b.values);core.status.route=core.decodeRoute(b.route);for(var d in core.status.shops){if(b.shops[d]){core.status.shops[d].times=b.shops[d].times;core.status.shops[d].visited=b.shops[d].visited}}core.status.textAttribute=core.getFlag("textAttribute",core.status.textAttribute);var e=core.getFlag("globalAttribute",core.status.globalAttribute);if(!core.same(e,core.status.globalAttribute)){core.status.globalAttribute=e;core.updateGlobalAttribute()}core.events.setVolume(core.getFlag("__volume__",1),0);var c=core.getFlag("heroIcon","hero.png");if(core.material.images.images[c]){core.material.images.hero=core.material.images.images[c];core.material.icons.hero.height=core.material.images.images[c].height/4}core.updateEnemys();switch(core.getFlag("bgm")){case 1:core.playBgm("xiaoluoli.mp3");break;case 2:core.playBgm("wan.mp3");break;case 3:core.playBgm("huang.mp3");break;case 4:core.playBgm("xian.mp3");break;case 5:core.playBgm("chuanshuo.mp3");break;case 6:core.playBgm("ed.mp3");break;case 7:core.playBgm("hua.mp3");break;case 8:core.playBgm("migong.mp3");break;default:break}core.changeFloor(b.floorId,null,b.hero.loc,0,a,true)},updateStatusBar:function(){core.ui.statusBar.update();core.updateCheckBlock();core.updateDamage()},updateCheckBlock:function(m){m=m||core.status.floorId;if(!m||!core.status.maps){return}var F=core.floors[m].width,n=core.floors[m].height;var c=core.getMapBlocksObj(m);var f={},D={},B={},a={};for(var r in c){var b=c[r],G=b.x,H=b.y,o=b.event.id,j=core.material.enemys[o];if(o=="lavaNet"&&b.event.trigger=="passNet"&&!core.hasItem("shoes")){f[r]=(f[r]||0)+core.values.lavaDamage;D[r]="血网伤害"}if(j&&core.hasSpecial(j.special,15)&&!core.hasFlag("no_zone")){var u=j.range||1;var I=false;if(j.zoneSquare!=null){I=j.zoneSquare}for(var h=-u;h<=u;h++){for(var i=-u;i<=u;i++){if(h==0&&i==0){continue}var s=G+h,t=H+i,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}if(!I&&Math.abs(h)+Math.abs(i)>u){continue}f[e]=(f[e]||0)+(j.value||0);if(core.getFlag("shield5")){f[e]=0}D[e]="领域伤害"}}}if(j&&core.hasSpecial(j.special,18)&&!core.hasFlag("shield5")){for(var g in core.utils.scan){var s=G+core.utils.scan[g].x,t=H+core.utils.scan[g].y,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}f[e]=(f[e]||0)+(j.value||0);if(core.getFlag("shield5")){f[e]=0}D[e]="阻击伤害";var v=core.reverseDirection(g);var z=G+core.utils.scan[v].x,A=H+core.utils.scan[v].y;if(z>=0&&z<F&&A>=0&&A<n&&core.getBlock(z,A,m)==null){B[e]=(B[e]||[]).concat([[G,H,o,v]])}}}if(j&&core.hasSpecial(j.special,24)&&!core.hasFlag("no_laser")){for(var s=0;s<F;s++){var e=s+","+H;if(s!=G){f[e]=(f[e]||0)+(j.value||0);D[e]="激光伤害"}}for(var t=0;t<n;t++){var e=G+","+t;if(t!=H){f[e]=(f[e]||0)+(j.value||0);D[e]="激光伤害"}}}if(j&&core.enemys.hasSpecial(j.special,27)){for(var g in core.utils.scan){var s=G+core.utils.scan[g].x,t=H+core.utils.scan[g].y,e=s+","+t;if(s<0||s>=F||t<0||t>=n){continue}a[e]=(a[e]||[]).concat([[G,H,o,g]])}}}if(!core.hasFlag("no_betweenAttack")){for(var G=0;G<F;G++){for(var H=0;H<n;H++){var r=G+","+H;var l=null;var p=c[(G-1)+","+H],w=c[(G+1)+","+H];if(p&&w&&p.id==w.id){if(core.hasSpecial(p.event.id,16)){l=p.event.id}}var C=c[G+","+(H-1)],d=c[G+","+(H+1)];if(C&&d&&C.id==d.id){if(core.hasSpecial(C.event.id,16)){l=C.event.id}}if(l!=null){var q=core.status.hero.hp-(f[r]||0);if(q>1){var E=Math.floor((q+(core.flags.betweenAttackCeil?1:0))/2);if(core.getFlag("shield5")){E=0}if(core.flags.betweenAttackMax){var k=core.getDamage(l,G,H,m);if(k!=null&&k<E){E=k}}f[r]=(f[r]||0)+E;D[r]="夹击伤害"}}}}}core.status.checkBlock={damage:f,type:D,snipe:B,ambush:a,cache:{}}},moveOneStep:function(a,b){core.setHeroLoc("x",a,true);core.setHeroLoc("y",b,true);core.status.hero.steps++;core.updateFollowers();core.drawHero();if(core.hasFlag("poison")){core.status.hero.statistics.poisonDamage+=core.values.poisonDamage;core.status.hero.hp-=core.values.poisonDamage;if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}}core.addFlag("talking",-1);core.ui.statusBar.clearInfo();core.ui.statusBar.printEnvironmentInfo();core.updateStatusBar()},moveDirectly:function(c,d){var a=core.canMoveDirectly(c,d);if(a>=0){core.clearMap("hero");var b=core.status.route[core.status.route.length-1];if(["left","right","up","down"].indexOf(b)>=0){core.setHeroLoc("direction",b)}core.setHeroLoc("x",c);core.setHeroLoc("y",d);core.drawHero();core.status.route.push("move:"+c+":"+d);core.status.hero.statistics.moveDirectly++;core.status.hero.statistics.ignoreSteps+=a;core.ui.statusBar.clearInfo();core.ui.statusBar.printEnvironmentInfo();core.setFlag("talking",0);return true}return false},parallelDo:function(timestamp){if(!core.isPlaying()){return}if(core.status.floorId){try{eval(core.floors[core.status.floorId].parallelDo)}catch(e){main.log(e)}}}},ui:{drawStatusBar:function(){if(!core.flags.statusCanvas){return}var a=core.dom.statusCanvas,b=core.dom.statusCanvasCtx;b.clearRect(0,0,a.width,a.height);if(!core.domStyle.showStatusBar){return}b.fillStyle=core.status.globalAttribute.statusBarColor||core.initStatus.globalAttribute.statusBarColor;b.font="italic bold 18px Verdana";var d=6,i=9,e=39;if(core.domStyle.isVertical){d=6;i=6;e=32}var h=["floor","hp","atk","def","mdef","money"];for(var c=0;c<h.length;c++){var f=h[c];b.drawImage(core.statusBar.icons[f],d,i,25,25);var g=(core.statusBar[f]||{}).innerText||" ";if(!/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(g)){b.font="bold 18px Verdana"}b.fillText(g,d+36,i+20);b.font="italic bold 18px Verdana";if(core.domStyle.isVertical){if(c%3!=2){d+=131}else{d=6;i+=e}}else{i+=e}}b.fillStyle="#FFCCAA";b.fillText(core.statusBar.yellowKey.innerText,d+5,i+20);b.fillStyle="#AAAADD";b.fillText(core.statusBar.blueKey.innerText,d+40,i+20);b.fillStyle="#FF8888";b.fillText(core.statusBar.redKey.innerText,d+75,i+20)},drawStatistics:function(){return["yellowDoor","blueDoor","redDoor","greenDoor","steelDoor","yellowKey","blueKey","redKey","greenKey","steelKey","redJewel","blueJewel","greenJewel","yellowJewel","redPotion","bluePotion","greenPotion","yellowPotion","superPotion","pickaxe","bomb","centerFly","icePickaxe","snow","earthquake","upFly","downFly","jumpShoes","lifeWand","poisonWine","weakWine","curseWine","superWine","sword1","sword2","sword3","sword4","sword5","shield1","shield2","shield3","shield4","shield5",]},drawAbout:function(){core.ui.closePanel();core.lockControl();core.status.event.id="about";var c=12,f=36,d=core.__PIXELS__-2*c,a=core.__PIXELS__-2*f;core.setAlpha("ui",0.85);core.fillRect("ui",c,f,d,a,"#000000");core.setAlpha("ui",1);core.drawWindowSkin("winskin.png","ui",c-1,f-1,d+1,a+1);var e=c+24;core.setTextAlign("ui","left");var b=(core.status.globalAttribute||core.initStatus.globalAttribute).font;core.fillText("ui","HTML5 魔塔样板",e,f+35,"#FFD700","bold 22px "+b);core.fillText("ui","版本： "+main.__VERSION__,e,f+80,"#FFFFFF","bold 17px "+b);core.fillText("ui","作者： 艾之葵",e,f+112);core.fillText("ui","HTML5魔塔交流群：539113091",e,f+112+32);core.fillText("ui","(C) 1998 - 2000 Oz & Kenichi",e,f+180);core.fillText("ui","(C) 1996 N.W",e,f+180+27);core.fillText("ui","H5版复刻者: 数码宝贝51 艾之葵",e,f+240);core.fillText("ui","花絮 鹿间裕贵",e+105,f+260)}}};var events_c12a15a8_c380_4b28_8144_256cba95f760={commonEvent:{"加点事件":[{type:"comment",text:"通过传参，flag:arg1表示当前应该的加点数值"},{type:"choices",choices:[{text:"攻击+${1*flag:arg1}",action:[{type:"setValue",name:"status:atk",value:"status:atk+1*flag:arg1"}]},{text:"防御+${2*flag:arg1}",action:[{type:"setValue",name:"status:def",value:"status:def+2*flag:arg1"}]},{text:"生命+${200*flag:arg1}",action:[{type:"setValue",name:"status:hp",value:"status:hp+200*flag:arg1"}]}]}],"毒衰咒处理":[{type:"comment",text:"获得毒衰咒效果，flag:arg1为要获得的类型"},{type:"switch",condition:"flag:arg1",caseList:[{"case":"0",action:[{type:"comment",text:"获得毒效果"},{type:"if",condition:"!flag:poison","true":[{type:"setValue",name:"flag:poison",value:"true"}],"false":[]}]},{"case":"1",action:[{type:"comment",text:"获得衰效果"},{type:"if",condition:"!flag:weak","true":[{type:"setValue",name:"flag:weak",value:"true"},{type:"if",condition:"core.values.weakValue>=1","true":[{type:"comment",text:">=1：直接扣数值"},{type:"addValue",name:"status:atk",value:"-core.values.weakValue"},{type:"addValue",name:"status:def",value:"-core.values.weakValue"}],"false":[{type:"comment",text:"<1：扣比例"},{type:"function","function":"function(){\ncore.addBuff('atk', -core.values.weakValue);\n}"},{type:"function","function":"function(){\ncore.addBuff('def', -core.values.weakValue);\n}"}]}],"false":[]}]},{"case":"2",action:[{type:"comment",text:"获得咒效果"},{type:"if",condition:"!flag:curse","true":[{type:"setValue",name:"flag:curse",value:"true"}],"false":[]}]}]}],"滑冰事件":[{type:"comment",text:"公共事件：滑冰事件"},{type:"if",condition:"core.canMoveHero()","true":[{type:"comment",text:"检测下一个点是否可通行"},{type:"setValue",name:"flag:nx",value:"core.nextX()"},{type:"setValue",name:"flag:ny",value:"core.nextY()"},{type:"if",condition:"core.noPass(flag:nx, flag:ny)","true":[{type:"comment",text:"不可通行，触发下一个点的事件"},{type:"trigger",loc:["flag:nx","flag:ny"]}],"false":[{type:"comment",text:"可通行，先移动到下个点，然后检查阻激夹域，并尝试触发该点事件"},{type:"moveHero",time:80,steps:["forward"]},{type:"function","function":"function(){\ncore.checkBlock();\n}"},{type:"comment",text:"【触发事件】如果该点存在事件则会立刻结束当前事件"},{type:"trigger",loc:["flag:nx","flag:ny"]},{type:"comment",text:"如果该点不存在事件，则继续检测该点是否是滑冰点"},{type:"if",condition:"core.getBgNumber() == 167","true":[{type:"function","function":'function(){\ncore.insertAction("滑冰事件",null,null,null,true)\n}'}],"false":[]}]}],"false":[]}],"回收钥匙商店":[{type:"choices",choices:[{text:"游戏简介",action:["h5版本是按照flash版复刻，其中部分对话使用的魔塔盛宴的版本。","地图复制：数码宝贝51、641\n部分事件复制：小艾\n默认背景音乐：无；可在切换音乐处设置\n游戏音乐、怪物显伤等开关可以在系统设置里打开和关闭","想要获得更详细的介绍，可以在菜单——游戏信息——游戏主页中进入本塔的评论区，查看置顶评论。",{type:"insert",name:"回收钥匙商店"}]},{text:"游戏结局",action:[{type:"if",condition:"flag:addhp","true":["疯狂加血模式下，本塔有且仅有一个专属结局。",{type:"insert",name:"回收钥匙商店"}],"false":["本塔共有四个结局。\n在原版魔塔中，使用下楼器和破墙镐（或下楼器和地震卷轴）可以封印魔王，因此，这个版本如保留下楼器和破墙镐（或下楼器和地震卷轴）击败魔王，即可打出True End，否则为Normal End。","不论是Normal End还是True End，都分为穿墙结局和不穿墙结局，如果从未使用对话穿墙，可以打出不穿墙结局。",{type:"insert",name:"回收钥匙商店"}]}]},{text:"对话穿墙",action:["在与老人对话后，或购买商人的物品并再次对话后，可以立即清除，或走一步再清除身边的某一堵墙（不必是暗墙）。","这期间不能瞬移、打怪、开门和使用道具，否则穿墙会失败。",{type:"insert",name:"回收钥匙商店"}]},{text:"切换音乐",action:[{type:"choices",choices:[{text:"精灵石 3个小萝莉在一起",action:[{type:"setValue",name:"flag:bgm",value:"1"},{type:"playBgm",name:"xiaoluoli.mp3"}]},{text:"精灵石 晚上家里和镇子",action:[{type:"setValue",name:"flag:bgm",value:"2"},{type:"playBgm",name:"wan.mp3"}]},{text:"精灵石 黄昏的镇子",action:[{type:"setValue",name:"flag:bgm",value:"3"},{type:"playBgm",name:"huang.mp3"}]},{text:"仙境传说-守候永恒的爱",action:[{type:"setValue",name:"flag:bgm",value:"4"},{type:"playBgm",name:"xian.mp3"}]},{text:"精灵石 精灵石传说",action:[{type:"setValue",name:"flag:bgm",value:"5"},{type:"playBgm",name:"chuanshuo.mp3"}]},{text:"精灵石 ed【神曲】",action:[{type:"setValue",name:"flag:bgm",value:"6"},{type:"playBgm",name:"ed.mp3"}]},{text:"精灵石 幸福之花",action:[{type:"setValue",name:"flag:bgm",value:"7"},{type:"playBgm",name:"hua.mp3"}]},{text:"精灵石 迷宫",action:[{type:"setValue",name:"flag:bgm",value:"8"},{type:"playBgm",name:"migong.mp3"}]},{text:"离开",action:[]}]},{type:"insert",name:"回收钥匙商店"}]},{text:"返回游戏",action:[]}]}],"对话":[{type:"switch",condition:"flag:arg1",caseList:[{"case":"2",action:[{type:"setValue",name:"flag:content",value:"'谢谢你救了我，为了感谢你的帮助请收下这些礼物。'"},{type:"setValue",name:"flag:对话2",value:"1"}]},{"case":"3",action:[{type:"setValue",name:"flag:content",value:"'我给你怪物手册<快捷键x> 它能预测出当前楼层各类怪物对你的伤害'"},{type:"setValue",name:"flag:对话3",value:"1"}]},{"case":"4",action:[{type:"setValue",name:"flag:content",value:"'你是否发现每次对话之后你都有一种神秘的能力'"},{type:"setValue",name:"flag:对话4",value:"1"}]},{"case":"6",action:[{type:"if",condition:"flag:arg2 == 4","true":[{type:"setValue",name:"flag:content",value:"'购买物品之后再与商人对话，他会告诉你一些重要的消息。'"},{type:"setValue",name:"flag:对话6",value:"1"}],"false":[{type:"setValue",name:"flag:content",value:"'魔塔共有50层，每10层为一个区域。如果不打败此区域的头目就不能到更高的地方。'"},{type:"setValue",name:"flag:对话602",value:"1"}]}]},{"case":"7",action:[{type:"setValue",name:"flag:content",value:"'你的攻击比敌人防御高时就能对他造成伤害 你防御比敌人攻击高或一样时就能无伤'"},{type:"setValue",name:"flag:对话7",value:"1"}]},{"case":"12",action:[{type:"setValue",name:"flag:content",value:"'本塔有很多暗墙 比如5 9 12 14 16 18层 你都找到了吗'"},{type:"setValue",name:"flag:对话12",value:"1"}]},{"case":"15",action:[{type:"setValue",name:"flag:content",value:"'十字架对兽人和吸血鬼是神器 它被藏在这之上的某层中'"},{type:"setValue",name:"flag:对话15",value:"1"}]},{"case":"16",action:[{type:"setValue",name:"flag:content",value:"'整个魔塔有2把藏在墙里的红钥匙'"},{type:"setValue",name:"flag:对话16",value:"1"}]},{"case":"18",action:[{type:"setValue",name:"flag:content",value:"'在这区域不多次提升攻击力 就不能打败石头人 切记前人教训'"},{type:"setValue",name:"flag:对话18",value:"1"}]},{"case":"21",action:[{type:"setValue",name:"flag:content",value:"'大法师住在25楼 他是魔塔的主人 以你现在的状态去攻击他简直就是自杀 你应当在取得更高级别的道具后再去打败他'"},{type:"setValue",name:"flag:对话21",value:"1"}]},{"case":"23",action:[{type:"setValue",name:"flag:content",value:"'我没有什么可说的，但有一个确切的消息藏在这个楼层'"},{type:"setValue",name:"flag:对话23",value:"1"}]},{"case":"27",action:[{type:"setValue",name:"flag:content",value:"'如果你没有使用过4层的祭坛 在12层供奉不超过4次 那么祝贺你 你的前期是比较成功的'"},{type:"setValue",name:"flag:对话27",value:"1"}]},{"case":"31",action:[{type:"if",condition:"flag:arg2 == 1","true":[{type:"setValue",name:"flag:content",value:"'你居然买了我的钥匙 那我就告诉你一个秘密 魔塔里有个幸运金币 拥有它在打败敌人后能获得2倍的金币'"},{type:"setValue",name:"flag:对话3102",value:"1"}],"false":[{type:"setValue",name:"flag:content",value:"'双手剑士的攻击力太高了 你最好到能对他一击必杀时再与他战斗, 但是如果他主动攻击你, 你仍然会受到一次伤害'"},{type:"setValue",name:"flag:对话31",value:"1"}]}]},{"case":"33",action:[{type:"setValue",name:"flag:content",value:"'别匆忙, 放慢速度'"},{type:"setValue",name:"flag:对话33",value:"1"}]},{"case":"36",action:[{type:"setValue",name:"flag:content",value:"'不用找了 本层没有暗道, 但是如果你能用好移动宝物 可以省很多血'"},{type:"setValue",name:"flag:对话36",value:"1"}]},{"case":"37",action:[{type:"setValue",name:"flag:content",value:"'你需要用地震卷轴才能取走这里的所有宝物 当然你也可以不取 51层魔塔最好玩的地方就是道具有多种用法'"},{type:"setValue",name:"flag:对话37",value:"1"}]},{"case":"38",action:[{type:"setValue",name:"flag:content",value:"'存放圣剑的房间的门坏了 你只能用其他方法进去'"},{type:"setValue",name:"flag:对话38",value:"1"}]},{"case":"39",action:[{type:"if",condition:"flag:arg2 == 1","true":[{type:"setValue",name:"flag:content",value:"'谜题 在3点 拥有传送功能的密宝 就会出现'"},{type:"setValue",name:"flag:对话39",value:"1"}],"false":[{type:"setValue",name:"flag:content",value:"'你居然买了我的钥匙 那我就告诉你一个秘密 神圣剑有3种方法可以得到 不同的方法路线也会不同'"},{type:"setValue",name:"flag:对话3902",value:"1"}]}]},{"case":"42",action:[{type:"setValue",name:"flag:content",value:"'巫师会用魔法攻击路过的人 在2个魔法警卫间通过会使你的生命减少一半'"},{type:"setValue",name:"flag:对话42",value:"1"}]},{"case":"45",action:[{type:"if",condition:"flag:arg3 == 3","true":[{type:"setValue",name:"flag:content",value:"'神圣盾能防御魔法攻击 但它被藏在异空间的楼层内'"},{type:"setValue",name:"flag:对话45",value:"1"}],"false":[{type:"setValue",name:"flag:content",value:"'44楼被藏在异空间 你只能用移动宝物才能到达'"},{type:"setValue",name:"flag:对话4502",value:"1"}]}]},{"case":"46",action:[{type:"setValue",name:"flag:content",value:"'41层其实是左右对称的 你应该能发现 打怪时如果不和怪物重叠 可以规避一些魔法攻击'"},{type:"setValue",name:"flag:对话46",value:"1"}]},{"case":"47",action:[{type:"setValue",name:"flag:content",value:"'如果要打败魔龙你需要 圣剑 圣盾 屠龙匕 或更高等级的装备'"},{type:"setValue",name:"flag:对话47",value:"1"}]},{"case":"48",action:[{type:"setValue",name:"flag:content",value:"'像骰子上5一样的形状是一种封印魔法 你最好记住 它在与魔王战斗时可能有用 什么 别说胡话了 这房间没有魔法警卫'"},{type:"setValue",name:"flag:对话48",value:"1"}]},{"case":"default",action:[]}]},{type:"if",condition:"flag:arg4","true":["\t[商人,woman]${flag:content}"],"false":["\t[老人,man]${flag:content}"]},{type:"switch",condition:"flag:arg1",caseList:[{"case":"2",action:[{type:"playSound",name:"item.mp3"},{type:"addValue",name:"status:money",value:"1000"},{type:"tip",text:"获得1000金币"},]},{"case":"3",action:[{type:"addValue",name:"item:book",value:"1"}]},{"case":"default",action:[]}]},{type:"setValue",name:"flag:talking",value:"2"},{type:"function","function":'function(){\ncore.insertAction([{\n\t"type": "hide",\n\t"loc": [\n\t\t[core.nextX(), core.nextY()]\n\t],\n\t"time": 500\n}, ]);\n}'}],"商人":[{type:"switch",condition:'core.status.floorId.replace(/[^0-9]/ig, "")',caseList:[{"case":"6",action:[{type:"setValue",name:"flag:money",value:"50"},{type:"setValue",name:"flag:item",value:"'一把蓝钥匙'"}]},{"case":"7",action:[{type:"setValue",name:"flag:money",value:"50"},{type:"setValue",name:"flag:item",value:"'五把黄钥匙'"}]},{"case":"12",action:[{type:"setValue",name:"flag:money",value:"800"},{type:"setValue",name:"flag:item",value:"'一把红钥匙'"}]},{"case":"15",action:[{type:"setValue",name:"flag:money",value:"200"},{type:"setValue",name:"flag:item",value:"'一把蓝钥匙'"}]},{"case":"31",action:[{type:"setValue",name:"flag:money",value:"1000"},{type:"setValue",name:"flag:item",value:"'一把蓝钥匙, 四把黄钥匙'"}]},{"case":"38",action:[{type:"setValue",name:"flag:money",value:"200"},{type:"setValue",name:"flag:alt",value:"1"},{type:"setValue",name:"flag:item",value:"'大甩卖! 三把黄钥匙只要200金币, 先到先得!'"}]},{"case":"39",action:[{type:"setValue",name:"flag:money",value:"2000"},{type:"setValue",name:"flag:item",value:"'三把蓝钥匙'"}]},{"case":"45",action:[{type:"setValue",name:"flag:money",value:"1000"},{type:"setValue",name:"flag:alt",value:"1"},{type:"setValue",name:"flag:item",value:"'你出1000金币, 我就帮你回复2000点生命值'"}]},{"case":"47",action:[{type:"setValue",name:"flag:money",value:"4000"},{type:"setValue",name:"flag:item",value:"'地震卷轴'"}]},{"case":"default",action:[]}]},{type:"choices",text:"\t[商人,woman]${flag:alt ? flag:item : '我有'+flag:item+', 你出'+flag:money+'金币就卖给你'}",choices:[{text:"我太需要了",action:[{type:"if",condition:"status:money >= flag:money","true":[{type:"addValue",name:"status:money",value:"-flag:money"},{type:"switch",condition:'core.status.floorId.replace(/[^0-9]/ig, "")',caseList:[{"case":"6",action:[{type:"addValue",name:"item:blueKey",value:"1"}]},{"case":"7",action:[{type:"addValue",name:"item:yellowKey",value:"5"}]},{"case":"12",action:[{type:"addValue",name:"item:redKey",value:"1"}]},{"case":"15",action:[{type:"addValue",name:"item:blueKey",value:"1"}]},{"case":"31",action:[{type:"addValue",name:"item:yellowKey",value:"4"},{type:"addValue",name:"item:blueKey",value:"1"}]},{"case":"38",action:[{type:"addValue",name:"item:yellowKey",value:"3"}]},{"case":"39",action:[{type:"addValue",name:"item:blueKey",value:"3"}]},{"case":"45",action:[{type:"playSound",name:"item.mp3"},{type:"addValue",name:"status:hp",value:"2000"}]},{"case":"47",action:[{type:"addValue",name:"item:earthquake",value:"1"}]},{"case":"default",action:[]}]},{type:"function","function":"function(){\nvar name = core.status.floorId + '@' + core.nextX() + '@' + core.nextY() + '@' + 'A';\ncore.setFlag(name, 1);\n}"}],"false":["\t[商人,woman]你的金币不够${flag:money}枚，无法交易！"]}]},{text:"下次再说",action:[]}]},{type:"setValue",name:"flag:alt",value:"0"},],"开墙":[{type:"playSound",name:"door.mp3"},{type:"function","function":'function(){\ncore.insertAction([{\n\t"type": "hide",\n\t"loc": [\n\t\t[core.nextX(), core.nextY()]\n\t],\n\t"time": 0\n}, ]);\n}'}],"商店":[{type:"if",condition:"flag:times1>0","true":[],"false":[{type:"setValue",name:"flag:times1",value:"1"}]},{type:"setValue",name:"flag:money1",value:"20+10*flag:times1*(flag:times1-1)"},{type:"choices",text:"\t[祭坛,blueShop]如果供奉${flag:money1}金币, 便可以增加你的力量, 你想要什么呢…",choices:[{text:"生命+${100*flag:times1}",action:[{type:"if",condition:"status:money>=flag:money1","true":[{type:"playSound",name:"item.mp3"},{type:"addValue",name:"status:hp",value:"100*flag:times1"},{type:"addValue",name:"status:money",value:"-flag:money1"},{type:"addValue",name:"flag:times1",value:"1"},{type:"insert",name:"商店"}],"false":[{type:"tip",text:"你的金币不足${flag:money1}枚，无法供奉！"},{type:"insert",name:"商店"}]}]},{text:"攻击+${2*flag:ratio}",action:[{type:"if",condition:"status:money>=flag:money1","true":[{type:"playSound",name:"item.mp3"},{type:"addValue",name:"status:atk",value:"2*flag:ratio"},{type:"addValue",name:"status:money",value:"-flag:money1"},{type:"addValue",name:"flag:times1",value:"1"},{type:"insert",name:"商店"}],"false":[{type:"tip",text:"你的金币不足${flag:money1}枚，无法供奉！"},{type:"insert",name:"商店"}]}]},{text:"防御+${4*flag:ratio}",action:[{type:"if",condition:"status:money>=flag:money1","true":[{type:"playSound",name:"item.mp3"},{type:"addValue",name:"status:def",value:"4*flag:ratio"},{type:"addValue",name:"status:money",value:"-flag:money1"},{type:"addValue",name:"flag:times1",value:"1"},{type:"insert",name:"商店"}],"false":[{type:"tip",text:"你的金币不足${flag:money1}枚，无法供奉！"},{type:"insert",name:"商店"}]}]},{text:"离开",action:[]}]}],"记事本":[{type:"if",condition:"flag:翻页==0","true":[{type:"setValue",name:"flag:翻页",value:"1"}],"false":[]},{type:"if",condition:"flag:翻页==1","true":[{type:"while",condition:"true",data:[{type:"choices",text:"记事本（只显示对话过的）",choices:[{text:"2层老人",condition:"flag:对话2==1",action:["谢谢你救了我，为了感谢你的帮助请收下这些礼物。"]},{text:"3层老人",condition:"flag:对话3==1",action:["我可以给你怪物手册<快捷键x> 它能预测出当前楼层各类怪物对你的伤害"]},{text:"4层老人",condition:"flag:对话4==1",action:["你是否发现每次对话之后你都有一种神秘的能力"]},{text:"6层老人",condition:"flag:对话6==1",action:["购买物品之后再与商人对话，他会告诉你一些重要的消息。"]},{text:"6层商人",condition:"flag:对话602==1",action:["魔塔共有50层，每10层为一个区域。如果不打败此区域的头目就不能到更高的地方。"]},{text:"7层商人",condition:"flag:对话7==1",action:["你的攻击比敌人防御高时就能对他造成伤害 你防御比敌人攻击高或一样时就能无伤"]},{text:"12层商人",condition:"flag:对话12==1",action:["本塔有很多暗墙 比如5 9 12 14 16 18层 你都找到了吗"]},{text:"15层商人",condition:"flag:对话15==1",action:["十字架对兽人和吸血鬼是神器 它被藏在这之上的某层中"]},{text:"16层老人",condition:"flag:对话16==1",action:["整座魔塔中有2把藏在墙里的红钥匙"]},{text:"跳到尾页",action:[{type:"setValue",name:"flag:翻页",value:"3"},{type:"insert",name:"记事本"}]},{text:"下一页",action:[{type:"setValue",name:"flag:翻页",value:"2"},{type:"insert",name:"记事本"}]},{text:"离开",action:[{type:"setValue",name:"flag:翻页",value:"1"},{type:"exit"}]}]}]}],"false":[]},{type:"if",condition:"flag:翻页==2","true":[{type:"while",condition:"true",data:[{type:"choices",text:"记事本（只显示对话过的）",choices:[{text:"18层老人",condition:"flag:对话18==1",action:["在这区域不多次提升攻击力 就不能打败石头人 切记前人教训"]},{text:"21层老人",condition:"flag:对话21==1",action:["大法师住在25楼 他是魔塔的主人 以你现在的状态去攻击他简直就是自杀 你应当在取得更高级别的道具后再去打败他"]},{text:"23层老人",condition:"flag:对话23==1",action:["我没有什么可说的，但有一个确切的消息藏在这个楼层"]},{text:"27层老人",condition:"flag:对话27==1",action:["如果你没有使用过4层的祭坛 在12层供奉不超过4次 那么祝贺你 你的前期是比较成功的"]},{text:"31层商人",condition:"flag:对话3102==1",action:["你居然买了我的钥匙 那我就告诉你一个秘密 魔塔里有个幸运金币 拥有它在打败敌人后能获得2倍的金币"]},{text:"31层老人",condition:"flag:对话31==1",action:["双手剑士的攻击力太高了 你最好到能对他一击必杀时再与他战斗 但是如果他主动攻击你, 你仍然会受到一次伤害"]},{text:"33层老人",condition:"flag:对话33==1",action:["别匆忙, 放慢速度"]},{text:"36层老人",condition:"flag:对话36==1",action:["不用找了 本层没有暗道, 如果你能用好移动宝物 就可以省很多血"]},{text:"37层老人",condition:"flag:对话37==1",action:["你需要用地震卷轴才能取走这里的所有宝物 当然你也可以不取 51层魔塔最好玩的地方就是道具有多种用法"]},{text:"上一页",action:[{type:"setValue",name:"flag:翻页",value:"1"},{type:"insert",name:"记事本"}]},{text:"下一页",action:[{type:"setValue",name:"flag:翻页",value:"3"},{type:"insert",name:"记事本"}]},{text:"离开",action:[{type:"setValue",name:"flag:翻页",value:"1"},{type:"exit"}]}]}]}],"false":[]},{type:"if",condition:"flag:翻页==3","true":[{type:"while",condition:"true",data:[{type:"choices",text:"记事本（只显示对话过的）",choices:[{text:"38层商人",condition:"flag:对话38==1",action:["存放圣剑的房间的门坏了 你只能用其他方法进去"]},{text:"39层老人",condition:"flag:对话39==1",action:["谜题 在3点 拥有传送功能的密宝 就会出现"]},{text:"39层商人",condition:"flag:对话3902==1",action:["你居然买了我的钥匙 那我就告诉你一个秘密 神圣剑有3种方法可以得到 不同的方法路线也会不同"]},{text:"42层老人",condition:"flag:对话42==1",action:["巫师会用魔法攻击路过的人 在2个魔法警卫间通过会使你的生命减少一半"]},{text:"45层老人",condition:"flag:对话45==1",action:["神圣盾能防御魔法攻击 但它被藏在异空间的楼层内"]},{text:"45层商人",condition:"flag:对话4502==1",action:["44层被藏在异空间 你只能用移动宝物才能到达"]},{text:"46层老人",condition:"flag:对话46==1",action:["41层其实是左右对称的\n还有, 打怪时如果不和怪物重叠 可以规避一些魔法攻击"]},{text:"47层商人",condition:"flag:对话47==1",action:["如果要打败魔龙你需要 圣剑 圣盾 屠龙匕 或更高等级的装备"]},{text:"48层老人",condition:"flag:对话48==1",action:["像骰子上5一样的形状是一种封印魔法 你最好记住 它在与魔王战斗时可能有用 什么 别说胡话了 这房间没有魔法警卫"]},{text:"上一页",action:[{type:"setValue",name:"flag:翻页",value:"2"},{type:"insert",name:"记事本"}]},{text:"跳到首页",action:[{type:"setValue",name:"flag:翻页",value:"1"},{type:"insert",name:"记事本"}]},{text:"离开",action:[{type:"setValue",name:"flag:翻页",value:"1"},{type:"exit"}]}]}]}],"false":[]}]}};var plugins_bb40132b_638b_4a9f_b028_d3fe47acc8d1={init:function(){console.log("插件编写测试");core.enemys.getDamageString=function(c,e,f,d){if(typeof c=="string"){c=core.material.enemys[c]}var b=this.getDamage(c,e,f,d);var a="#000000";if(b==null){b="???";a="#FF0000"}else{if(core.getFlag("addhp",0)==1){if(b<core.status.hero.hp){a="#00FF00"}else{a="#FF0000"}}else{if(b<=0){a="#00FF00"}else{if(b<core.status.hero.hp/3){a="#FFFFFF"}else{if(b<core.status.hero.hp*2/3){a="#FFFF00"}else{if(b<core.status.hero.hp){a="#FF7F00"}else{a="#FF0000"}}}}}b=core.formatBigNumber(b,true);if(core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,21)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}}return{damage:b,color:a}};core.ui._drawBook_drawDamage=function(d,c,e,f){core.setTextAlign("ui","center");var b=c.damage,a="#FFFF00";if(b==null){b="不可攻击";a="#FF0000"}else{if(b==0){b="无危险";a="#00FF00"}else{if(b>=core.status.hero.hp){a="#FF0000"}if(b<=0){a="#00FF00"}b=core.formatBigNumber(b);if(core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,21)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}}}if(c.notBomb){b+="[b]"}core.fillText("ui",b,e,f,a,this._buildFont(13,true))};core.control.checkBlock=function(){var c=core.getHeroLoc("x"),d=core.getHeroLoc("y"),b=c+","+d;var a=core.status.checkBlock.damage[b];if(a){core.status.hero.hp-=a;core.drawTip("你没有神圣盾不能防御，受到 "+a+" 点魔法伤害");this._checkBlock_soundAndAnimate(c,d);if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose();return}}this._checkBlock_snipe(core.status.checkBlock.snipe[b]);this._checkBlock_ambush(core.status.checkBlock.ambush[b])};core.control._checkBlock_soundAndAnimate=function(a,b){core.playSound("zone.mp3")};core.control._checkBlock_snipe=function(b){if(!b||b.length==0){return}var a=[];b.forEach(function(c){a.push({type:"move",loc:[c[0],c[1]],steps:[c[3]],time:200,keep:true,async:true})});a.push({type:"waitAsync"});core.insertAction(a)};core.registerSystemEvent("man",function(h,g){var d=core.status.floorId.replace(/[^0-9]/ig,"");var e=core.nextX();var f=core.nextY();core.insertAction([{type:"insert",name:"对话",args:[d,e,f,0]},]);if(g){g()}});core.registerSystemEvent("woman",function(h,g){var i=core.status.floorId+"@"+core.nextX()+"@"+core.nextY()+"@A";if(core.getFlag(i,0)==1){var d=core.status.floorId.replace(/[^0-9]/ig,"");var e=core.nextX();var f=core.nextY();core.insertAction([{type:"insert",name:"对话",args:[d,e,f,1]},])}else{core.insertAction([{type:"insert",name:"商人",args:[0]},])}if(g){g()}});core.registerSystemEvent("specialwall",function(b,a){if(b.event.id=="whiteWall"||core.getFlag("talking")>0){core.insertAction([{type:"insert",name:"开墙"},]);if(b.event.id!="whiteWall"){core.setFlag("end",1)}core.setFlag("talking",0)}if(a){a()}});core.registerSystemEvent("fakeWall",function(b,a){if(b.event.id=="blueWall"){core.insertAction([{type:"openDoor",loc:[b.x,b.y]},])}if(a){a()}});core.events._changeFloor_beforeChange=function(b,a){window.setTimeout(function(){if(b.time==0){core.events._changeFloor_changing(b,a)}else{var d=parseInt(core.status.floorId.slice(2)),c=d;var f=parseInt(b.floorId.slice(2));core.setCurtain([255,255,255,1]);core.setFlag("__color__",[255,255,255,1]);var e=window.setInterval(function(){if(d>f){d--}else{if(d<f){d++}else{clearInterval(e);core.status.floorId=c;core.events._changeFloor_changing(b,a)}}core.status.floorId="MT"+d;core.ui.statusBar._update_props()},b.time*10)}},25)};core.events._changeFloor_changing=function(b,a){this.changingFloor(b.floorId,b.heroLoc,b.fromLoad);if(b.time==0){this._changeFloor_afterChange(b,a)}else{core.setCurtain([0,0,0,0],750,function(){core.setFlag("__color__",[0,0,0,0]);core.events._changeFloor_afterChange(b,a)})}};core.ui.drawWindowSelector=function(a,e,f,d,c){d=Math.round(d)+48,c=Math.round(c);var b=core.ui.createCanvas("_selector",e-24,f,d,c,165);this._drawSelector(b,a,d,c)};core.ui._drawSelector=function(b,a,f,c,d,e){d=d||0;e=e||0;b=this.getContextByName(b);if(!b){return}if(typeof a=="string"){a=core.material.images.images[a]}if(!(a instanceof Image)){return}b.drawImage(a,132,68,24,24,d+4,e+4,24,24);b.drawImage(a,132,68,24,24,f-d-28,e+4,24,24)};core.ui.drawTip=function(c,b,a){core.ui.statusBar.print(c)};core.ui.clearMap=function(d,f,g,e,b){if(d=="all"){for(var c in core.canvas){core.canvas[c].clearRect(0,0,core.bigmap.width*32,core.bigmap.height*32)}core.clearMap("outerUI");core.dom.gif.innerHTML="";core.removeGlobalAnimate()}else{var a=this.getContextByName(d);if(a){a.clearRect(f||0,g||0,e||a.canvas.width,b||a.canvas.height)}}};core.control._shouldDisplayStatus=function(){return[]};core.control._updateStatusBar_setToolboxIcon=function(){core.ui.statusBar._update_toolBox()};core.control.updateGlobalAttribute=function(){};core.actions._getClickLoc=function(f,g){var d=32;d=d*core.domStyle.scale;var a=main.dom.body.clientWidth/2,b=main.dom.body.clientHeight/2;f-=a,g-=b;if(core.domStyle.isVertical){var e=f;f=g,g=-e}var c={x:f+320*core.domStyle.scale,y:g+211*core.domStyle.scale,size:d};if(core.ui.statusBar.isInGameDraw(c)){c=core.ui.statusBar.fixEventLoc(c)}else{c.x/=core.domStyle.scale;c.y/=core.domStyle.scale;c.outer=true}return c};this._afterLoadResources=function(){}},drawLight:function(){this.drawLight=function(e,a,d,c){var b=core.getContextByName(e);if(b==null){if(typeof e=="string"){b=core.createCanvas(e,0,0,core.__PIXELS__,core.__PIXELS__,98)}else{return}}b.mozImageSmoothingEnabled=false;b.webkitImageSmoothingEnabled=false;b.msImageSmoothingEnabled=false;b.imageSmoothingEnabled=false;core.clearMap(e);if(a==null){a=0.9}b.fillStyle="rgba(0,0,0,"+a+")";b.fillRect(0,0,b.canvas.width,b.canvas.height);c=core.clamp(c,0,1);b.globalCompositeOperation="destination-out";d.forEach(function(h){var j=h[0],k=h[1],i=h[2];var f=parseInt(i*c);var g=b.createRadialGradient(j,k,f,j,k,i);g.addColorStop(0,"rgba(0,0,0,1)");g.addColorStop(1,"rgba(0,0,0,0)");b.beginPath();b.fillStyle=g;b.arc(j,k,i,0,2*Math.PI);b.fill()});b.globalCompositeOperation="source-over"}}};