"use strict";function utils(){this._init();this.scan={up:{x:0,y:-1},left:{x:-1,y:0},down:{x:0,y:1},right:{x:1,y:0}}}utils.prototype._init=function(){if(typeof Object.assign!="function"){Object.assign=function(d,f){if(d==null){throw new TypeError("Cannot convert undefined or null to object")}var e=Object(d);for(var a=1;a<arguments.length;a++){var c=arguments[a];if(c!=null){for(var b in c){if(Object.prototype.hasOwnProperty.call(c,b)){e[b]=c[b]}}}}return e}}if(typeof String.prototype.endsWith!="function"){String.prototype.endsWith=function(a,b){if(b===undefined||b>this.length){b=this.length}return this.substring(b-a.length,b)===a}}if(typeof String.prototype.startsWith!="function"){String.prototype.startsWith=function(a,b){if(b===undefined||b>this.length){b=this.length}return this.substring(0,a.length)===a}}};utils.prototype.replaceText=function(b,a,c){return b.replace(/\${(.*?)}/g,function(e,d){return core.calValue(d,null,a,c)})};utils.prototype.replaceValue=function(a){if(typeof a=="string"&&a.indexOf(":")>=0){if(a.indexOf("status:")>=0){a=a.replace(/status:([a-zA-Z0-9_]+)/g,"core.getStatus('$1')")}if(a.indexOf("item:")>=0){a=a.replace(/item:([a-zA-Z0-9_]+)/g,"core.itemCount('$1')")}if(a.indexOf("flag:")>=0){a=a.replace(/flag:([a-zA-Z0-9_\u4E00-\u9FCC]+)/g,"core.getFlag('$1', 0)")}if(a.indexOf("global:")>=0){a=a.replace(/global:([a-zA-Z0-9_\u4E00-\u9FCC]+)/g,"core.getGlobal('$1', 0)")}if(a.indexOf("enemy:")>=0){a=a.replace(/enemy:([a-zA-Z0-9_]+)\.([a-zA-Z0-9_]+)/g,"core.material.enemys['$1'].$2")}if(a.indexOf("blockId:")>=0){a=a.replace(/blockId:(\d+),(\d+)/g,"core.getBlockId($1, $2)")}if(a.indexOf("blockCls:")>=0){a=a.replace(/blockCls:(\d+),(\d+)/g,"core.getBlockCls($1, $2)")}if(a.indexOf("equip:")>=0){a=a.replace(/equip:(\d)/g,"core.getEquip($1)")}}return a};utils.prototype.calValue=function(value,prefix,need,times){if(!core.isset(value)){return null}if(typeof value==="string"){if(value.indexOf(":")>=0){if(value.indexOf("switch:">=0)){value=value.replace(/switch:([a-zA-Z0-9_]+)/g,"core.getFlag('"+(prefix||":f@x@y")+"@$1', 0)")}value=this.replaceValue(value)}return eval(value)}if(value instanceof Function){return value()}return value};utils.prototype.unshift=function(c,d){if(!(c instanceof Array)||d==null){return}if(d instanceof Array){core.clone(d).reverse().forEach(function(a){c.unshift(a)})}else{c.unshift(d)}return c};utils.prototype.push=function(c,d){if(!(c instanceof Array)||d==null){return}if(d instanceof Array){core.clone(d).forEach(function(a){c.push(a)})}else{c.push(d)}return c};utils.prototype.decompress=function(c){try{var b=lzw_decode(c);if(b){return JSON.parse(b)}}catch(a){}try{var b=LZString.decompress(c);if(b){return JSON.parse(b)}}catch(a){}try{return JSON.parse(c)}catch(a){main.log(a)}return null};utils.prototype.setLocalStorage=function(c,f){try{if(f==null){this.removeLocalStorage(c);return}var d=JSON.stringify(f).replace(/[\u007F-\uFFFF]/g,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).substr(-4)});var a=lzw_encode(d);localStorage.setItem("__tmp__",a);if(lzw_decode(localStorage.getItem("__tmp__"))==d){localStorage.setItem(core.firstData.name+"_"+c,a)}else{localStorage.setItem(core.firstData.name+"_"+c,d)}localStorage.removeItem("__tmp__");if(c=="autoSave"){core.saves.ids[0]=true}else{if(/^save\d+$/.test(c)){core.saves.ids[parseInt(c.substring(4))]=true}}return true}catch(b){main.log(b);return false}};utils.prototype.getLocalStorage=function(b,a){var c=this.decompress(localStorage.getItem(core.firstData.name+"_"+b));return c==null?a:c};utils.prototype.removeLocalStorage=function(a){localStorage.removeItem(core.firstData.name+"_"+a);if(a=="autoSave"){delete core.saves.ids[0]}else{if(/^save\d+$/.test(a)){delete core.saves.ids[parseInt(a.substring(4))]}}};utils.prototype.setLocalForage=function(c,e,d,b){if(!core.platform.useLocalForage){if(this.setLocalStorage(c,e)){if(d){d()}}else{if(b){b()}}return}if(e==null){this.removeLocalForage(c);return}var a=lzw_encode(JSON.stringify(e).replace(/[\u007F-\uFFFF]/g,function(f){return"\\u"+("0000"+f.charCodeAt(0).toString(16)).substr(-4)}));localforage.setItem(core.firstData.name+"_"+c,a,function(f){if(f){if(b){b(f)}}else{if(c=="autoSave"){core.saves.ids[0]=true}else{if(/^save\d+$/.test(c)){core.saves.ids[parseInt(c.substring(4))]=true}}if(d){d()}}})};utils.prototype.getLocalForage=function(c,a,d,b){if(!core.platform.useLocalForage){var e=this.getLocalStorage(c,a);if(d){d(e)}return}localforage.getItem(core.firstData.name+"_"+c,function(f,h){if(f){if(b){b(f)}}else{if(!d){return}if(h!=null){var g=core.utils.decompress(h);d(g==null?a:g);return}d(a)}})};utils.prototype.removeLocalForage=function(b,c,a){if(!core.platform.useLocalForage){this.removeLocalStorage(b);if(c){c()}return}localforage.removeItem(core.firstData.name+"_"+b,function(d){if(d){if(a){a(d)}}else{if(b=="autoSave"){delete core.saves.ids[0]}else{if(/^save\d+$/.test(b)){delete core.saves.ids[parseInt(b.substring(4))]}}if(c){c()}}})};utils.prototype.setGlobal=function(a,b){if(core.isReplaying()){return}core.setLocalStorage(a,b)};utils.prototype.getGlobal=function(c,b){var d;if(core.isReplaying()){var a=core.status.replay.toReplay.shift();if(a.indexOf("input2:")==0){d=JSON.parse(core.decodeBase64(a.substring(7)))}else{core.control._replay_error(a);return core.getLocalStorage(c,b)}}else{d=core.getLocalStorage(c,b)}core.status.route.push("input2:"+core.encodeBase64(JSON.stringify(d)));return d};utils.prototype.clone=function(b,c,e){if(!core.isset(b)){return null}if(b instanceof Date){var a=new Date();a.setTime(b.getTime());return a}if(b instanceof Array){var a=[];for(var d in b){if(!c||c(d,b[d])){a[d]=core.clone(b[d],e?c:null,e)}}return a}if(b instanceof Function){return b}if(b instanceof Object){var a={};for(var d in b){if(b.hasOwnProperty(d)&&(!c||c(d,b[d]))){a[d]=core.clone(b[d],e?c:null,e)}}return a}return b};utils.prototype.splitImage=function(g,n,e){if(typeof g=="string"){g=core.getMappedName(g);g=core.material.images.images[g]}if(!g){return[]}n=n||32;e=e||n;var b=document.createElement("canvas");var c=b.getContext("2d");var a=[];for(var l=0;l<g.height;l+=e){for(var f=0;f<g.width;f+=n){var m=Math.min(n,g.width-f),d=Math.min(e,g.height-l);b.width=m;b.height=d;c.drawImage(g,f,l,m,d,0,0,m,d);var k=new Image();k.src=b.toDataURL("image/png");a.push(k)}}return a};utils.prototype.formatDate=function(a){if(!a){a=new Date()}return""+a.getFullYear()+"-"+core.setTwoDigits(a.getMonth()+1)+"-"+core.setTwoDigits(a.getDate())+" "+core.setTwoDigits(a.getHours())+":"+core.setTwoDigits(a.getMinutes())+":"+core.setTwoDigits(a.getSeconds())};utils.prototype.formatDate2=function(a){if(!a){a=new Date()}return""+a.getFullYear()+core.setTwoDigits(a.getMonth()+1)+core.setTwoDigits(a.getDate())+core.setTwoDigits(a.getHours())+core.setTwoDigits(a.getMinutes())+core.setTwoDigits(a.getSeconds())};utils.prototype.formatTime=function(a){return core.setTwoDigits(parseInt(a/3600000))+":"+core.setTwoDigits(parseInt(a/60000)%60)+":"+core.setTwoDigits(parseInt(a/1000)%60)};utils.prototype.setTwoDigits=function(a){return parseInt(a)<10?"0"+a:a};utils.prototype.formatBigNumber=function(h,f){h=Math.floor(parseFloat(h));if(!core.isset(h)){return"???"}var b=h<0?"-":"";h=Math.abs(h);if(h<=99999||(!f&&h<=999999)){return b+h}var a=[{val:1e+20,c:"g"},{val:1e+16,c:"j"},{val:1000000000000,c:"z"},{val:100000000,c:"e"},{val:10000,c:"w"},];for(var d=0;d<a.length;d++){var e=a[d];if(f){if(h>=e.val){var g=h/e.val;return b+g.toFixed(Math.max(0,Math.floor(3-Math.log10(g+1))))+e.c}}else{if(h>=10*e.val){var g=h/e.val;return b+g.toFixed(Math.max(0,Math.floor(4-Math.log10(g+1))))+e.c}}}return b+h};utils.prototype.arrayToRGB=function(a){var d=this.clamp(parseInt(a[0]),0,255),c=this.clamp(parseInt(a[1]),0,255),b=this.clamp(parseInt(a[2]),0,255);return"#"+((1<<24)+(d<<16)+(c<<8)+b).toString(16).slice(1)};utils.prototype.arrayToRGBA=function(a){if(a[3]==null){a[3]=1}var e=this.clamp(parseInt(a[0]),0,255),d=this.clamp(parseInt(a[1]),0,255),c=this.clamp(parseInt(a[2]),0,255),b=this.clamp(parseFloat(a[3]),0,1);return"rgba("+e+","+d+","+c+","+b+")"};utils.prototype.encodeRoute=function(d){var a="",c="",b=0;d.forEach(function(e){if(e=="up"||e=="down"||e=="left"||e=="right"){if(e!=c&&b>0){a+=c.substring(0,1).toUpperCase();if(b>1){a+=b}b=0}c=e;b++}else{if(b>0){a+=c.substring(0,1).toUpperCase();if(b>1){a+=b}b=0}a+=core.utils._encodeRoute_encodeOne(e)}});if(b>0){a+=c.substring(0,1).toUpperCase();if(b>1){a+=b}}return LZString.compressToBase64(a)};utils.prototype._encodeRoute_id2number=function(a){var b=core.maps.getNumberById(a);return b==0?a:b};utils.prototype._encodeRoute_encodeOne=function(a){if(a.indexOf("item:")==0){return"I"+this._encodeRoute_id2number(a.substring(5))+":"}else{if(a.indexOf("unEquip:")==0){return"u"+a.substring(8)}else{if(a.indexOf("equip:")==0){return"e"+this._encodeRoute_id2number(a.substring(6))+":"}else{if(a.indexOf("fly:")==0){return"F"+a.substring(4)+":"}else{if(a.indexOf("choices:")==0){return"C"+a.substring(8)}else{if(a.indexOf("shop:")==0){return"S"+a.substring(5)}else{if(a=="turn"){return"T"}else{if(a.indexOf("turn:")==0){return"t"+a.substring(5).substring(0,1).toUpperCase()+":"}else{if(a=="getNext"){return"G"}else{if(a.indexOf("input:")==0){return"P"+a.substring(6)}else{if(a.indexOf("input2:")==0){return"Q"+a.substring(7)+":"}else{if(a=="no"){return"N"}else{if(a.indexOf("move:")==0){return"M"+a.substring(5)}else{if(a.indexOf("key:")==0){return"K"+a.substring(4)}else{if(a.indexOf("random:")==0){return"X"+a.substring(7)}}}}}}}}}}}}}}}return"("+a+")"};utils.prototype.decodeRoute=function(c){if(!c){return c}try{var d=LZString.decompressFromBase64(c);if(d!=null&&/^[-_a-zA-Z0-9+\/=:()]*$/.test(d)){if(d!=""||c.length<8){c=d}}}catch(b){}var a={route:c,index:0,ans:[]};while(a.index<a.route.length){this._decodeRoute_decodeOne(a,a.route.charAt(a.index++))}return a.ans};utils.prototype._decodeRoute_getNumber=function(a,b){var c="";while(a.index<a.route.length&&!isNaN(a.route.charAt(a.index))){c+=a.route.charAt(a.index++)}if(c.length==0){c="1"}return b?c:parseInt(c)};utils.prototype._decodeRoute_getString=function(a){var b="";while(a.index<a.route.length&&a.route.charAt(a.index)!=":"){b+=a.route.charAt(a.index++)}a.index++;return b};utils.prototype._decodeRoute_number2id=function(b){if(/^\d+$/.test(b)){var a=core.maps.blocksInfo[b];if(a){return a.id}}return b};utils.prototype._decodeRoute_decodeOne=function(b,a){if(a=="("){var e=b.route.indexOf(")",b.index);if(e>=0){b.ans.push(b.route.substring(b.index,e));b.index=e+1;return}}var g=(a=="I"||a=="e"||a=="F"||a=="S"||a=="Q"||a=="t")?this._decodeRoute_getString(b):this._decodeRoute_getNumber(b);var f={U:"up",D:"down",L:"left",R:"right"};switch(a){case"U":case"D":case"L":case"R":for(var d=0;d<g;d++){b.ans.push(f[a])}break;case"I":b.ans.push("item:"+this._decodeRoute_number2id(g));break;case"u":b.ans.push("unEquip:"+g);break;case"e":b.ans.push("equip:"+this._decodeRoute_number2id(g));break;case"F":b.ans.push("fly:"+g);break;case"C":b.ans.push("choices:"+g);break;case"S":b.ans.push("shop:"+g+":"+this._decodeRoute_getNumber(b,true));break;case"T":b.ans.push("turn");break;case"t":b.ans.push("turn:"+f[g]);break;case"G":b.ans.push("getNext");break;case"P":b.ans.push("input:"+g);break;case"Q":b.ans.push("input2:"+g);break;case"N":b.ans.push("no");break;case"M":++b.index;b.ans.push("move:"+g+":"+this._decodeRoute_getNumber(b));break;case"K":b.ans.push("key:"+g);break;case"X":b.ans.push("random:"+g);break}};utils.prototype.isset=function(a){return a!=null&&!(typeof a=="number"&&isNaN(a))};utils.prototype.subarray=function(c,d){if(!(c instanceof Array)||!(d instanceof Array)||c.length<d.length){return null}var e=core.clone(c),f=core.clone(d);while(f.length>0){if(e.shift()!=f.shift()){return null}}return e};utils.prototype.inArray=function(a,b){return(a instanceof Array)&&a.indexOf(b)>=0};utils.prototype.clamp=function(g,c,d){var f=Math.min(c,d),e=Math.max(c,d);return Math.min(Math.max(g||0,f),e)};utils.prototype.getCookie=function(b){var a=document.cookie.match(new RegExp("(^| )"+b+"=([^;]+)"));return a?a[2]:null};utils.prototype.setStatusBarInnerHTML=function(e,g,a){if(!core.statusBar[e]){return}var b=false;if(typeof g=="number"){g=this.formatBigNumber(g);b=true}var c=/^[-a-zA-Z0-9`~!@#$%^&*()_=+\[{\]}\\|;:'",<.>\/?]*$/.test(g);var f="font-style: "+(c?"italic":"normal")+"; ";f+="text-shadow: #000 1px 0 0, #000 0 1px 0, #000 -1px 0 0, #000 0 -1px 0; ";var d=this.strlen(g)||1;f+="font-size: "+Math.min(1,7/d)+"em; ";if(a){f+=a}if(b){core.statusBar[e].innerHTML="<span class='_status' style='"+f+"'>"+g+"</span>"}else{core.statusBar[e].innerHTML="<span class='_status' style='"+f+"'></span>";core.statusBar[e].children[0].innerText=g}};utils.prototype.strlen=function(d){var a=0;for(var b=0,c=d.length;b<c;b++){a+=d.charCodeAt(b)<256?1:2}return a};utils.prototype.reverseDirection=function(a){a=a||core.getHeroLoc("direction");return{left:"right",right:"left",down:"up",up:"down"}[a]||a};utils.prototype.matchWildcard=function(a,b){return new RegExp("^"+a.split(/\*+/).map(function(c){return c.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}).join(".*")+"$").test(b)};utils.prototype.encodeBase64=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,c){return String.fromCharCode(parseInt(c,16))}))};utils.prototype.decodeBase64=function(a){return decodeURIComponent(atob(a).split("").map(function(b){return"%"+("00"+b.charCodeAt(0).toString(16)).slice(-2)}).join(""))};utils.prototype.convertBase=function(f,b,h){var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~`!@#$%^&*()_-+={}[]\\|:;<>,.?/";if(b==h){return f}var d=f.length,a="";var g=[];for(var c=0;c<d;c++){g[c]=e.indexOf(f.charAt(c))}g[d]=0;while(d>0){for(var c=d;c>=1;c--){g[c-1]+=g[c]%h*b;g[c]=parseInt(g[c]/h)}a+=e.charAt(g[0]%h);g[0]=parseInt(g[0]/h);while(d>0&&g[d-1]==0){d--}}return a};utils.prototype.rand=function(b){var c=core.getFlag("__rand__");c=this.__next_rand(c);core.setFlag("__rand__",c);var a=c/2147483647;if(b&&b>0){return Math.floor(a*b)}return a};utils.prototype.rand2=function(b){b=b||2147483648;var c;if(core.isReplaying()){var a=core.status.replay.toReplay.shift();if(a.indexOf("random:")==0){c=parseInt(a.substring(7))}else{core.control._replay_error(a);return 0}}else{c=Math.floor(Math.random()*b)}core.status.route.push("random:"+c);return c};utils.prototype.__init_seed=function(){var a=new Date().getTime()%34834795+3534;a=this.__next_rand(a);a=this.__next_rand(a);a=this.__next_rand(a);core.setFlag("__seed__",a);core.setFlag("__rand__",a)};utils.prototype.__next_rand=function(a){a=(a%127773)*16807-~~(a/127773)*2836;a+=a<0?2147483647:0;return a};utils.prototype.readFile=function(d,b,a,c){core.platform.successCallback=d;core.platform.errorCallback=b;if(window.jsinterface){window.jsinterface.readFile();return}if(!core.platform.isOnline){alert("离线状态下不支持文件读取！");if(b){b()}return}if(core.platform.fileReader==null){alert("当前浏览器不支持FileReader！");if(b){b()}return}if(core.platform.fileInput==null){core.platform.fileInput=document.createElement("input");core.platform.fileInput.style.opacity=0;core.platform.fileInput.type="file";core.platform.fileInput.onchange=function(){var e=core.platform.fileInput.files;if(e.length==0){if(core.platform.errorCallback){core.platform.errorCallback()}return}if(!c){core.platform.fileReader.readAsText(core.platform.fileInput.files[0])}else{core.platform.fileReader.readAsDataURL(core.platform.fileInput.files[0])}core.platform.fileInput.value=""};if(a){core.platform.fileInput.accept=a}}core.platform.fileInput.click()};utils.prototype.readFileContent=function(a){var c=null;if(a.slice(0,4)==="data"){if(core.platform.successCallback){core.platform.successCallback(a)}return}try{c=JSON.parse(a);if(c){if(core.platform.successCallback){core.platform.successCallback(c)}return}}catch(b){main.log(b);alert(b)}if(core.platform.errorCallback){core.platform.errorCallback()}};utils.prototype.download=function(d,b){if(window.jsinterface){window.jsinterface.download(d,b);return}if(!core.platform.isOnline){alert("离线状态下不支持下载操作！");return}if(core.platform.isIOS){if(core.copy(b)){alert("iOS平台下不支持直接下载文件！\n所有应下载内容已经复制到您的剪切板，请自行创建空白文件并粘贴。")}else{alert("iOS平台下不支持下载操作！")}return}if(!core.platform.isPC){if(!core.platform.isChrome||core.platform.isQQ||core.platform.isWeChat){if(core.copy(b)){alert("移动端只有Chrome浏览器支持直接下载文件！\n所有应下载内容已经复制到您的剪切板，请自行创建空白文件并粘贴。")}else{alert("该平台或浏览器暂不支持下载操作！")}return}}if(core.platform.isSafari){alert("你当前使用的是Safari浏览器，不支持直接下载文件。\n即将打开一个新窗口为应下载内容，请自行全选复制然后创建空白文件并粘贴。");var a=new Blob([b],{type:"text/plain;charset=utf-8"});var e=window.URL.createObjectURL(a);var f=window.open(e,"_blank");window.URL.revokeObjectURL(e);return}var a=new Blob([b],{type:"text/plain;charset=utf-8"});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveBlob(a,d)}else{var e=window.URL.createObjectURL(a);var c=window.document.createElement("a");c.href=e;c.download=d;document.body.appendChild(c);c.click();document.body.removeChild(c);window.URL.revokeObjectURL(e)}};utils.prototype.copy=function(a){if(window.jsinterface){window.jsinterface.copy(a);return true}if(!core.platform.supportCopy){return false}var d=document.createElement("textarea");d.style.position="fixed";d.style.top=0;d.style.left=0;d.style.width="2em";d.style.height="2em";d.style.padding=0;d.style.border="none";d.style.outline="none";d.style.boxShadow="none";d.style.background="transparent";d.value=a;document.body.appendChild(d);d.focus();d.setSelectionRange(0,d.value.length);var c=false;try{c=document.execCommand("copy")}catch(b){c=false}document.body.removeChild(d);return c};utils.prototype.myconfirm=function(a,c,b){main.dom.inputDiv.style.display="block";main.dom.inputMessage.innerHTML=a.replace(/\n/g,"<br/>");main.dom.inputBox.style.display="none";main.dom.inputYes.blur();main.dom.inputNo.blur();core.status.holdingKeys=[];core.platform.successCallback=c;core.platform.errorCallback=b};utils.prototype.myprompt=function(b,c,a){main.dom.inputDiv.style.display="block";main.dom.inputMessage.innerHTML=b.replace(/\n/g,"<br/>");main.dom.inputBox.style.display="block";main.dom.inputBox.value=c==null?"":c;main.dom.inputYes.blur();main.dom.inputNo.blur();setTimeout(function(){main.dom.inputBox.focus()});core.status.holdingKeys=[];core.platform.successCallback=core.platform.errorCallback=a};utils.prototype.showWithAnimate=function(b,e,a){b.style.display="block";if(!e||main.mode!="play"){b.style.opacity=1;if(a){a()}return}b.style.opacity=0;var c=0;var d=window.setInterval(function(){c+=0.03;b.style.opacity=c;if(c>1){clearInterval(d);if(a){a()}}},e)};utils.prototype.hideWithAnimate=function(c,e,a){if(!e||main.mode!="play"){c.style.display="none";if(a){a()}return}c.style.opacity=1;var d=1;var b=window.setInterval(function(){d-=0.03;c.style.opacity=d;if(d<0){c.style.display="none";clearInterval(b);if(a){a()}}},e)};utils.prototype._encodeCanvas=function(c){var g=[];var j=c.canvas.width,d=c.canvas.height;c.mozImageSmoothingEnabled=false;c.webkitImageSmoothingEnabled=false;c.msImageSmoothingEnabled=false;c.imageSmoothingEnabled=false;var f=c.getImageData(0,0,j,d);for(var e=0;e<f.data.length;e+=4){g.push(Math.sign(f.data[e+3]))}var h=0,b=0,a=[];for(var e=0;e<g.length;e++){if(g[e]!=h){a.push(b);h=g[e];b=0}b++}a.push(b);return a};utils.prototype._decodeCanvas=function(a,j,c){var h=core.bigmap.tempCanvas;h.canvas.width=j;h.canvas.height=c;h.clearRect(0,0,j,c);if(!a){return null}var b=0,g=[];a.forEach(function(l){for(var k=0;k<l;k++){g.push(b)}b=1-b});var e=h.getImageData(0,0,j,c);for(var d=0;d<e.data.length;d+=4){var f=d/4;if(g[f]){e.data[d]=255;e.data[d+3]=255}}h.putImageData(e,0,0)};utils.prototype.consoleOpened=function(){if(!core.flags.checkConsole){return false}if(window.Firebug&&window.Firebug.chrome&&window.Firebug.chrome.isInitialized){return true}if(!core.platform.isPC){return false}var a=160;var b=Math.min(window.outerWidth/window.innerWidth,window.outerHeight/window.innerHeight);return window.outerWidth-b*window.innerWidth>a||window.outerHeight-b*window.innerHeight>a};utils.prototype.hashCode=function(d){if(typeof d=="string"){var b=0,c,a;if(d.length===0){return b}for(c=0;c<d.length;c++){a=d.charCodeAt(c);b=((b<<5)-b)+a;b|=0}return b}return this.hashCode(JSON.stringify(d).split("").sort().join(""))};utils.prototype.same=function(c,d){if(c==null&&d==null){return true}if(c==null||d==null){return false}if(c===d){return true}if(c instanceof Array&&d instanceof Array){if(c.length!=d.length){return false}for(var e=0;e<c.length;e++){if(!this.same(c[e],d[e])){return false}}return true}if(c instanceof Object&&d instanceof Object){for(var e in c){if(!this.same(c[e],d[e])){return false}}for(var e in d){if(!this.same(c[e],d[e])){return false}}return true}return false};utils.prototype._export=function(b){if(!b){b=[core.status.floorId]}else{if(b=="all"){b=core.clone(core.floorIds)}else{if(typeof b=="string"){b=[b]}}}var e={};var a=b.length+"\n"+core.__SIZE__+" "+core.__SIZE__+"\n\n";b.forEach(function(h){var g=core.maps._getMapArrayFromBlocks(core.status.maps[h].blocks,core.__SIZE__,core.__SIZE__);a+=g.map(function(i){i.forEach(function(k){var j=core.maps.getBlockByNumber(k);if(j.event.cls.indexOf("enemy")==0){e[k]=j.event.id}});return i.join("\t")}).join("\n")+"\n\n"});a+=["redJewel","blueJewel","greenJewel","redPotion","bluePotion","yellowPotion","greenPotion","sword1","shield1"].map(function(g){return core.values[g]||0}).join(" ")+"\n\n";a+=Object.keys(e).length+"\n";for(var f in e){var c=e[f],d=core.material.enemys[c];a+=f+" "+d.hp+" "+d.atk+" "+d.def+" "+d.money+" "+d.special+"\n"}a+="\n0 0 0 0 0 0\n\n";a+=core.status.hero.hp+" "+core.status.hero.atk+" "+core.status.hero.def+" "+core.status.hero.mdef+" "+core.status.hero.money+" "+core.itemCount("yellowKey")+" "+core.itemCount("blueKey")+" "+core.itemCount("redKey")+" 0 "+core.status.hero.loc.x+" "+core.status.hero.loc.y+"\n";console.log(a)};utils.prototype.unzip=function(b,e,d,c){var a=function(f){main.log(f);if(d){d(f)}};if(!window.zip){return a("zip.js not exists!")}if(typeof b=="string"){return core.http("GET",b,null,function(f){core.unzip(f,e,d,c)},a,"application/zip","blob")}if(!(b instanceof Blob)){return a("Should use Blob or URL as input")}zip.createReader(new zip.BlobReader(b),function(f){f.getEntries(function(g){core.utils._unzip_readEntries(g,function(h){f.close(function(){if(e){e(h)}})},c)})},a)};utils.prototype._unzip_readEntries=function(b,e,a){var d={};if(b==null){return e(d)}var c=b.length;b.forEach(function(f){f.getData(a?new zip.TextWriter("utf8"):new zip.BlobWriter(),function(g){d[f.filename]=g;c--;if(c==0){e(d)}})})};utils.prototype.http=function(f,g,b,e,a,c,d){var h=new XMLHttpRequest();h.open(f,g,true);if(c){h.overrideMimeType(c)}if(d){h.responseType=d}h.onload=function(i){if(h.status==200){if(e){e(h.response)}}else{if(a){a("HTTP "+h.status)}}};h.onabort=function(){if(a){a("Abort")}};h.ontimeout=function(){if(a){a("Timeout")}};h.onerror=function(){if(a){a("Error on Connection")}};if(b){h.send(b)}else{h.send()}};utils.prototype.httpAndZip=function(c,b,a){this.http("GET",c,null,function(d){},a,null,"blob")};function lzw_encode(h){var d={};var c=(h+"").split("");var f=[];var b;var g=c[0];var a=256;for(var e=1;e<c.length;e++){b=c[e];if(d[g+b]!=null){g+=b}else{f.push(g.length>1?d[g]:g.charCodeAt(0));d[g+b]=a;a++;g=b}}f.push(g.length>1?d[g]:g.charCodeAt(0));for(var e=0;e<f.length;e++){f[e]=String.fromCharCode(f[e])}return f.join("")}function lzw_decode(k){var e={};var d=(k+"").split("");var b=d[0];var g=b;var h=[b];var a=256;var j;for(var f=1;f<d.length;f++){var c=d[f].charCodeAt(0);if(c<256){j=d[f]}else{j=e[c]?e[c]:(g+b)}h.push(j);b=j.charAt(0);e[a]=g+b;a++;g=j}return h.join("")};