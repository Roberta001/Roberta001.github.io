"use strict";function events(){this._init()}events.prototype._init=function(){this.eventdata=functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a.events;this.commonEvent=events_c12a15a8_c380_4b28_8144_256cba95f760.commonEvent;this.systemEvents={};this.actions={}};events.prototype.resetGame=function(c,b,a,d,e){this.eventdata.resetGame(c,b,a,d,e)};events.prototype.startGame=function(b,d,c,a){main.dom.levelChooseButtons.style.display="none";main.dom.startButtonGroup.style.display="none";b=b||"";if(main.mode!="play"){return}if(core.flags.startUsingCanvas||c!=null){core.dom.startPanel.style.display="none";this._startGame_start(b,d,c,a)}else{core.hideStartAnimate(function(){core.events._startGame_start(b,d,c,a)})}};events.prototype._startGame_start=function(b,e,d,a){core.resetGame(core.firstData.hero,b,null,core.clone(core.initStatus.maps));var c=core.clone(core.getHeroLoc());core.setHeroLoc("x",-1);core.setHeroLoc("y",-1);if(e!=null){core.setFlag("__seed__",e);core.setFlag("__rand__",e)}else{core.utils.__init_seed()}this.setInitData();core.clearStatusBar();var f=[];if(core.flags.startUsingCanvas){core.hideStatusBar();core.dom.musicBtn.style.display="block";core.push(f,core.firstData.startCanvas)}core.push(f,core.firstData.startText);this.insertAction(f,null,null,function(){core.events._startGame_afterStart(c,a)});if(d!=null){core.startReplay(d)}};events.prototype._startGame_afterStart=function(b,a){core.ui.closePanel();this._startGame_statusBar();core.changeFloor(core.firstData.floorId,null,b,null,function(){core.insertAction([]);if(a){a()}});this._startGame_upload()};events.prototype._startGame_statusBar=function(){if(core.flags.startUsingCanvas){core.hideStatusBar()}else{core.showStatusBar()}};events.prototype._startGame_upload=function(){var a=new FormData();a.append("type","people");a.append("name",core.firstData.name);a.append("version",core.firstData.version);a.append("platform",core.platform.string);a.append("hard",core.encodeBase64(core.status.hard));a.append("hardCode",core.getFlag("hard",0));a.append("base64",1);core.utils.http("POST","/games/upload.php",a)};events.prototype.setInitData=function(){return this.eventdata.setInitData()};events.prototype.win=function(c,b,a){if(!a){core.status.gameOver=true}return this.eventdata.win(c,b,a)};events.prototype.lose=function(a){core.status.gameOver=true;return this.eventdata.lose(a)};events.prototype.gameOver=function(a,b,c){if(!core.status.extraEvent){core.clearMap("all");core.deleteAllCanvas();core.dom.gif2.innerHTML="";core.setWeather()}core.ui.closePanel();if(main.isCompetition&&a!=null){if(a==""){a="恭喜通关"}a+="[比赛]"}var d=null;if(b){d="录像回放完毕！"}else{if(core.hasFlag("debug")){d="\t[系统提示]调试模式下无法上传成绩"}else{if(core.hasFlag("__consoleOpened__")){d="\t[系统提示]本存档开启过控制台，无法上传成绩"}}}if(d!=null){core.drawText(d,core.restart)}else{this._gameOver_confirmUpload(a,c)}};events.prototype._gameOver_confirmUpload=function(a,b){core.ui.closePanel();if(a==null){this._gameOver_confirmDownload(a);return}core.ui.drawConfirmBox("你想记录你的ID和成绩吗？",function(){if(main.isCompetition){core.events._gameOver_doUpload("",a,b)}else{core.myprompt("请输入你的ID：",core.getCookie("id")||"",function(c){core.events._gameOver_doUpload(c,a,b)})}},function(){if(main.isCompetition){core.events._gameOver_confirmDownload(a)}else{core.events._gameOver_doUpload(null,a,b)}})};events.prototype._gameOver_doUpload=function(e,a,d){var c=core.status.hero.hp;if(e==null){c=1}core.ui.closePanel();var b=new FormData();b.append("type","score");b.append("name",core.firstData.name);b.append("version",core.firstData.version);b.append("platform",core.platform.string);b.append("hard",core.encodeBase64(core.status.hard));b.append("username",core.encodeBase64(e||""));b.append("ending",core.encodeBase64(a));b.append("lv",core.status.hero.lv);b.append("hp",Math.min(c,Math.pow(2,63)));b.append("atk",core.status.hero.atk);b.append("def",core.status.hero.def);b.append("mdef",core.status.hero.mdef);b.append("money",core.status.hero.money);b.append("experience",core.status.hero.experience);b.append("steps",core.status.hero.steps);b.append("norank",d?1:0);b.append("seed",core.getFlag("__seed__"));b.append("totalTime",Math.floor(core.status.hero.statistics.totalTime/1000));b.append("route",core.encodeRoute(core.status.route));b.append("base64",1);if(main.isCompetition){core.http("POST","/games/competition/upload.php",b)}else{core.http("POST","/games/upload.php",b)}core.events._gameOver_confirmDownload(a)};events.prototype._gameOver_confirmDownload=function(a){core.ui.closePanel();core.ui.drawConfirmBox("你想下载录像吗？",function(){var b={name:core.firstData.name,version:core.firstData.version,hard:core.status.hard,seed:core.getFlag("__seed__"),route:core.encodeRoute(core.status.route)};core.download(core.firstData.name+"_"+core.formatDate2(new Date())+".h5route",JSON.stringify(b));core.events._gameOver_askRate(a)},function(){core.events._gameOver_askRate(a)})};events.prototype._gameOver_askRate=function(a){core.ui.closePanel();if(core.status.extraEvent){core.status.event=core.status.extraEvent;delete core.status.extraEvent;core.lockControl();core.doAction();return}if(a==null){core.status.event.selection=0;core.ui.drawConfirmBox("你想读取自动存档么？",function(){core.ui.closePanel();core.doSL("autoSave","load")},function(){core.ui.closePanel();core.restart()});return}core.ui.drawConfirmBox("恭喜通关本塔，你想进行评分吗？",function(){if(core.platform.isPC){window.open("/score.php?name="+core.firstData.name+"&num=10","_blank");core.restart()}else{window.location.href="/score.php?name="+core.firstData.name+"&num=10"}},function(){core.restart()})};events.prototype.restart=function(){core.showStartAnimate();core.playBgm(main.startBgm)};events.prototype.confirmRestart=function(){core.status.event.selection=1;core.ui.drawConfirmBox("你确定要返回标题页面吗？",function(){core.ui.closePanel();core.restart()},function(){core.ui.closePanel()})};events.prototype.registerSystemEvent=function(b,a){this.systemEvents[b]=a};events.prototype.unregisterSystemEvent=function(a){delete this.systemEvents[a]};events.prototype.doSystemEvent=function(d,b,a){if(this.systemEvents[d]){try{return core.doFunc(this.systemEvents[d],this,b,a)}catch(c){main.log(c);main.log("ERROR in systemEvents["+d+"]")}}if(this["_sys_"+d]){return this["_sys_"+d](b,a)}main.log("未知的系统事件: "+d+"！");if(a){a()}};events.prototype._trigger=function(x,y){if(core.status.gameOver){return}if(core.status.event.id=="action"){core.insertAction({type:"trigger",loc:[x,y]},x,y,null,true);return}if(core.status.event.id){return}var block=core.getBlock(x,y);if(block==null){return}block=block.block;try{eval(block.event.script)}catch(e){main.log(e)}if(block.event.trigger){var noPass=block.event.noPass,trigger=block.event.trigger;if(noPass){core.clearAutomaticRouteNode(x,y)}if(trigger=="changeFloor"&&!noPass&&this._trigger_ignoreChangeFloor(block)){return}core.status.automaticRoute.moveDirectly=false;this.doSystemEvent(trigger,block)}};events.prototype._trigger_ignoreChangeFloor=function(b){var a=core.flags.ignoreChangeFloor;if(b.event.data&&b.event.data.ignoreChangeFloor!=null){a=b.event.data.ignoreChangeFloor}if(a){if(core.isReplaying()){if(core.status.replay.toReplay[0]=="no"){core.status.replay.toReplay.shift();core.status.route.push("no");return true}}else{if(core.status.automaticRoute.autoHeroMove||core.status.automaticRoute.autoStep<core.status.automaticRoute.autoStepRoutes.length){core.status.route.push("no");return true}}}return false};events.prototype._sys_battle=function(b,a){this.battle(b.event.id,b.x,b.y,false,a)};events.prototype.battle=function(c,d,e,b,a){core.saveAndStopAutomaticRoute();c=c||core.getBlockId(d,e);if(!c){return core.clearContinueAutomaticRoute(a)}if(!core.enemys.canBattle(c,d,e)&&!b&&!core.status.event.id){core.drawTip("你打不过此怪物！",null,true);return core.clearContinueAutomaticRoute(a)}if(!core.status.event.id){core.autosave(true)}if(!this.beforeBattle(c,d,e)){return core.clearContinueAutomaticRoute(a)}this.afterBattle(c,d,e,a)};events.prototype.beforeBattle=function(a,b,c){return this.eventdata.beforeBattle(a,b,c)};events.prototype.afterBattle=function(b,c,d,a){return this.eventdata.afterBattle(b,c,d,a)};events.prototype._sys_openDoor=function(b,a){this.openDoor(b.x,b.y,true,function(){core.replay();if(a){a()}})};events.prototype.openDoor=function(e,f,d,a){var b=core.getBlockId(e,f);core.saveAndStopAutomaticRoute();if(!this._openDoor_check(b,e,f,d)){var c=core.status.lockControl;core.waitHeroToStop(function(){if(!c){core.unLockControl()}if(a){a()}});return}core.playSound("door.mp3");this._openDoor_animate(b,e,f,a)};events.prototype._openDoor_check=function(a,d,e,c){if(!core.terrainExists(d,e,a)||!(a.endsWith("Door")||a.endsWith("Wall"))||core.material.icons.animates[a]==null){core.clearContinueAutomaticRoute();return false}if(a=="steelDoor"&&core.flags.steelDoorWithoutKey){c=false}if(c&&a.endsWith("Door")){var b=a.replace("Door","Key");if(!core.hasItem(b)){if(b!="specialKey"&&b!="steelKey"){core.drawTip("你没有"+((core.material.items[b]||{}).name||"钥匙"),null,true)}else{core.drawTip("无法开启此门",null,true)}core.clearContinueAutomaticRoute();return false}if(!core.status.event.id){core.autosave(true)}core.removeItem(b)}return true};events.prototype._openDoor_animate=function(d,h,i,b){var c=core.material.icons.animates[d];var f=d.endsWith("Door")?30:70;var e=core.status.lockControl;core.lockControl();core.status.replay.animate=true;core.removeBlock(h,i);core.drawImage("event",core.material.images.animates,0,32*c,32,32,32*h,32*i,32,32);var g=0;var a=window.setInterval(function(){core.clearMap("event",32*h,32*i,32,32);g++;if(g==4){clearInterval(a);delete core.animateFrame.asyncId[a];if(!e){core.unLockControl()}core.status.replay.animate=false;core.events.afterOpenDoor(d,h,i,b);return}core.drawImage("event",core.material.images.animates,32*g,32*c,32,32,32*h,32*i,32,32)},core.status.replay.speed==24?1:f/Math.max(core.status.replay.speed,1));core.animateFrame.asyncId[a]=true};events.prototype.afterOpenDoor=function(b,c,d,a){return this.eventdata.afterOpenDoor(b,c,d,a)};events.prototype._sys_getItem=function(b,a){this.getItem(b.event.id,1,b.x,b.y,a)};events.prototype.getItem=function(d,h,j,k,a){if(h==null){h=1}h=h||1;var f=core.material.items[d].cls;core.items.getItemEffect(d,h);core.removeBlock(j,k);var i="获得 "+core.material.items[d].name;if(h>1){i+="x"+h}if(f==="items"&&h==1){i+=core.items.getItemEffectTip(d)}core.drawTip(i,d);if(!core.hasFlag("__itemHint__")){core.setFlag("__itemHint__",[])}var g=core.getFlag("__itemHint__");if(core.flags.itemFirstText&&g.indexOf(d)<0&&f!="items"){var c=core.material.items[d].text||"该道具暂无描述";try{c=core.replaceText(c)}catch(b){}if(!core.status.event.id||core.status.event.id=="action"){core.insertAction("\t["+core.material.items[d].name+","+d+"]"+c+"\n"+(f=="keys"||d=="greenKey"||d=="steelKey"?"（钥匙类道具，遇到对应的门时自动打开）":f=="tools"?"（消耗类道具，请按T在道具栏使用）":f=="constants"?"（永久类道具，请按T在道具栏使用）":f=="equips"?"（装备类道具，请按Q在装备栏进行装备）":""))}g.push(d)}core.updateStatusBar();this.afterGetItem(d,j,k,a)};events.prototype.afterGetItem=function(b,c,d,a){this.eventdata.afterGetItem(b,c,d,a)};events.prototype.getNextItem=function(b){if(core.isMoving()||!core.flags.enableGentleClick){return false}if(this._canGetNextItem()){return this._getNextItem(null,b)}var a=["up","down","left","right"].filter(function(c){return core.events._canGetNextItem(c)});return a.length==1?this._getNextItem(a[0]):false};events.prototype._canGetNextItem=function(b){b=b||core.getHeroLoc("direction");if(!core.canMoveHero(null,null,b)){return}var c=core.getHeroLoc("x")+core.utils.scan[b].x;var d=core.getHeroLoc("y")+core.utils.scan[b].y;var a=core.getBlock(c,d);return a!=null&&a.block.event.trigger=="getItem"};events.prototype._getNextItem=function(a,b){a=a||core.getHeroLoc("direction");var c=core.getHeroLoc("x")+core.utils.scan[a].x;var d=core.getHeroLoc("y")+core.utils.scan[a].y;if(!b){core.status.route.push("getNext")}this.getItem(core.getBlockId(c,d),1,c,d);return true};events.prototype._sys_changeFloor=function(b,a){b=b.event.data;var c={};if(b.loc){c={x:b.loc[0],y:b.loc[1]}}if(b.direction){c.direction=b.direction}if(core.status.event.id!="action"){core.status.event.id=null}core.changeFloor(b.floorId,b.stair,c,b.time,function(){core.replay();if(a){a()}})};events.prototype.changeFloor=function(b,f,d,g,a,c){var e=this._changeFloor_getInfo(b,f,d,g);if(e==null){if(a){a()}return}e.fromLoad=c;b=e.floorId;e.locked=core.status.lockControl;core.lockControl();core.stopAutomaticRoute();core.clearContinueAutomaticRoute();core.status.replay.animate=true;clearInterval(core.interval.onDownInterval);core.interval.onDownInterval="tmp";this._changeFloor_beforeChange(e,a)};events.prototype._changeFloor_getInfo=function(b,e,c,f){b=b||core.status.floorId;var a=b;if(b==":before"){var d=core.floorIds.indexOf(core.status.floorId);if(d>0){b=core.floorIds[d-1]}else{b=core.status.floorId}}else{if(b==":next"){var d=core.floorIds.indexOf(core.status.floorId);if(d<core.floorIds.length-1){b=core.floorIds[d+1]}else{b=core.status.floorId}}}if(!core.status.maps[b]){main.log("不存在的楼层："+b);return null}if(main.mode!="play"||core.isReplaying()){f=0}if(f==null){f=core.values.floorChangeTime}if(f==null){f=800}if(f<100){f=0}f/=20;return{floorId:b,time:f,_floorId:a,heroLoc:core.clone(this._changeFloor_getHeroLoc(b,e,c))}};events.prototype._changeFloor_getHeroLoc=function(b,e,c){if(!c){c=core.clone(core.status.hero.loc)}if(e){if(e==":now"){c=core.clone(core.status.hero.loc)}else{if(e==":symmetry"){c.x=core.bigmap.width-1-core.getHeroLoc("x");c.y=core.bigmap.height-1-core.getHeroLoc("y")}else{if(e==":symmetry_x"){c.x=core.bigmap.width-1-core.getHeroLoc("x")}else{if(e==":symmetry_y"){c.y=core.bigmap.height-1-core.getHeroLoc("y")}else{if(core.status.maps[b][e]){c.x=core.status.maps[b][e][0];c.y=core.status.maps[b][e][1]}else{var a=core.status.maps[b].blocks;for(var d in a){if(!a[d].disable&&a[d].event.id===e){c.x=a[d].x;c.y=a[d].y;break}}}}}}}}["x","y","direction"].forEach(function(f){if(c[f]==null){c[f]=core.getHeroLoc(f)}});return c};events.prototype._changeFloor_beforeChange=function(b,a){core.playSound("floor.mp3");window.setTimeout(function(){if(b.time==0){core.events._changeFloor_changing(b,a)}else{core.showWithAnimate(core.dom.floorMsgGroup,b.time/2,function(){core.events._changeFloor_changing(b,a)})}},25)};events.prototype._changeFloor_changing=function(b,a){this.changingFloor(b.floorId,b.heroLoc,b.fromLoad);if(b.time==0){this._changeFloor_afterChange(b,a)}else{core.hideWithAnimate(core.dom.floorMsgGroup,b.time/4,function(){core.events._changeFloor_afterChange(b,a)})}};events.prototype._changeFloor_afterChange=function(b,a){if(!b.locked){core.unLockControl()}core.status.replay.animate=false;core.events.afterChangeFloor(b.floorId,b.fromLoad,b);if(a){a()}};events.prototype.changingFloor=function(a,c,b){this.eventdata.changingFloor(a,c,b)};events.prototype.afterChangeFloor=function(a,b,c){if(main.mode!="play"){return}return this.eventdata.afterChangeFloor(a,b,c)};events.prototype.hasVisitedFloor=function(a){return core.getFlag("__visited__")[a]||false};events.prototype.visitFloor=function(a){core.getFlag("__visited__")[a]=true};events.prototype._sys_passNet=function(b,a){this.passNet(b);if(a){a()}};events.prototype.passNet=function(a){if(!core.hasItem("shoes")){if(a.event.id=="poisonNet"){core.insertAction({type:"insert",name:"毒衰咒处理",args:[0]})}else{if(a.event.id=="weakNet"){core.insertAction({type:"insert",name:"毒衰咒处理",args:[1]})}else{if(a.event.id=="curseNet"){core.insertAction({type:"insert",name:"毒衰咒处理",args:[2]})}}}}this.afterPassNet(a.x,a.y,a.event.id);core.updateStatusBar()};events.prototype.afterPassNet=function(b,c,a){if(this.eventdata.afterPassNet){this.eventdata.afterPassNet(b,c,a)}};events.prototype._sys_pushBox=function(b,a){this.pushBox(b);if(a){a()}};events.prototype.pushBox=function(a){if(a.event.id!="box"&&a.event.id!="boxed"){return}var b=core.getHeroLoc("direction"),d=a.x+core.utils.scan[b].x,e=a.y+core.utils.scan[b].y;if(!core.canMoveHero()||!core.canMoveHero(a.x,a.y,b)){return}var c=core.getBlockId(d,e);if(c!=null&&c!="flower"){return}core.setBlock(c==null?169:170,d,e);if(a.event.id=="box"){core.removeBlock(a.x,a.y)}else{core.setBlock(168,a.x,a.y)}core.updateStatusBar();this._pushBox_moveHero(b)};events.prototype._pushBox_moveHero=function(a){core.status.replay.animate=true;core.lockControl();setTimeout(function(){core.moveHero(a,function(){core.status.replay.animate=false;core.status.route.pop();core.events.afterPushBox();if(core.status.event.id==null){core.unLockControl();core.replay()}})})};events.prototype.afterPushBox=function(){return this.eventdata.afterPushBox()};events.prototype._sys_changeLight=function(b,a){core.events.changeLight(b.event.id,b.x,b.y);if(a){a()}};events.prototype.changeLight=function(a,b,c){if(a!=null&&a!="light"){return}core.setBlock(core.getNumberById("darkLight"),b,c);return this.eventdata.afterChangeLight(b,c)};events.prototype._sys_ski=function(b,a){core.insertAction(["V2.6后，请将滑冰放在背景层！"],b.x,b.y,a)};events.prototype._sys_action=function(b,a){var d=core.clone(b.event.data),e=b.x,f=b.y;if(e==core.nextX()&&f==core.nextY()){var c=core.reverseDirection();var g=b.event.id,i=(b.event.faceIds||{})[c];if(i&&g!=i){var h=core.getNumberById(i);if(h>0){core.setBlock(h,e,f)}}}this.insertAction(d,e,f,a)};events.prototype._sys_custom=function(b,a){core.insertAction(["请使用\r[yellow]core.registerSystemEvent('custom', func)\r来处理自己添加的系统触发器！"],b.x,b.y,a)};events.prototype.registerEvent=function(b,a){this.actions[b]=a};events.prototype.unregisterEvent=function(a){delete this.actions[a]};events.prototype.doEvent=function(a,f,g,c){var d=a.type;if(this.actions[d]){try{return core.doFunc(this.actions[d],this,a,f,g,c)}catch(b){main.log(b);main.log("ERROR in actions["+d+"]")}}if(this["_action_"+d]){return this["_action_"+d](a,f,g,c)}core.insertAction("未知的自定义事件: "+d+"！");core.doAction()};events.prototype.setEvents=function(c,d,e,a){var b=core.status.event.data||{};if(c){b.list=[{todo:core.clone(c),total:core.clone(c),condition:"false"}];if(c.length==0){core.status.autoEvents.forEach(function(f){core.autoEventExecuting(f.symbol,false)})}}if(d!=null){b.x=d}if(e!=null){b.y=e}if(a){b.callback=a}if(!b.appendingEvents){b.appendingEvents=[]}if(!b.locStack){b.locStack=[]}core.status.event.id="action";core.status.event.data=b};events.prototype.startEvents=function(b,c,d,a){if(!b){return}if(!(b instanceof Array)){b=[b]}this.setEvents(b,c,d,a);core.waitHeroToStop(function(){core.lockControl();core.doAction()})};events.prototype.doAction=function(d){if(!d){core.clearUI();clearInterval(core.status.event.interval);core.status.event.interval=null}if(this._doAction_finishEvents()){return}var c=core.status.event.data.floorId||core.status.floorId;var f=core.status.event.data.x,g=core.status.event.data.y;var e=[c||":f",f!=null?f:"x",g!=null?g:"y"].join("@");var a=core.status.event.data.list[0];if(this._popEvents(a,e)){return}var b=a.todo.shift();core.status.event.data.current=b;if(typeof b=="string"){b={type:"text",text:b}}b.floorId=b.floorId||c;core.status.event.data.type=b.type;this.doEvent(b,f,g,e);return};events.prototype._doAction_finishEvents=function(){if(core.status.event.data.list.length==0){if(core.status.event.data.appendingEvents.length>0){this.setEvents(core.status.event.data.appendingEvents.shift());return false}var a=core.status.event.data.callback;core.ui.closePanel();if(a){a()}core.replay();return true}return false};events.prototype._popEvents=function(a,b){if(a.todo.length==0){if(core.calValue(a.condition,b)){a.todo=core.clone(a.total)}else{core.status.event.data.list.shift()}core.doAction();return true}return false};events.prototype.insertAction=function(a,e,f,c,b){if(core.hasFlag("__statistics__")){return}if(core.status.gameOver){return}var d=this.getCommonEvent(a);if(d instanceof Array){a=[{type:"dowhile",condition:"false",data:d}]}if(!a){return}a=this.precompile(a);if(core.status.event.id!="action"){this.startEvents(a,e,f,c)}else{if(b){core.push(core.status.event.data.list[0].todo,a)}else{core.unshift(core.status.event.data.list[0].todo,a)}this.setEvents(null,e,f,c)}};events.prototype.getCommonEvent=function(a){if(!a||typeof a!=="string"){return null}return this.commonEvent[a]||null};events.prototype.recoverEvents=function(a){if(a){core.ui.closePanel();core.lockControl();core.status.event.id="action";core.status.event.data=a;setTimeout(function(){core.doAction()},30);return true}return false};events.prototype.checkAutoEvents=function(){if(!core.isPlaying()||(core.status.lockControl&&core.status.event.id!="action")){return}var b=[],a=[];core.status.autoEvents.forEach(function(c){var i=c.symbol,j=c.x,k=c.y,g=c.floorId;if(c.currentFloor&&g!=core.status.floorId){return}if(!c.multiExecute&&core.autoEventExecuted(i)){return}if(core.autoEventExecuting(i)){return}var h=g+"@"+j+"@"+k;try{if(!core.calValue(c.condition,h)){return}}catch(d){return}core.autoEventExecuting(i,true);core.autoEventExecuted(i,true);var f=[{type:"function","function":"function() { core.pushEventLoc("+j+", "+k+", '"+g+"' ); }"},{type:"dowhile",condition:"false",data:c.data},{type:"function","function":"function() { core.popEventLoc(); core.autoEventExecuting('"+i+"', false); }"}];if(c.delayExecute){a.push(f)}else{core.push(b,f)}});if(b.length==0&&a.length==0){return}if(core.status.event.id=="action"||b.length>0){core.insertAction(b);core.push(core.status.event.data.appendingEvents,a)}else{core.insertAction(a[0]);if(a.length>0){core.insertAction(a.slice(1))}}};events.prototype.autoEventExecuting=function(b,c){var a="_executing_autoEvent_"+b;if(c==null){return core.hasFlag(a)}else{core.setFlag(a,c||null)}};events.prototype.autoEventExecuted=function(b,c){var a="_executed_autoEvent_"+b;if(c==null){return core.hasFlag(a)}else{core.setFlag(a,c||null)}};events.prototype.pushEventLoc=function(b,c,a){if(core.status.event.id!="action"){return}core.status.event.data.locStack.push({x:core.status.event.data.x,y:core.status.event.data.y,floorId:core.status.event.data.floorId});core.status.event.data.x=b;core.status.event.data.y=c;core.status.event.data.floorId=a};events.prototype.popEventLoc=function(){if(core.status.event.id!="action"){return}var a=core.status.event.data.locStack.shift();if(a){core.status.event.data.x=a.x;core.status.event.data.y=a.y;core.status.event.data.floorId=a.floorId}};events.prototype.precompile=function(b){var a=this.__precompile_getArray();if(typeof b=="string"){return this.__precompile_text(b)}if(b instanceof Array){for(var c=0;c<b.length;++c){b[c]=this.precompile(b[c])}return b}if(b&&b.type){if(this["_precompile_"+b.type]){b=this["_precompile_"+b.type](b)}if(a.texts.indexOf(b.type)>=0){b.text=this.__precompile_text(b.text)}if(a.locs.indexOf(b.type)>=0){b.loc=this.__precompile_array(b.loc)}if(a.values.indexOf(b.type)>=0){b.value=core.replaceValue(b.value)}if(a.uievents.indexOf(b.type)>=0){b.x=core.replaceValue(b.x);b.y=core.replaceValue(b.y);b.width=core.replaceValue(b.width);b.height=core.replaceValue(b.height)}if(b.type in a.others){a.others[b.type].forEach(function(d){b[d]=core.replaceValue(b[d])})}}return b};events.prototype.__precompile_getArray=function(){var c=["text","autoText","scrollText","tip","textImage","input","input2","choices","confirm","fillText","fillBoldText","drawTextContent"];var a=["show","hide","setBlock","showFloorImg","hideFloorImg","showBgFgMap","hideBgFgMap","setBgFgBlock","animate","setViewport","move","jumoHero","changeFloor","changePos","showTextImage","showGif","openDoor","closeDoor","battle","trigger","insert"];var e=["setValue","setValue2","addValue","setEnemy","setFloor","setGlobalValue",];var d=["clearMap","fillText","fillBoldText","fillRect","strokeRect","strokeCircle","drawIcon","drawSelector","drawBackground",];var b={strokeCircle:["r"],drawLine:["x1","y1","x2","y2"],drawArrow:["x1","y1","x2","y2"],drawImage:["x","y","w","h","x1","y1","w1","h1"],drawTextContent:["left","top"],};return{texts:c,locs:a,values:e,uievents:d,others:b}};events.prototype.__precompile_text=function(a){if(typeof a!="string"){return a}return a.replace(/\${(.*?)}/g,function(c,b){return"${"+core.replaceValue(b)+"}"})};events.prototype.__precompile_array=function(b){if(typeof b=="string"){b=core.replaceValue(b);return b}if(b instanceof Array){for(var a=0;a<b.length;++a){b[a]=this.__precompile_array(b[a])}}return b};events.prototype.__action_checkReplaying=function(){if(core.isReplaying()){core.doAction();return true}return false};events.prototype.__action_getLoc=function(a,c,d,b){if(a){c=core.calValue(a[0],b);d=core.calValue(a[1],b)}return[c,d]};events.prototype.__action_getHeroLoc=function(a,b){return this.__action_getLoc(a,core.getHeroLoc("x"),core.getHeroLoc("y"),b)};events.prototype.__action_getLoc2D=function(a,c,d,b){if(!(a&&a[0] instanceof Array)){a=[this.__action_getLoc(a,c,d,b)]}return a};events.prototype.__action_doAsyncFunc=function(b,a){var c=Array.prototype.slice.call(arguments,2);if(b){a.apply(this,c);core.doAction()}else{a.apply(this,c.concat(core.doAction))}};events.prototype._action_text=function(a,c,d,b){if(this.__action_checkReplaying()){return}core.ui.drawTextBox(a.text,a.showAll)};events.prototype._action_autoText=function(a,c,d,b){if(this.__action_checkReplaying()){return}core.ui.drawTextBox(a.text);setTimeout(core.doAction,a.time||3000)};events.prototype._action_scrollText=function(a,c,d,b){if(this.__action_checkReplaying()){return}this.__action_doAsyncFunc(a.async,core.drawScrollText,a.text,a.time||5000,a.lineHeight||1.4)};events.prototype._action_comment=function(a,c,d,b){core.doAction()};events.prototype._action_setText=function(a,c,d,b){["position","offset","align","bold","titlefont","textfont","time","interval"].forEach(function(e){if(a[e]!=null){core.status.textAttribute[e]=a[e]}});["background","title","text"].forEach(function(g){if((a[g] instanceof Array)&&a[g].length>=3){if(a[g].length==3){a[g].push(1)}core.status.textAttribute[g]=a[g]}if(g=="background"){var f=core.getMappedName(a[g]);var e=core.material.images.images[f];if(e&&e.width==192&&e.height==128){core.status.textAttribute[g]=f}}});core.setFlag("textAttribute",core.status.textAttribute);core.doAction()};events.prototype._action_tip=function(a,c,d,b){core.drawTip(core.replaceText(a.text),a.icon);core.doAction()};events.prototype._action_show=function(a,c,d,b){a.loc=this.__action_getLoc2D(a.loc,c,d,b);if(a.time>0&&a.floorId==core.status.floorId){this.__action_doAsyncFunc(a.async,core.animateBlock,a.loc,"show",a.time)}else{a.loc.forEach(function(e){core.showBlock(e[0],e[1],a.floorId)});core.doAction()}};events.prototype._action_hide=function(a,c,d,b){a.loc=this.__action_getLoc2D(a.loc,c,d,b);if(a.time>0&&a.floorId==core.status.floorId){a.loc.forEach(function(e){core.hideBlock(e[0],e[1],a.floorId)});this.__action_doAsyncFunc(a.async,core.animateBlock,a.loc,"hide",a.time)}else{a.loc.forEach(function(e){core.removeBlock(e[0],e[1],a.floorId)});core.doAction()}};events.prototype._action_setBlock=function(a,c,d,b){a.loc=this.__action_getLoc2D(a.loc,c,d,b);a.loc.forEach(function(e){core.setBlock(a.number,e[0],e[1],a.floorId)});core.doAction()};events.prototype._action_showFloorImg=function(a,c,d,b){core.maps.showFloorImage(this.__action_getLoc2D(a.loc,c,d,b),a.floorId,core.doAction)};events.prototype._action_hideFloorImg=function(a,c,d,b){core.maps.hideFloorImage(this.__action_getLoc2D(a.loc,c,d,b),a.floorId,core.doAction)};events.prototype._action_showBgFgMap=function(a,c,d,b){core.maps.showBgFgMap(a.name,this.__action_getLoc2D(a.loc,c,d,b),a.floorId,core.doAction)};events.prototype._action_hideBgFgMap=function(a,c,d,b){core.maps.hideBgFgMap(a.name,this.__action_getLoc2D(a.loc,c,d,b),a.floorId,core.doAction)};events.prototype._action_setBgFgBlock=function(a,c,d,b){a.loc=this.__action_getLoc2D(a.loc,c,d,b);a.loc.forEach(function(e){core.setBgFgBlock(a.name,a.number,e[0],e[1],a.floorId)});core.doAction()};events.prototype._action_follow=function(a,c,d,b){this.follow(a.name);core.doAction()};events.prototype._action_unfollow=function(a,c,d,b){this.unfollow(a.name);core.doAction()};events.prototype._action_animate=function(a,c,d,b){if(a.loc=="hero"){this.__action_doAsyncFunc(a.async,core.drawHeroAnimate,a.name)}else{a.loc=this.__action_getLoc(a.loc,c,d,b);this.__action_doAsyncFunc(a.async,core.drawAnimate,a.name,a.loc[0],a.loc[1])}};events.prototype._action_setViewport=function(a,d,e,c){if(a.loc==null){core.drawHero()}else{var b=this.__action_getLoc(a.loc,d,e,c);core.setViewport(32*b[0],32*b[1])}core.doAction()};events.prototype._action_moveViewport=function(a,c,d,b){this.__action_doAsyncFunc(a.async,core.moveViewport,a.steps,a.time)};events.prototype._action_move=function(a,d,e,c){var b=this.__action_getLoc(a.loc,d,e,c);this.__action_doAsyncFunc(a.async,core.moveBlock,b[0],b[1],a.steps,a.time,a.keep)};events.prototype._action_moveHero=function(a,c,d,b){this.__action_doAsyncFunc(a.async,core.eventMoveHero,a.steps,a.time)};events.prototype._action_jump=function(a,e,f,c){var b=this.__action_getLoc(a.from,e,f,c),d=this.__action_getLoc(a.to,e,f,c);this.__action_doAsyncFunc(a.async,core.jumpBlock,b[0],b[1],d[0],d[1],a.time,a.keep)};events.prototype._precompile_jump=function(a){a.from=this.__precompile_array(a.from);a.to=this.__precompile_array(a.to);return a};events.prototype._action_jumpHero=function(a,d,e,c){var b=this.__action_getHeroLoc(a.loc,c);this.__action_doAsyncFunc(a.async,core.jumpHero,b[0],b[1],a.time)};events.prototype._action_changeFloor=function(a,e,f,d){var c=this.__action_getHeroLoc(a.loc,d);var b={x:c[0],y:c[1],direction:a.direction};core.changeFloor(a.floorId,null,b,a.time,core.doAction)};events.prototype._action_changePos=function(a,d,e,c){core.clearMap("hero");var b=this.__action_getHeroLoc(a.loc,c);core.setHeroLoc("x",b[0]);core.setHeroLoc("y",b[1]);if(a.direction){core.setHeroLoc("direction",a.direction)}core.drawHero();core.doAction()};events.prototype._action_showImage=function(a,c,d,b){if(core.isReplaying()){a.time=0}this.__action_doAsyncFunc(a.async||a.time==0,core.showImage,a.code,a.image,a.sloc,a.loc,a.opacity,a.time)};events.prototype._precompile_showImage=function(a){a.sloc=this.__precompile_array(a.sloc);a.loc=this.__precompile_array(a.loc);return a};events.prototype._action_showTextImage=function(a,d,e,c){var b=this.__action_getLoc(a.loc,0,0,c);if(core.isReplaying()){a.time=0}this.__action_doAsyncFunc(a.async||a.time==0,core.showImage,a.code,core.ui.textImage(a.text),null,b,a.opacity,a.time)};events.prototype._action_hideImage=function(a,c,d,b){if(core.isReplaying()){a.time=0}this.__action_doAsyncFunc(a.async||a.time==0,core.hideImage,a.code,a.time)};events.prototype._action_showGif=function(a,d,e,c){var b=this.__action_getLoc(a.loc,0,0,c);this.showGif(a.name,b[0],b[1]);core.doAction()};events.prototype._action_moveImage=function(a,c,d,b){if(this.__action_checkReplaying()){return}this.__action_doAsyncFunc(a.async,core.moveImage,a.code,a.to,a.opacity,a.time)};events.prototype._precompile_moveImage=function(a){a.to=this.__precompile_array(a.to);return a};events.prototype._action_setFg=function(a,c,d,b){return this._action_setCurtain(a,c,d,b)};events.prototype._action_setCurtain=function(a,c,d,b){if(a.async){core.setCurtain(a.color,a.time);core.setFlag("__color__",a.color||null);core.doAction()}else{core.setCurtain(a.color,a.time,function(){core.setFlag("__color__",a.color||null);core.doAction()})}};events.prototype._action_screenFlash=function(a,c,d,b){this.__action_doAsyncFunc(a.async,core.screenFlash,a.color,a.time,a.times)};events.prototype._action_setWeather=function(a,c,d,b){core.setWeather(a.name,a.level);if(a.name=="rain"||a.name=="snow"||a.name=="fog"){core.setFlag("__weather__",[a.name,a.level])}else{core.removeFlag("__weather__")}core.doAction()};events.prototype._action_openDoor=function(a,e,f,d){var c=this.__action_getLoc(a.loc,e,f,d);var b=a.floorId;if(b==core.status.floorId){this.__action_doAsyncFunc(a.async,core.openDoor,c[0],c[1],a.needKey)}else{core.removeBlock(c[0],c[1],b);core.doAction()}};events.prototype._action_closeDoor=function(a,d,e,c){var b=this.__action_getLoc(a.loc,d,e,c);this.__action_doAsyncFunc(a.async,core.closeDoor,b[0],b[1],a.id)};events.prototype._action_useItem=function(a,c,d,b){if(a.id!="book"&&core.canUseItem(a.id)){core.useItem(a.id,true,core.doAction)}else{core.drawTip("当前无法使用"+((core.material.items[a.id]||{}).name||"未知道具"));core.doAction()}};events.prototype._action_loadEquip=function(a,c,d,b){core.loadEquip(a.id);core.doAction()};events.prototype._action_unloadEquip=function(a,c,d,b){core.unloadEquip(a.pos);core.doAction()};events.prototype._action_openShop=function(a,c,d,b){core.status.shops[a.id].visited=true;this.setEvents([]);if(!core.isReplaying()){this.openShop(a.id)}if(core.status.event.id=="action"){core.doAction()}};events.prototype._action_disableShop=function(a,c,d,b){this.disableQuickShop(a.id);core.doAction()};events.prototype._action_battle=function(a,d,e,c){if(a.id){this.battle(a.id,null,null,true,core.doAction)}else{if(a.floorId!=core.status.floorId){core.doAction();return}var b=this.__action_getLoc(a.loc,d,e,c);this.battle(null,b[0],b[1],true,core.doAction)}};events.prototype._action_trigger=function(b,e,f,d){var c=this.__action_getLoc(b.loc,e,f,d);var a=core.getBlock(c[0],c[1]);if(a!=null&&a.block.event.trigger){a=a.block;this.setEvents(b.keep?null:[],a.x,a.y);if(a.event.trigger=="action"){this.insertAction(a.event.data)}else{core.doSystemEvent(a.event.trigger,a,core.doAction);return}}core.doAction()};events.prototype._action_insert=function(a,k,l,h){if(a.args instanceof Array){for(var f=0;f<a.args.length;++f){try{if(a.args[f]!=null){core.setFlag("arg"+(f+1),a.args[f])}}catch(b){main.log(b)}}}if(a.name){core.setFlag("arg0",a.name);core.insertAction(a.name)}else{var g=this.__action_getLoc(a.loc,k,l,h);core.setFlag("arg0",g);var d=a.floorId;var j=a.which||"events";var c=(core.floors[d][j]||[])[g[0]+","+g[1]];if(c){this.insertAction(c.data||c)}}core.doAction()};events.prototype._action_playBgm=function(a,c,d,b){core.playBgm(a.name);core.setFlag("__bgm__",a.keep?a.name:null);core.doAction()};events.prototype._action_pauseBgm=function(a,c,d,b){core.pauseBgm();core.doAction()};events.prototype._action_resumeBgm=function(a,c,d,b){core.resumeBgm();core.doAction()};events.prototype._action_loadBgm=function(a,c,d,b){core.loadBgm(a.name);core.doAction()};events.prototype._action_freeBgm=function(a,c,d,b){core.freeBgm(a.name);core.doAction()};events.prototype._action_playSound=function(a,c,d,b){if(a.stop){core.stopSound()}core.playSound(a.name);core.doAction()};events.prototype._action_stopSound=function(a,c,d,b){core.stopSound();core.doAction()};events.prototype._action_setVolume=function(a,c,d,b){a.value=core.clamp(parseInt(a.value)/100,0,1);core.setFlag("__volume__",a.value);this.__action_doAsyncFunc(a.async,core.setVolume,a.value,a.time||0)};events.prototype._action_setValue=function(a,c,d,b){this.setValue(a.name,a.value,b);if(!a.norefresh){if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose()}else{core.updateStatusBar()}}core.doAction()};events.prototype._action_setValue2=function(a,c,d,b){this._action_addValue(a,c,d,b)};events.prototype._action_addValue=function(a,c,d,b){this.addValue(a.name,a.value,b);if(!a.norefresh){if(core.status.hero.hp<=0){core.status.hero.hp=0;core.updateStatusBar();core.events.lose()}else{core.updateStatusBar()}}core.doAction()};events.prototype._action_setEnemy=function(a,c,d,b){this.setEnemy(a.id,a.name,a.value,b);core.doAction()};events.prototype._action_setFloor=function(a,c,d,b){this.setFloorInfo(a.name,a.value,a.floorId,b);core.doAction()};events.prototype._action_setGlobalAttribute=function(a,c,d,b){this.setGlobalAttribute(a.name,a.value);core.doAction()};events.prototype._action_setGlobalValue=function(a,c,d,b){core.values[a.name]=a.value;core.doAction()};events.prototype._action_setGlobalFlag=function(a,c,d,b){this.setGlobalFlag(a.name,a.value);core.doAction()};events.prototype._action_setHeroIcon=function(a,c,d,b){this.setHeroIcon(a.name);core.doAction()};events.prototype._action_input=function(a,c,d,b){this.__action_getInput(a.text,false,function(e){e=Math.abs(parseInt(e)||0);core.status.route.push("input:"+e);core.setFlag("input",e);core.doAction()})};events.prototype._action_input2=function(a,c,d,b){this.__action_getInput(a.text,true,function(e){e=e||"";core.status.route.push("input2:"+core.encodeBase64(e));core.setFlag("input",e);core.doAction()})};events.prototype.__action_getInput=function(d,f,b){var h,g=f?"input2:":"input:";if(core.isReplaying()){var a=core.status.replay.toReplay.shift();try{if(a.indexOf(g)!=0){throw new Error("录像文件出错！当前需要一个 "+g+" 项，实际为 "+a)}if(f){h=core.decodeBase64(a.substring(7))}else{h=parseInt(a.substring(6))}b(h)}catch(c){core.control._replay_error(a);return}}else{core.myprompt(core.replaceText(d),null,b)}};events.prototype._action_if=function(a,c,d,b){if(core.calValue(a.condition,b)){core.events.insertAction(a["true"])}else{core.events.insertAction(a["false"])}core.doAction()};events.prototype._precompile_if=function(a){a.condition=core.replaceValue(a.condition);a["true"]=this.precompile(a["true"]);a["false"]=this.precompile(a["false"]);return a};events.prototype._action_switch=function(b,g,h,f){var d=core.calValue(b.condition,f);var e=[];for(var c=0;c<b.caseList.length;c++){var a=b.caseList[c]["case"];if(a=="default"||core.calValue(a,f)==d){core.push(e,b.caseList[c].action);if(!b.caseList[c].nobreak){break}}}core.insertAction(e);core.doAction()};events.prototype._precompile_switch=function(a){a.condition=core.replaceValue(a.condition);for(var b=0;b<a.caseList.length;b++){a.caseList[b]["case"]=core.replaceValue(a.caseList[b]["case"]);a.caseList[b].action=this.precompile(a.caseList[b].action)}return a};events.prototype._action_choices=function(b,e,f,d){b.choices=b.choices.filter(function(h){if(h.condition==null||h.condition==""){return true}try{return core.calValue(h.condition,d)}catch(g){return true}});if(b.choices.length==0){return this.doAction()}if(core.isReplaying()){var a=core.status.replay.toReplay.shift(),c;if(a=="turn"){a=core.status.replay.toReplay.shift()}if(a.indexOf("choices:")==0&&((c=parseInt(a.substring(8)))>=0)&&c<b.choices.length){core.status.event.selection=c;setTimeout(function(){core.status.route.push("choices:"+c);core.insertAction(b.choices[c].action);core.doAction()},core.status.replay.speed==24?1:750/Math.max(1,core.status.replay.speed))}else{core.control._replay_error(a);return}}core.ui.drawChoices(b.text,b.choices)};events.prototype._precompile_choices=function(a){if(!(a.choices instanceof Array)){return a}for(var b=0;b<a.choices.length;++b){a.choices[b].condition=core.replaceValue(a.choices[b].condition);a.choices[b].text=this.__precompile_text(a.choices[b].text);a.choices[b].action=this.precompile(a.choices[b].action)}return a};events.prototype._action_confirm=function(b,e,f,d){core.status.event.ui={text:b.text,yes:b.yes,no:b.no};if(core.isReplaying()){var a=core.status.replay.toReplay.shift(),c;if(a=="turn"){a=core.status.replay.toReplay.shift()}if(a.indexOf("choices:")==0&&((c=parseInt(a.substring(8)))>=0)&&c<2){core.status.event.selection=c;setTimeout(function(){core.status.route.push("choices:"+c);if(c==0){core.insertAction(b.yes)}else{core.insertAction(b.no)}core.doAction()},core.status.replay.speed==24?1:750/Math.max(1,core.status.replay.speed))}else{core.control._replay_error(a);return}}else{core.status.event.selection=b["default"]?0:1}core.ui.drawConfirmBox(b.text)};events.prototype._precompile_confirm=function(a){a.yes=this.precompile(a.yes);a.no=this.precompile(a.no);return a};events.prototype._action_while=function(a,c,d,b){if(core.calValue(a.condition,b)){core.unshift(core.status.event.data.list,{todo:core.clone(a.data),total:core.clone(a.data),condition:a.condition})}core.doAction()};events.prototype._precompile_while=function(a){a.condition=core.replaceValue(a.condition);a.data=this.precompile(a.data);return a};events.prototype._action_dowhile=function(a,c,d,b){core.unshift(core.status.event.data.list,{todo:core.clone(a.data),total:core.clone(a.data),condition:a.condition});core.doAction()};events.prototype._precompile_dowhile=function(a){a.condition=core.replaceValue(a.condition);a.data=this.precompile(a.data);return a};events.prototype._action_break=function(a,c,d,b){core.status.event.data.list.shift();core.doAction()};events.prototype._action_continue=function(a,c,d,b){if(core.calValue(core.status.event.data.list[0].condition,b)){core.status.event.data.list[0].todo=core.clone(core.status.event.data.list[0].total)}else{core.status.event.data.list.shift()}core.doAction()};events.prototype._action_win=function(a,c,d,b){this.win(core.replaceText(a.reason),a.norank,a.noexit)};events.prototype._action_lose=function(a,c,d,b){this.lose(core.replaceText(a.reason))};events.prototype._action_restart=function(a,c,d,b){core.restart()};events.prototype._action_function=function(data,x,y,prefix){var func=data["function"];try{if(typeof func=="string"&&func.indexOf("function")==0){eval("("+func+")()")}}catch(e){main.log(e)}if(!data.async){core.doAction()}};events.prototype._action_update=function(a,c,d,b){core.updateStatusBar();core.doAction()};events.prototype._action_showStatusBar=function(a,c,d,b){core.showStatusBar();core.doAction()};events.prototype._action_hideStatusBar=function(a,c,d,b){core.hideStatusBar(a.toolbox);core.doAction()};events.prototype._action_showHero=function(a,c,d,b){core.removeFlag("hideHero");core.drawHero();core.doAction()};events.prototype._action_hideHero=function(a,c,d,b){core.setFlag("hideHero",true);core.drawHero();core.doAction()};events.prototype._action_vibrate=function(a,c,d,b){this.__action_doAsyncFunc(a.async,core.vibrate,a.time)};events.prototype._action_sleep=function(a,c,d,b){core.timeout.sleepTimeout=setTimeout(function(){core.timeout.sleepTimeout=null;core.doAction()},core.isReplaying()?Math.min(a.time,20):a.time)};events.prototype._action_wait=function(b,e,f,c){if(core.isReplaying()){var a=core.status.replay.toReplay.shift();if(a.indexOf("input:")==0){var d=parseInt(a.substring(6));core.status.route.push("input:"+d);this.__action_wait_getValue(d);this.__action_wait_afterGet(b)}else{main.log("录像文件出错！当前需要一个 input: 项，实际为 "+a);core.stopReplay();core.insertAction(["录像文件出错，请在控制台查看报错信息。",{type:"exit"}])}core.doAction();return}};events.prototype.__action_wait_getValue=function(c){if(c>=1000000){core.setFlag("type",1);var a=parseInt((c-1000000)/1000),b=c%1000;core.setFlag("px",a);core.setFlag("py",b);core.setFlag("x",parseInt(a/32));core.setFlag("y",parseInt(b/32))}else{if(c>=10000){core.setFlag("type",1);var d=parseInt((c-10000)/100),e=c%100;core.setFlag("px",32*d+16);core.setFlag("py",32*e+16);core.setFlag("x",d);core.setFlag("y",e)}else{if(c>0){core.setFlag("type",0);core.setFlag("keycode",c)}}}};events.prototype.__action_wait_afterGet=function(a){if(!a.data){return}var b=[];a.data.forEach(function(c){if(c["case"]=="keyboard"&&core.getFlag("type")==0){if(c.keycode==core.getFlag("keycode",0)){core.push(b,c.action)}}if(c["case"]=="mouse"&&c.px instanceof Array&&c.py instanceof Array&&core.getFlag("type")==1){var f=core.calValue(c.px[0]);var e=core.calValue(c.px[1]);var i=core.calValue(c.py[0]);var h=core.calValue(c.py[1]);var d=core.getFlag("px",0),g=core.getFlag("py",0);if(d>=f&&d<=e&&g>=i&&g<=h){core.push(b,c.action)}}});if(b.length>0){core.insertAction(b)}};events.prototype._precompile_wait=function(a){if(a.data){a.data.forEach(function(b){if(b.px){b.px=this.__precompile_array(b.px)}if(b.py){b.py=this.__precompile_array(b.py)}b.action=this.precompile(b.action)},this)}return a};events.prototype._action_waitAsync=function(a,d,e,b){var c=window.setInterval(function(){if(!core.hasAsync()){clearInterval(c);core.doAction()}},50)};events.prototype._action_revisit=function(b,d,e,c){var a=core.getBlock(d,e);if(a!=null&&a.block.event.trigger=="action"){this.setEvents(a.block.event.data)}core.doAction()};events.prototype._action_callBook=function(a,d,f,c){if(core.isReplaying()||!core.hasItem("book")){core.doAction()}else{var b=core.clone(core.status.event.data);core.ui.closePanel();core.openBook();core.status.event.interval=b}};events.prototype._action_callSave=function(a,d,f,c){if(core.isReplaying()||core.hasFlag("__events__")){core.removeFlag("__events__");core.doAction()}else{var b=core.clone(core.status.event.data);core.ui.closePanel();core.save();core.status.event.interval=b}};events.prototype._action_autoSave=function(a,c,d,b){core.autosave();if(!a.nohint){core.drawTip("已自动存档")}core.doAction()};events.prototype._action_callLoad=function(a,d,f,c){if(this.__action_checkReplaying()){return}var b=core.clone(core.status.event.data);core.ui.closePanel();core.load();core.status.event.interval=b};events.prototype._action_exit=function(a,c,d,b){this.setEvents([]);core.doAction()};events.prototype._action_previewUI=function(a,c,d,b){this.insertAction(a.action);core.doAction()};events.prototype._precompile_previewUI=function(a){a.action=this.precompile(a.action);return a};events.prototype.__action_doUIEvent=function(b){this.__action_doUIEvent_doOne(b);var a=core.status.event.data.list[0];while(a.todo.length>0){b=a.todo[0];if(this.__action_doUIEvent_doOne(a.todo[0])){a.todo.shift()}else{break}}core.doAction()};events.prototype.__action_doUIEvent_doOne=function(a){if(core.ui["_uievent_"+a.type]){core.ui["_uievent_"+a.type](a);return true}return false};events.prototype._action_clearMap=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_fillText=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_fillBoldText=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_fillRect=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_fillPolygon=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._precompile_fillPolygon=function(a){a.nodes=this.__precompile_array(a.nodes);return a};events.prototype._action_strokeRect=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_strokePolygon=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._precompile_strokePolygon=function(a){a.nodes=this.__precompile_array(a.nodes);return a};events.prototype._action_fillCircle=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_strokeCircle=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawLine=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawArrow=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_setAttribute=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawImage=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawIcon=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawSelector=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawBackground=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._action_drawTextContent=function(a,c,d,b){this.__action_doUIEvent(a)};events.prototype._checkStatus=function(c,b,a){if(b&&core.status.event.id==c){core.ui.closePanel();return false}if(b&&core.status.lockControl){return false}if(a&&!core.hasItem(c)){core.drawTip("你没有"+core.material.items[c].name);return false}if(core.isMoving()){core.drawTip("请先停止勇士行动");return false}core.lockControl();core.status.event.id=c;return true};events.prototype.openBook=function(a){if(core.isReplaying()){return}if(core.status.event.id=="book"&&core.events.recoverEvents(core.status.event.interval)){return}if(core.status.event.id=="book"&&core.status.event.ui){core.status.boxAnimateObjs=[];core.ui.drawMaps(core.status.event.ui);return}if(core.status.event.id=="viewMaps"){a=false;core.status.event.ui=core.status.event.data}if(!this._checkStatus("book",a,true)){return}core.useItem("book",true)};events.prototype.useFly=function(a){if(core.isReplaying()){return}if(!this._checkStatus("fly",a,true)){return}if(core.flags.flyNearStair&&!core.nearStair()){core.drawTip("只有在楼梯边才能使用飞行法杖");core.unLockControl();core.status.event.data=null;core.status.event.id=null;return}if(!core.canUseItem("fly")){core.drawTip("飞行法杖好像失效了");core.unLockControl();core.status.event.data=null;core.status.event.id=null;return}core.useItem("fly",true);return};events.prototype.flyTo=function(b,a){return this.eventdata.flyTo(b,a)};events.prototype.openEquipbox=function(a){if(core.isReplaying()){return}if(!this._checkStatus("equipbox",a)){return}core.ui.drawEquipbox()};events.prototype.openToolbox=function(a){if(core.isReplaying()){return}if(!this._checkStatus("toolbox",a)){return}core.ui.drawToolbox()};events.prototype.openQuickShop=function(a){if(core.isReplaying()){return}if(Object.keys(core.status.shops).length==0){core.drawTip("本塔没有快捷商店！");return}if(Object.keys(core.status.shops).length==1){var c=Object.keys(core.status.shops)[0];if(core.status.event.id!=null||!this._checkStatus("shop",false)){return}var b=core.events.canUseQuickShop(c);if(!core.flags.enableDisabledShop&&b){core.drawText(b);return}core.events.openShop(c,true);return}if(!this._checkStatus("selectShop",a)){return}core.ui.drawQuickShop()};events.prototype.openKeyBoard=function(a){if(core.isReplaying()){return}if(!this._checkStatus("keyBoard",a)){return}core.ui.drawKeyBoard()};events.prototype.save=function(a){if(core.isReplaying()){return}if(core.status.event.id=="save"&&core.events.recoverEvents(core.status.event.interval)){return}if(!this._checkStatus("save",a)){return}var d=core.saves.saveIndex;var c=parseInt((d-1)/5),b=d-5*c;core.ui.drawSLPanel(10*c+b)};events.prototype.load=function(a){if(core.isReplaying()){return}var d=core.saves.saveIndex;var c=parseInt((d-1)/5),b=d-5*c;if(!core.isPlaying()){core.dom.startPanel.style.display="none";core.clearStatus();core.clearMap("all");core.status.event={id:"load",data:null};core.status.lockControl=true;core.ui.drawSLPanel(10*c+b);return}if(core.status.event.id=="load"&&core.events.recoverEvents(core.status.event.interval)){return}if(!this._checkStatus("load",a)){return}core.ui.drawSLPanel(10*c+b)};events.prototype.openSettings=function(a){if(core.isReplaying()){return}if(!this._checkStatus("settings",a)){return}core.ui.drawSettings()};events.prototype.hasAsync=function(){return Object.keys(core.animateFrame.asyncId).length>0||(core.status.animateObjs||[]).length>0};events.prototype.follow=function(a){core.status.hero.followers=core.status.hero.followers||[];a=core.getMappedName(a);if(core.material.images.images[a]){core.status.hero.followers.push({name:a});core.gatherFollowers();core.clearMap("hero");core.drawHero()}};events.prototype.unfollow=function(b){core.status.hero.followers=core.status.hero.followers||[];if(!b){core.status.hero.followers=[]}else{b=core.getMappedName(b);for(var a=0;a<core.status.hero.followers.length;a++){if(core.status.hero.followers[a].name==b){core.status.hero.followers.splice(a,1);break}}}core.gatherFollowers();core.clearMap("hero");core.drawHero()};events.prototype.setValue=function(b,d,c,a){var d=core.calValue(d,c);if(a){d+=core.calValue(b,c)}this._setValue_setStatus(b,d);this._setValue_setItem(b,d);this._setValue_setFlag(b,d);this._setValue_setSwitch(b,d,c);this._setValue_setGlobal(b,d)};events.prototype._setValue_setStatus=function(a,b){if(a.indexOf("status:")!==0){return}core.setStatus(a.substring(7),b)};events.prototype._setValue_setItem=function(c,d){if(c.indexOf("item:")!==0){return}var b=c.substring(5),a=core.itemCount(b);if(d>a){core.getItem(b,d-a)}else{core.setItem(b,d)}};events.prototype._setValue_setFlag=function(a,b){if(a.indexOf("flag:")!==0){return}core.setFlag(a.substring(5),b)};events.prototype._setValue_setSwitch=function(a,c,b){if(a.indexOf("switch:")!==0){return}core.setFlag((b||":f@x@y")+"@"+a.substring(7),c)};events.prototype._setValue_setGlobal=function(a,b){if(a.indexOf("global:")!==0){return}core.setGlobal(a.substring(7),b)};events.prototype.addValue=function(a,c,b){this.setValue(a,c,b,true)};events.prototype.doEffect=function(a,b,c){a.split(";").forEach(function(e){var d=e.split("+=");if(d.length!=2){return}var f=d[0],g=core.calValue(d[1],null,b,c);core.addValue(f,g)})};events.prototype.setEnemy=function(b,c,e,d){if(!core.hasFlag("enemyInfo")){core.setFlag("enemyInfo",{})}var a=core.getFlag("enemyInfo");if(!a[b]){a[b]={}}e=core.calValue(e,d);a[b][c]=e;(core.material.enemys[b]||{})[c]=core.clone(e);core.updateStatusBar()};events.prototype.setFloorInfo=function(b,d,a,c){a=a||core.status.floorId;core.status.maps[a][b]=core.calValue(d,c);core.updateStatusBar()};events.prototype.setGlobalAttribute=function(name,value){if(typeof value=="string"){if((value.charAt(0)=='"'&&value.charAt(value.length-1)=='"')||(value.charAt(0)=="'"&&value.charAt(value.length-1)=="'")){value=value.substring(1,value.length-1)}if(value.charAt(0)=="["&&value.charAt(value.length-1)=="]"){value=eval(value)}}core.status.globalAttribute[name]=value;core.updateGlobalAttribute(name);core.setFlag("globalAttribute",core.status.globalAttribute)};events.prototype.setGlobalFlag=function(b,c){var a=core.getFlag("globalFlags",{});a[b]=c;core.flags[b]=c;core.setFlag("globalFlags",a);core.resize();if(b=="blurFg"){core.drawMap()}};events.prototype.closeDoor=function(g,h,d,b){d=d||"";if(!(d.endsWith("Door")||d.endsWith("Wall"))||core.material.icons.animates[d]==null||(core.getBlock(g,h)!=null&&core.getBlock(g,h).block.id!=0)){if(b){b()}return}core.playSound("door.mp3");var c=core.material.icons.animates[d];var e=d.endsWith("Door")?30:70,f=0;var a=window.setInterval(function(){f++;if(f==4){clearInterval(a);delete core.animateFrame.asyncId[a];core.setBlock(core.getNumberById(d),g,h);if(b){b()}return}core.clearMap("event",32*g,32*h,32,32);core.drawImage("event",core.material.images.animates,32*(4-f),32*c,32,32,32*g,32*h,32,32)},core.status.replay.speed==24?1:e/Math.max(core.status.replay.speed,1));core.animateFrame.asyncId[a]=true};events.prototype.showImage=function(b,e,k,f,i,o,a){if(typeof e=="string"){e=core.getMappedName(e);e=core.material.images.images[e]}if(!e){if(a){a()}return}k=k||[];var m=core.calValue(k[0])||0,n=core.calValue(k[1])||0;var l=core.calValue(k[2]),j=core.calValue(k[3]);if(l==null){l=e.width}if(j==null){j=e.height}f=f||[];var q=core.calValue(f[0])||0,r=core.calValue(f[1])||0;var p=core.calValue(f[2]),d=core.calValue(f[3]);if(p==null){p=l}if(d==null){d=j}var s=b+100;o=o||0;var g="image"+s;var c=core.createCanvas(g,q,r,p,d,s);c.drawImage(e,m,n,l,j,0,0,p,d);if(o==0){core.setOpacity(g,i);if(a){a()}return}core.setOpacity(g,0);this.moveImage(b,null,i,o,a)};events.prototype.hideImage=function(b,d,a){d=d||0;var c="image"+(b+100);if(d==0||!core.dymCanvas[c]){core.deleteCanvas(c);if(a){a()}return}this.moveImage(b,null,0,d,function(){core.deleteCanvas(c);if(a){a()}})};events.prototype.moveImage=function(c,k,i,j,a){j=j||1000;k=k||[];var g="image"+(c+100);if(!core.dymCanvas[g]){if(a){a()}return}var f=function(o,p){o=core.calValue(o);return o!=null?o:p};var b=core.dymCanvas[g].canvas;var d=parseFloat(b.getAttribute("_left")),e=parseFloat(b.getAttribute("_top")),m=f(k[0],d),n=f(k[1],e);var h=parseFloat(b.style.opacity),l=f(i,h);this._moveImage_moving(g,{fromX:d,fromY:e,toX:m,toY:n,opacity:h,toOpacity:l,time:j/Math.max(core.status.replay.speed,1)},a)};events.prototype._moveImage_moving=function(i,h,b){var k=10,l=0,m=parseInt(h.time/10);if(m<=0){m=1}var f=h.fromX,g=h.fromY,o=h.toX,p=h.toY,j=h.opacity,n=h.toOpacity;var d=f,e=g,c=j;var a=setInterval(function(){l++;c=j+(n-j)*l/m;d=parseInt(f+(o-f)*l/m);e=parseInt(g+(p-g)*l/m);core.setOpacity(i,c);core.relocateCanvas(i,d,e);if(l==m){core.setOpacity(i,n);delete core.animateFrame.asyncId[a];clearInterval(a);if(b){b()}}},k);core.animateFrame.asyncId[a]=true};events.prototype.showGif=function(c,d,e){c=core.getMappedName(c);var b=core.material.images.images[c];if(b){var a=new Image();a.src=b.src;a.style.position="absolute";a.style.left=d*core.domStyle.scale+"px";a.style.top=e*core.domStyle.scale+"px";a.style.width=b.width*core.domStyle.scale+"px";a.style.height=b.height*core.domStyle.scale+"px";core.dom.gif2.appendChild(a)}else{core.dom.gif2.innerHTML=""}};events.prototype.setVolume=function(i,h,a){var e=function(j){core.musicStatus.designVolume=j;if(core.musicStatus.playingBgm){core.material.bgms[core.musicStatus.playingBgm].volume=core.musicStatus.userVolume*core.musicStatus.designVolume}};if(!h||h<100){e(i);if(a){a()}return}var b=core.musicStatus.designVolume;h/=Math.max(core.status.replay.speed,1);var d=10,f=0,g=parseInt(h/d);if(g<=0){g=1}var c=setInterval(function(){f++;e(b+(i-b)*f/g);if(f>=g){delete core.animateFrame.asyncId[c];clearInterval(c);if(a){a()}}},d);core.animateFrame.asyncId[c]=true};events.prototype.vibrate=function(d,b){if(core.isReplaying()){if(b){b()}return}if(!d||d<1000){d=1000}d/=Math.max(core.status.replay.speed,1);d=Math.ceil(d/500)*500;var c={duration:d*3/50,speed:5,power:5,direction:1,shake:0};var a=setInterval(function(){core.events._vibrate_update(c);core.control.addGameCanvasTranslate(c.shake,0);if(c.duration===0){delete core.animateFrame.asyncId[a];clearInterval(a);if(b){b()}}},50/3);core.animateFrame.asyncId[a]=true};events.prototype._vibrate_update=function(b){if(b.duration>=1||b.shake!=0){var a=(b.power*b.speed*b.direction)/10;if(b.duration<=1&&b.shake*(b.shake+a)<0){b.shake=0}else{b.shake+=a}if(b.shake>b.power*2){b.direction=-1}if(b.shake<-b.power*2){b.direction=1}if(b.duration>=1){b.duration-=1}}};events.prototype.eventMoveHero=function(e,f,b){f=f||core.values.moveSpeed||100;var d=0,c=(e||[]).filter(function(g){return["up","down","left","right","forward","backward"].indexOf(g)>=0});var a=window.setInterval(function(){if(c.length==0){delete core.animateFrame.asyncId[a];clearInterval(a);core.drawHero();if(b){b()}}else{if(core.events._eventMoveHero_moving(++d,c)){d=0}}},core.status.replay.speed==24?1:f/8/core.status.replay.speed);core.animateFrame.asyncId[a]=true};events.prototype._eventMoveHero_moving=function(d,b){var a=b[0],e=core.getHeroLoc("x"),f=core.getHeroLoc("y");var c=a=="backward"?-1:1;if(a=="forward"||a=="backward"){a=core.getHeroLoc("direction")}core.setHeroLoc("direction",a);if(d<=4){core.drawHero("leftFoot",4*c*d)}else{if(d<=8){core.drawHero("rightFoot",4*c*d)}}if(d==8){core.setHeroLoc("x",e+c*core.utils.scan[a].x,true);core.setHeroLoc("y",f+c*core.utils.scan[a].y,true);core.updateFollowers();b.shift();return true}return false};events.prototype.jumpHero=function(b,c,g,a){var e=core.getHeroLoc("x"),f=core.getHeroLoc("y");if(b==null){b=e}if(c==null){c=f}var e=core.status.hero.loc.x,f=core.status.hero.loc.y;if(!core.isset(b)){b=e}if(!core.isset(c)){c=f}core.playSound("jump.mp3");var d=core.maps.__generateJumpInfo(e,f,b,c,g||500);d.icon=core.material.icons.hero[core.getHeroLoc("direction")];d.width=core.material.icons.hero.width||32;d.height=core.material.icons.hero.height;this._jumpHero_doJump(d,a)};events.prototype._jumpHero_doJump=function(c,b){var a=window.setInterval(function(){if(c.jump_count>0){core.events._jumpHero_jumping(c)}else{core.events._jumpHero_finished(a,c.ex,c.ey,b)}},c.per_time);core.animateFrame.asyncId[a]=true};events.prototype._jumpHero_jumping=function(b){core.clearMap("hero");core.maps.__updateJumpInfo(b);var c=b.px,d=b.py,e=b.width||32,a=b.height;core.bigmap.offsetX=core.clamp(c-32*core.__HALF_SIZE__,0,32*core.bigmap.width-core.__PIXELS__);core.bigmap.offsetY=core.clamp(d-32*core.__HALF_SIZE__,0,32*core.bigmap.height-core.__PIXELS__);core.control.updateViewport();core.drawImage("hero",core.material.images.hero,b.icon.stop,b.icon.loc*a,e,a,c+(32-e)/2-core.bigmap.offsetX,d+32-a-core.bigmap.offsetY,e,a);core.status.heroCenter.px=c+16;core.status.heroCenter.py=d+32-a/2};events.prototype._jumpHero_finished=function(a,c,d,b){delete core.animateFrame.asyncId[a];clearInterval(a);core.setHeroLoc("x",c);core.setHeroLoc("y",d);core.drawHero();if(b){b()}};events.prototype.openShop=function(c,a){var b=core.status.shops[c];b.times=b.times||0;if(b.commonTimes){b.times=core.getFlag("commonTimes",0)}if(a&&!b.visited){if(!core.flags.enableDisabledShop||b.commonEvent||b.item){if(b.times==0){core.drawTip("该项尚未开启")}else{core.drawTip("该项已失效")}core.ui.closePanel();return}else{core.drawTip("该商店尚未开启，只能浏览不可使用")}}else{b.visited=true}if(b.item){core.status.route.push("shop:"+c+":0");if(core.openItemShop){core.openItemShop(c)}else{core.insertAction("道具商店插件不存在！请检查是否存在该插件！")}return}else{if(b.commonEvent){core.status.route.push("shop:"+c+":0");core.insertAction({type:"insert",name:b.commonEvent,args:b.args});return}}core.ui.drawShop(c)};events.prototype._useShop=function(e,b){var d=core.events.canUseQuickShop(e.id);if(!d&&!e.visited){d=e.times?"该商店已失效":"该商店尚未开启"}if(d){core.drawTip(d);return false}var g=e.use,a=e.choices[b];var f=e.times,c=core.calValue(a.need||e.need,null,null,f);if(c>core.getStatus(g)){core.drawTip("你的"+(g=="money"?"金币":"经验")+"不足");return false}core.status.event.selection=b;core.status.event.data.actions.push(b);core.setStatus(g,core.getStatus(g)-c);core.doEffect(a.effect,c,f);core.updateStatusBar();e.times++;if(e.commonTimes){core.setFlag("commonTimes",e.times)}this.openShop(e.id);return true};events.prototype._exitShop=function(){if(core.status.event.data.actions.length>0){core.status.route.push("shop:"+core.status.event.data.id+":"+core.status.event.data.actions.join(""))}core.status.event.data.actions=[];core.status.boxAnimateObjs=[];if(core.status.event.data.fromList){core.ui.drawQuickShop()}else{core.ui.closePanel()}};events.prototype.disableQuickShop=function(a){core.status.shops[a].visited=false};events.prototype.canUseQuickShop=function(a){return this.eventdata.canUseQuickShop(a)};events.prototype.setHeroIcon=function(b,c){b=core.getMappedName(b);var a=core.material.images.images[b];if(!a){return}core.setFlag("heroIcon",b);core.material.images.hero=a;core.material.icons.hero.width=a.width/4;core.material.icons.hero.height=a.height/4;if(!c){core.drawHero()}};events.prototype.checkLvUp=function(){var a=[];while(true){var b=this._checkLvUp_check();if(b==null){break}a=a.concat(b)}if(a.length>0){core.insertAction(a)}};events.prototype._checkLvUp_check=function(){if(!core.flags.enableLevelUp||!core.firstData.levelUp||core.status.hero.lv>=core.firstData.levelUp.length){return null}var b=(core.firstData.levelUp[core.status.hero.lv]||{});var a=core.calValue(b.need);if(a==null){return null}if(core.status.hero.experience>=a){core.status.hero.lv++;if(b.clear){core.status.hero.experience-=a}return b.action||[]}return null};events.prototype.tryUseItem=function(a){core.ui.closePanel();if(a=="book"){return core.openBook(false)}if(a=="fly"){return core.useFly(false)}if(a=="centerFly"){return core.ui.drawCenterFly()}if(core.canUseItem(a)){core.useItem(a)}else{core.drawTip("当前无法使用"+core.material.items[a].name)}};events.prototype.afterUseBomb=function(){return this.eventdata.afterUseBomb()};events.prototype._uploadCurrent=function(b){var a=new FormData();a.append("type","score");a.append("name",core.firstData.name);a.append("version",core.firstData.version);a.append("platform",core.platform.string);a.append("hard",core.encodeBase64(core.status.hard));a.append("username",core.encodeBase64(b||"current"));a.append("lv",core.status.hero.lv);a.append("hp",Math.min(core.status.hero.hp,Math.pow(2,63)));a.append("atk",core.status.hero.atk);a.append("def",core.status.hero.def);a.append("mdef",core.status.hero.mdef);a.append("money",core.status.hero.money);a.append("experience",core.status.hero.experience);a.append("steps",core.status.hero.steps);a.append("seed",core.getFlag("__seed__"));a.append("totalTime",Math.floor(core.status.hero.statistics.totalTime/1000));a.append("route",core.encodeRoute(core.status.route));a.append("deler","current");a.append("base64",1);core.http("POST","/games/upload.php",a)};