"use strict";function enemys(){this._init()}enemys.prototype._init=function(){this.enemys=enemys_fcae963b_31c9_42b4_b48c_bb48d09f3f80;this.enemydata=functions_d6ad677b_427a_4623_b50f_a445a3b0ef8a.enemys;if(main.mode=="play"){this.enemydata.hasSpecial=function(c,d){return core.enemys.hasSpecial(c,d)};for(var a in this.enemys){this.enemys[a].id=a}}};enemys.prototype.getEnemys=function(){var b=core.clone(this.enemys);var a=core.getFlag("enemyInfo");if(a){for(var c in a){for(var d in a[c]){b[c][d]=core.clone(a[c][d])}}}return b};enemys.prototype.hasSpecial=function(a,b){if(a==null){return false}if(a instanceof Array){return a.indexOf(b)>=0}if(typeof a=="number"){return a===b}if(typeof a=="string"){return this.hasSpecial(core.material.enemys[a],b)}if(a.special!=null){return this.hasSpecial(a.special,b)}return false};enemys.prototype.getSpecials=function(){return this.enemydata.getSpecials()};enemys.prototype.getSpecialText=function(a){if(typeof a=="string"){a=core.material.enemys[a]}if(!a){return[]}var c=a.special;var e=[];var d=this.getSpecials();if(d){for(var b=0;b<d.length;b++){if(this.hasSpecial(c,d[b][0])){e.push(this._calSpecialContent(a,d[b][1]))}}}return e};enemys.prototype.getSpecialHint=function(a,d){var e=this.getSpecials();if(d==null){if(e==null){return[]}var b=[];for(var c=0;c<e.length;c++){if(this.hasSpecial(a,e[c][0])){b.push(this._calSpecialContent(a,e[c][1])+"："+this._calSpecialContent(a,e[c][2]))}}return b}if(e==null){return""}for(var c=0;c<e.length;c++){if(d==e[c][0]){return this._calSpecialContent(a,e[c][1])+"："+this._calSpecialContent(a,e[c][2])}}return""};enemys.prototype._calSpecialContent=function(b,a){if(typeof a=="string"){return a}if(typeof b=="string"){b=core.material.enemys[b]}if(a instanceof Function){return a(b)}return""};enemys.prototype.canBattle=function(b,d,e,c){if(typeof b=="string"){b=core.material.enemys[b]}var a=this.getDamage(b,d,e,c);return a!=null&&a<core.status.hero.hp};enemys.prototype.getDamage=function(b,d,e,c){if(typeof b=="string"){b=core.material.enemys[b]}var a=this._calDamage(b,null,d,e,c);if(a==null){return null}return a+this.getExtraDamage(b,d,e,c)};enemys.prototype.getExtraDamage=function(a,d,e,c){if(typeof a=="string"){a=core.material.enemys[a]}var b=0;if(this.hasSpecial(a.special,17)){b+=core.getFlag("hatred",0)}if(this.hasSpecial(a.special,22)){b+=a.damage||0}return b};enemys.prototype.getDamageString=function(c,e,f,d){if(typeof c=="string"){c=core.material.enemys[c]}var b=this.getDamage(c,e,f,d);var a="#000000";if(b==null){b="???";a="#FF0000"}else{if(b<=0){a="#00FF00"}else{if(b<core.status.hero.hp/3){a="#FFFFFF"}else{if(b<core.status.hero.hp*2/3){a="#FFFF00"}else{if(b<core.status.hero.hp){a="#FF7F00"}else{a="#FF0000"}}}}b=core.formatBigNumber(b,true);if(core.enemys.hasSpecial(c,19)){b+="+"}if(core.enemys.hasSpecial(c,21)){b+="-"}if(core.enemys.hasSpecial(c,11)){b+="^"}}return{damage:b,color:a}};enemys.prototype.nextCriticals=function(a,e,f,g,b){if(typeof a=="string"){a=core.material.enemys[a]}e=e||1;if(this.hasSpecial(a.special,10)){return[]}var c=this.getDamageInfo(a,null,f,g,b);if(c==null||this.hasSpecial(a.special,3)){c=this.getEnemyInfo(a,null,f,g,b);if(core.status.hero.atk<=c.def){return[[c.def+1-core.status.hero.atk,"?"]]}return[]}if(typeof c=="number"||(c.damage<=0&&!core.flags.enableNegativeDamage)){return[[0,0]]}if(core.flags.useLoop){var d=1;if(core.status.hero.atk<=d){return this._nextCriticals_useLoop(a,c,e,f,g,b)}else{return this._nextCriticals_useBinarySearch(a,c,e,f,g,b)}}else{return this._nextCriticals_useTurn(a,c,e,f,g,b)}};enemys.prototype._nextCriticals_useLoop=function(b,e,j,l,m,c){var h=e.mon_hp,d=core.status.hero.atk,g=e.mon_def,k=e.damage;var f=[];for(var a=d+1;a<=h+g;a++){var i=this.getDamageInfo(b,{atk:a},l,m,c);if(i==null||(typeof i=="number")){break}if(k>i.damage){k=i.damage;f.push([a-d,e.damage-i.damage]);if(i.damage<=0&&!core.flags.enableNegativeDamage){break}if(f.length>=j){break}}}if(f.length==0){f.push([0,0])}return f};enemys.prototype._nextCriticals_useBinarySearch=function(c,f,k,m,n,d){var i=f.mon_hp,e=core.status.hero.atk,h=f.mon_def,l=f.damage;var g=[];var a=function(o,q){var t=Math.floor(o),p=Math.floor(q);if(t>p){return null}while(t<p){var r=Math.floor((t+p)/2);var s=core.enemys.getDamageInfo(c,{atk:r},m,n,d);if(s==null||(typeof s=="number")){return null}if(l>s.damage){p=r}else{t=r+1}}var s=core.enemys.getDamageInfo(c,{atk:t},m,n,d);return s==null||(typeof s=="number")||s.damage>=l?null:[t,s.damage]};var b=e;while(true){var j=a(b+1,i+h,l);if(j==null){break}b=j[0];l=j[1];g.push([b-e,f.damage-l]);if(l<=0&&!core.flags.enableNegativeDamage){break}if(g.length>=k){break}}if(g.length==0){g.push([0,0])}return g};enemys.prototype._nextCriticals_useTurn=function(a,d,j,n,o,b){var g=d.mon_hp,c=core.status.hero.atk,f=d.mon_def,m=d.turn;if(m>=1000000){return this._nextCriticals_useBinarySearch(a,d,j,n,o,b)}var e=[],k=null;for(var l=m-1;l>=1;l--){var h=Math.ceil(g/l)+f;h=Math.ceil(h/core.getBuff("atk"));if(h<=c){break}if(h!=k){var i=this.getDamageInfo(a,{atk:h},n,o,b);if(i==null||(typeof i=="number")){break}e.push([h-c,Math.floor(d.damage-i.damage)]);if(i.damage<=0&&!core.flags.enableNegativeDamage){break}k=h}if(e.length>=j){break}}if(e.length==0){e.push([0,0])}return e};enemys.prototype.getDefDamage=function(a,c,f,g,b){if(typeof a=="string"){a=core.material.enemys[a]}c=c||1;var e=this._calDamage(a,null,f,g,b);var d=this._calDamage(a,{def:core.status.hero.def+c},f,g,b);if(e==null||d==null){return"???"}return e-d};enemys.prototype.getEnemyInfo=function(a,c,d,e,b){if(typeof a=="string"){a=core.material.enemys[a]}return this.enemydata.getEnemyInfo(a,c,d,e,b)};enemys.prototype.getDamageInfo=function(a,c,d,e,b){if(typeof a=="string"){a=core.material.enemys[a]}return this.enemydata.getDamageInfo(a,c,d,e,b)};enemys.prototype._calDamage=function(a,c,e,f,b){if(typeof a=="string"){a=core.material.enemys[a]}var d=this.getDamageInfo(a,c,e,f,b);if(d==null){return null}if(typeof d=="number"){return d}return d.damage};enemys.prototype.updateEnemys=function(){};enemys.prototype.getCurrentEnemys=function(d){d=d||core.status.floorId;var c=[],f={};var e=core.status.maps[d].blocks;for(var a=0;a<e.length;a++){if(!e[a].disable&&e[a].event.cls.indexOf("enemy")==0){this._getCurrentEnemys_addEnemy(e[a].event.id,c,f,d)}}return this._getCurrentEnemys_sort(c)};enemys.prototype._getCurrentEnemys_getEnemy=function(b){var a=core.material.enemys[b];if(!a){return null}return core.material.enemys[a.displayIdInBook]||a};enemys.prototype._getCurrentEnemys_addEnemy=function(d,g,j,h){var c=this._getCurrentEnemys_getEnemy(d);if(c==null||j[c.id]){return}var f=this.getEnemyInfo(c,null,null,null,h);var i=core.enemys.getSpecialText(c);if(i.length>=3){i="多属性..."}else{i=i.join("  ")}var a=this.nextCriticals(c,1,null,null,h);if(a.length>0){a=a[0]}var b=core.clone(c);for(var k in f){b[k]=f[k]}b.specialText=i;b.damage=this.getDamage(c,null,null,h);b.critical=a[0];b.criticalDamage=a[1];b.defDamage=this.getDefDamage(c,1,null,null,h);g.push(b);j[c.id]=true};enemys.prototype._getCurrentEnemys_sort=function(a){return a.sort(function(c,d){if(c.damage==d.damage){return c.money-d.money}if(c.damage==null){return 1}if(d.damage==null){return -1}return c.damage-d.damage})};enemys.prototype.hasEnemyLeft=function(a,b){if(b==null){b=core.status.floorId}if(b instanceof Array){for(var c=0;c<b.length;++c){if(core.hasEnemyLeft(a,b[c])){return true}}return false}return core.getCurrentEnemys(b).filter(function(d){return a==null||d.id==a}).length>0};