"use strict";function items(){this._init()}items.prototype._init=function(){this.items=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.items;this.itemEffect=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.itemEffect;this.itemEffectTip=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.itemEffectTip;this.useItemEffect=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.useItemEffect;this.canUseItemEffect=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.canUseItemEffect;if(!items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.equipCondition){items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.equipCondition={}}this.equipCondition=items_296f5d02_12fd_4166_a7c1_b5e830c9ee3a.equipCondition};items.prototype.getItems=function(){return core.clone(this.items)};items.prototype._resetItems=function(){if(main.mode!="play"){return}if(core.flags.bigKeyIsBox){core.material.items.bigKey.cls="items";core.material.items.bigKey.name="钥匙盒"}if(core.flags.pickaxeFourDirections){core.material.items.pickaxe.text="可以破坏勇士四周的墙"}if(core.flags.bombFourDirections){core.material.items.bomb.text="可以炸掉勇士四周的怪物"}if(core.flags.snowFourDirections){core.material.items.snow.text="可以将四周的熔岩变成平地"}if(core.flags.equipment){core.material.items.sword1.cls="equips";core.material.items.sword2.cls="equips";core.material.items.sword3.cls="equips";core.material.items.sword4.cls="equips";core.material.items.sword5.cls="equips";core.material.items.shield1.cls="equips";core.material.items.shield2.cls="equips";core.material.items.shield3.cls="equips";core.material.items.shield4.cls="equips";core.material.items.shield5.cls="equips"}};items.prototype.getItemEffect=function(itemId,itemNum){var itemCls=core.material.items[itemId].cls;if(itemCls==="items"){var ratio=parseInt(core.status.thisMap.item_ratio)||1;var curr_hp=core.status.hero.hp;if(itemId in this.itemEffect){try{for(var i=0;i<itemNum;++i){eval(this.itemEffect[itemId])}}catch(e){main.log(e)}}core.status.hero.statistics.hp+=core.status.hero.hp-curr_hp}else{core.addItem(itemId,itemNum)}};items.prototype.getItemEffectTip=function(itemId){var itemCls=core.material.items[itemId].cls;if(itemCls==="items"){var ratio=parseInt(core.status.thisMap.item_ratio)||1;if(itemId in this.itemEffectTip){try{return eval(this.itemEffectTip[itemId])||""}catch(e){main.log(e);return""}}}return""};items.prototype.useItem=function(b,c,a){if(!this.canUseItem(b)){if(a){a()}return}this._useItemEffect(b);this._afterUseItem(b);if(!c){core.status.route.push("item:"+b)}if(a){a()}};items.prototype._useItemEffect=function(itemId){if(itemId in this.useItemEffect){try{var ratio=parseInt(core.status.thisMap.item_ratio)||1;eval(this.useItemEffect[itemId])}catch(e){main.log(e)}}};items.prototype._afterUseItem=function(b){var a=core.material.items[b].cls;if(a=="tools"){core.status.hero.items[a][b]--}if(core.status.hero.items[a][b]<=0){delete core.status.hero.items[a][b]}if(!core.status.event.id){core.status.event.ui=null}core.updateStatusBar()};items.prototype.canUseItem=function(itemId){if(!core.hasItem(itemId)){return false}var able=false;if(itemId in this.canUseItemEffect){try{able=eval(this.canUseItemEffect[itemId])}catch(e){main.log(e)}}if(!able){core.status.event.data=null;core.status.event.ui=null}return able};items.prototype.itemCount=function(b){if(!core.material.items[b]||!core.isPlaying()){return 0}var a=core.material.items[b].cls;if(a=="items"){return 0}return core.status.hero.items[a][b]||0};items.prototype.hasItem=function(a){return this.itemCount(a)>0};items.prototype.hasEquip=function(b){if(!(core.material.items[b]||{}).equip||!core.isPlaying()){return null}for(var a in core.status.hero.equipment){if(core.status.hero.equipment[a]==b){return true}}return false};items.prototype.getEquip=function(a){return core.status.hero.equipment[a]||null};items.prototype.setItem=function(b,c){c=c||0;var a=core.material.items[b].cls;if(a=="items"){return}core.status.hero.items[a][b]=c;if(core.status.hero.items[a][b]<=0){if(a!="keys"){delete core.status.hero.items[a][b]}else{core.status.hero.items[a][b]=0}}core.updateStatusBar()};items.prototype.addItem=function(c,d){if(d==null){d=1}var b=core.material.items[c];var a=b.cls;if(a=="items"){return}if(core.status.hero.items[a][c]==null){core.status.hero.items[a][c]=0}core.status.hero.items[a][c]+=d;if(core.status.hero.items[a][c]<=0){if(a!="keys"){delete core.status.hero.items[a][c]}else{core.status.hero.items[a][c]=0}}if(a=="constants"&&core.status.hero.items[a][c]>1){core.status.hero.items[a][c]=1}core.updateStatusBar()};items.prototype.removeItem=function(b,c){if(c==null){c=1}if(!core.hasItem(b)){return false}var a=core.material.items[b].cls;core.status.hero.items[a][b]-=c;if(core.status.hero.items[a][b]<=0){if(a!="keys"){delete core.status.hero.items[a][b]}else{core.status.hero.items[a][b]=0}}core.updateStatusBar();return true};items.prototype.getEquipTypeByName=function(b){var c=core.status.globalAttribute.equipName;for(var a=0;a<c.length;++a){if(c[a]===b&&!core.status.hero.equipment[a]){return a}}return -1};items.prototype.getEquipTypeById=function(a){var b=core.material.items[a].equip.type;if(typeof b=="string"){b=this.getEquipTypeByName(b)}return b};items.prototype.canEquip=function(equipId,hint){var equip=core.material.items[equipId]||{};if(!equip.equip){if(hint){core.drawTip("不合法的装备！")}return false}if(!core.hasItem(equipId)&&!core.hasEquip(equipId)){if(hint){core.drawTip("你当前没有"+equip.name+"，无法换装")}return false}var condition=this.equipCondition[equipId];if(condition){try{if(!eval(condition)){if(hint){core.drawTip("当前不可换上"+equip.name)}return false}}catch(e){console.log(e);return false}}return true};items.prototype.loadEquip=function(b,a){if(!this.canEquip(b,true)){if(a){a()}return}var c=core.material.items[b]||{};var d=this.getEquipTypeById(b);if(d<0){core.drawTip("当前没有"+c.equip.type+"的空位！");if(a){a()}return}this._realLoadEquip(d,b,core.status.hero.equipment[d],a)};items.prototype.unloadEquip=function(b,a){var c=core.status.hero.equipment[b];if(!c){if(a){a()}return}this._realLoadEquip(b,null,c,a)};items.prototype.compareEquipment=function(c,b){var f={};var d=core.material.items[c],g=core.material.items[b];for(var e in core.status.hero){if(typeof core.status.hero[e]=="number"){var a=0;if(d){a+=(d.equip||{})[e]||0}if(g){a-=(g.equip||{})[e]||0}if(a!=0){f[e]=a}}}return f};items.prototype._loadEquipEffect=function(a,e,b){var d=core.compareEquipment(a,e);if(b){for(var c in d){core.addBuff(c,d[c]/100)}}else{for(var c in d){core.status.hero[c]+=d[c]}}};items.prototype._realLoadEquip=function(e,c,g,a){var b=core.material.items[c]||{},f=core.material.items[g]||{};b.equip=b.equip||{};f.equip=f.equip||{};var d=b.equip.percentage,h=f.equip.percentage;if(c&&g&&(d||false)!=(h||false)){this.unloadEquip(e);this.loadEquip(c);if(a){a()}return}this._realLoadEquip_playSound();this._loadEquipEffect(c,g,d==null?h:d);if(c){core.removeItem(c)}if(g){core.addItem(g)}core.status.hero.equipment[e]=c||null;if(c){core.drawTip("已装备上"+b.name,c)}else{if(g){core.drawTip("已卸下"+f.name,g)}}if(a){a()}};items.prototype._realLoadEquip_playSound=function(){if(core.hasFlag("__quickLoadEquip__")){return}core.stopSound();core.playSound("equip.mp3")};items.prototype.quickSaveEquip=function(a){var b=core.getFlag("saveEquips",[]);b[a]=core.clone(core.status.hero.equipment);core.setFlag("saveEquips",b);core.drawTip("已保存"+a+"号套装")};items.prototype.quickLoadEquip=function(d){var a=core.getFlag("saveEquips",[])[d];if(!a){core.drawTip(d+"号套装不存在");return}var b=core.status.globalAttribute.equipName.length;for(var c=0;c<b;c++){var h=a[c];if(h&&!this.canEquip(h,true)){return}}core.setFlag("__quickLoadEquip__",true);var g=[];for(var c=0;c<b;c++){var e=core.status.hero.equipment[c];var f=a[c];if(e!=f){g.push(f||null);if(e){this.unloadEquip(c);core.status.route.push("unEquip:"+c)}}}for(var c in g){var f=g[c];if(f){this.loadEquip(f);core.status.route.push("equip:"+f)}}core.removeFlag("__quickLoadEquip__");this._realLoadEquip_playSound();core.drawTip("成功换上"+d+"号套装")};items.prototype.getEquippedStatus=function(a){var b=0;core.status.hero.equipment.forEach(function(c){if(!c||!(core.material.items[c]||{}).equip){return}if(core.material.items[c].equip.percentage){return}b+=core.material.items[c].equip[a]||0});return b};